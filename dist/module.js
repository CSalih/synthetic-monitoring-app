/*! For license information please see module.js.LICENSE.txt */
define(["react","@grafana/ui","@grafana/runtime","@grafana/data","emotion"],(function(e,t,n,a,r){return function(e){var t={};function n(a){if(t[a])return t[a].exports;var r=t[a]={i:a,l:!1,exports:{}};return e[a].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,a){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(n.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(a,r,function(t){return e[t]}.bind(null,r));return a},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/",n(n.s=9)}([function(t,n){t.exports=e},function(e,n){e.exports=t},function(e,t,n){"use strict";n.d(t,"c",(function(){return r})),n.d(t,"a",(function(){return o})),n.d(t,"b",(function(){return s})),n.d(t,"d",(function(){return i})),n.d(t,"f",(function(){return l})),n.d(t,"e",(function(){return u}));var a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function r(e,t){function n(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var o=function(){return(o=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};function s(e,t,n,a){return new(n||(n=Promise))((function(r,o){function s(e){try{l(a.next(e))}catch(e){o(e)}}function i(e){try{l(a.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,i)}l((a=a.apply(e,t||[])).next())}))}function i(e,t){var n,a,r,o,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function i(o){return function(i){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,a&&(r=2&o[0]?a.return:o[0]?a.throw||((r=a.return)&&r.call(a),0):a.next)&&!(r=r.call(a,o[1])).done)return r;switch(a=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,a=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(r=s.trys,(r=r.length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){s.label=o[1];break}if(6===o[0]&&s.label<r[1]){s.label=r[1],r=o;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(o);break}r[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],a=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,i])}}}function l(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],a=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&a>=e.length&&(e=void 0),{value:e&&e[a++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function c(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var a,r,o=n.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(a=o.next()).done;)s.push(a.value)}catch(e){r={error:e}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}return s}function u(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(c(arguments[t]));return e}},function(e,t){e.exports=n},function(e,t){e.exports=a},function(e,t,n){"use strict";n.d(t,"a",(function(){return l}));var a=n(2),r=n(0),o=n.n(r),s=n(3),i=n(1),l=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(a.c)(t,e),t.prototype.render=function(){var e=this.props.settings;return e?o.a.createElement("div",null,o.a.createElement("h2",null,"Linked Data Sources"),o.a.createElement(i.Container,{margin:"sm"},o.a.createElement(c,{info:e.metrics}),o.a.createElement(c,{info:e.logs}))):o.a.createElement("div",null,"Loading...")},t}(r.PureComponent),c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={},t.onClick=function(){var e,n,a=t.state.ds;"worldping-datasource"===(null===(e=a)||void 0===e?void 0:e.type)?Object(s.getLocationSrv)().update({partial:!1,path:"a/grafana-worldping-app/"}):Object(s.getLocationSrv)().update({partial:!1,path:"datasources/edit/"+(null===(n=a)||void 0===n?void 0:n.id)+"/"})},t}return Object(a.c)(t,e),t.prototype.componentDidMount=function(){var e=this.props.info;this.setState({ds:s.config.datasources[e.grafanaName]})},t.prototype.render=function(){var e=this.state.ds;return e?o.a.createElement("div",{className:"add-data-source-item",onClick:this.onClick},o.a.createElement("img",{className:"add-data-source-item-logo",src:e.meta.info.logos.small}),o.a.createElement("div",{className:"add-data-source-item-text-wrapper"},o.a.createElement("span",{className:"add-data-source-item-text"},e.name),o.a.createElement("span",{className:"add-data-source-item-desc"},e.type)),o.a.createElement("div",{className:"add-data-source-item-actions"},o.a.createElement(i.Button,null,"Edit"))):o.a.createElement("div",null,"Loading...")},t}(r.PureComponent)},function(e,t,n){"use strict";n.d(t,"a",(function(){return l})),n.d(t,"b",(function(){return c}));var a=n(2),r=n(0),o=n.n(r),s=n(1),i=n(5),l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onAccessTokenChange=function(e){var n=t.props,r=n.onOptionsChange,o=n.options;r(Object(a.a)(Object(a.a)({},o),{secureJsonData:{accessToken:e.target.value}}))},t.onResetAccessToken=function(){var e=t.props,n=e.onOptionsChange,r=e.options;n(Object(a.a)(Object(a.a)({},r),{secureJsonFields:Object(a.a)(Object(a.a)({},r.secureJsonFields),{accessToken:!1}),secureJsonData:Object(a.a)(Object(a.a)({},r.secureJsonData),{accessToken:""})}))},t}return Object(a.c)(t,e),t.prototype.render=function(){var e=this.props.options,t=e.secureJsonFields,n=e.secureJsonData||{};function a(){return t&&t.accessToken}return o.a.createElement("div",null,c(e.jsonData)&&a()&&o.a.createElement(i.a,{settings:e.jsonData}),o.a.createElement("br",null),o.a.createElement("div",{className:"gf-form-group"},o.a.createElement("div",{className:"gf-form-inline"},o.a.createElement("div",{className:"gf-form"},o.a.createElement(s.LegacyForms.SecretFormField,{isConfigured:a(),value:n.accessToken||"",label:"Access Token",placeholder:"access token saved on the server",labelWidth:10,inputWidth:20,onReset:this.onResetAccessToken,onChange:this.onAccessTokenChange})))))},t}(r.PureComponent);function c(e){if(!e)return!1;var t=e.apiHost,n=e.metrics,a=e.logs;return!!(t&&n&&n.grafanaName&&n.hostedId)&&!!(a&&a.grafanaName&&a.hostedId)}},function(e,t){e.exports=r},,function(e,t,n){"use strict";n.r(t);var a,r,o,s,i,l,c,u=n(3),d=function(){function e(e,t){this.appEditCtrl.setPostUpdateHook(this.postUpdate.bind(this)),this.appModel||(this.appModel={});var n=this.appModel;n.jsonData||(n.jsonData={}),console.log("ExampleConfigCtrl",this)}return e.$inject=["$scope","$injector"],e.prototype.postUpdate=function(){var e;(null===(e=this.appModel)||void 0===e?void 0:e.enabled)?Object(u.getLocationSrv)().update({path:"a/grafana-worldping-app",partial:!1}):console.log("Not enabled...")},e.templateUrl="legacy/config.html",e}(),p=n(4),h=n(2),f=n(0),m=n.n(f);function g(e,t){var n,a;if(t){var r=""+t.id,o=t.url+("logs"===t.type?"":"/api/prom");try{for(var s=Object(h.f)(e),i=s.next();!i.done;i=s.next()){var l=i.value;if(l.url===o&&(console.log("MAYBE:",r,l.basicAuthUser,l),r===l.basicAuthUser))return l}}catch(e){n={error:e}}finally{try{i&&!i.done&&(a=s.return)&&a.call(s)}finally{if(n)throw n.error}}}}function v(){return Object(h.b)(this,void 0,Promise,(function(){var e,t,n,a,r,o,s,i;return Object(h.d)(this,(function(l){switch(l.label){case 0:e=[],l.label=1;case 1:l.trys.push([1,6,7,8]),t=Object(h.f)(Object.values(u.config.datasources)),n=t.next(),l.label=2;case 2:return n.done?[3,5]:"prometheus"!==(a=n.value).type&&"loki"!==a.type?[3,4]:[4,Object(u.getBackendSrv)().get("api/datasources/"+a.id)];case 3:(r=l.sent()).url&&r.url.indexOf("grafana.net")>0&&e.push(r),l.label=4;case 4:return n=t.next(),[3,2];case 5:return[3,8];case 6:return o=l.sent(),s={error:o},[3,8];case 7:try{n&&!n.done&&(i=t.return)&&i.call(t)}finally{if(s)throw s.error}return[7];case 8:return[2,e]}}))}))}function b(){return Object(h.b)(this,void 0,Promise,(function(){return Object(h.d)(this,(function(e){return[2,Object(u.getBackendSrv)().post("api/datasources",{name:"Worldping",type:"worldping-datasource",access:"proxy",isDefault:!1})]}))}))}function E(e,t,n){return Object(h.b)(this,void 0,Promise,(function(){var a;return Object(h.d)(this,(function(r){return a={name:e,url:t.url+("logs"===t.type?"":"/api/prom"),access:"proxy",basicAuth:!0,basicAuthUser:""+t.id,secureJsonData:{basicAuthPassword:n},type:"logs"===t.type?"loki":"prometheus"},[2,Object(u.getBackendSrv)().post("api/datasources",a).then((function(e){return e.datasource}))]}))}))}function y(e){var t=u.config.bootData.user;switch(e){case c.ADMIN:return t.orgRole===c.ADMIN;case c.EDITOR:return t.orgRole===c.ADMIN||t.orgRole===c.EDITOR;case c.VIEWER:return t.orgRole===c.ADMIN||t.orgRole===c.EDITOR||t.orgRole===c.VIEWER;default:return!1}}function C(e){var t=Object.keys(e);return t.length<1?l.HTTP:t[0]}function S(e){switch(e){case l.HTTP:return{http:{method:r.GET,ipVersion:a.V4,noFollowRedirects:!1}};case l.PING:return{ping:{ipVersion:a.V4,dontFragment:!1}};case l.DNS:return{dns:{recordType:s.A,server:"8.8.8.8",ipVersion:a.V4,protocol:i.UDP,port:53}};case l.TCP:return{tcp:{ipVersion:a.V4,tls:!1}}}}function w(e,t){var n,a,r=t.instanceSettings.jsonData.dashboards,o=void 0;try{for(var s=Object(h.f)(r),i=s.next();!i.done;i=s.next()){var l=i.value;l.title.toLocaleLowerCase()==="worldping "+e&&(o=l)}}catch(e){n={error:e}}finally{try{i&&!i.done&&(a=s.return)&&a.call(s)}finally{if(n)throw n.error}}return o}!function(e){e.Any="Any",e.V4="V4",e.V6="V6"}(a||(a={})),function(e){e.GET="GET",e.HEAD="HEAD",e.POST="POST",e.PUT="PUT",e.OPTIONS="OPTIONS",e.DELETE="DELETE"}(r||(r={})),function(e){e.HTTP1_0="HTTP/1.0",e.HTTP1_1="HTTP/1.1",e.HTTP2_0="HTTP/2"}(o||(o={})),function(e){e.A="A",e.AAAA="AAAA",e.CNAME="CNAME",e.MX="MX",e.NS="NS",e.PTR="PTR",e.SOA="SOA",e.SRV="SRV",e.TXT="TXT"}(s||(s={})),function(e){e.TCP="TCP",e.UDP="UDP"}(i||(i={})),function(e){e.HTTP="http",e.PING="ping",e.DNS="dns",e.TCP="tcp"}(l||(l={})),function(e){e.ADMIN="Admin",e.EDITOR="Editor",e.VIEWER="Viewer"}(c||(c={}));var T=n(1),x=n(6),O=n(7),R=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(h.c)(t,e),t.prototype.render=function(){var e=this,t=this.props.selected;return m.a.createElement("div",null,this.props.instances.map((function(n){var a=t===n.id,r="public/app/plugins/datasource/prometheus/img/prometheus_logo.svg",o="metrics";"logs"===n.type&&(r="public/app/plugins/datasource/loki/img/loki_icon.svg",o="logs");var s="add-data-source-item";return a&&(s+=" "+Object(O.css)("border:1px solid #5794f2")),m.a.createElement("div",{key:n.id,className:s,onClick:function(){return e.props.onSelected(n.id)}},m.a.createElement("img",{className:"add-data-source-item-logo",src:r}),m.a.createElement("div",{className:"add-data-source-item-text-wrapper"},m.a.createElement("span",{className:"add-data-source-item-text"},n.name),m.a.createElement("span",{className:"add-data-source-item-desc"},n.url)),m.a.createElement("div",{className:"add-data-source-item-actions"},m.a.createElement(T.LinkButton,{variant:"secondary",href:"https://grafana.com/orgs/"+n.orgSlug+"/hosted-"+o+"/"+n.id+"?utm_source=worldping_app",target:"_blank",rel:"noopener",icon:"external-link-alt"},"grafana.com"),!a&&m.a.createElement(T.Button,null,"Select")))})))},t}(f.PureComponent),k=n(5),I=["worldping-http.json","worldping-ping.json","worldping-dns.json","worldping-tcp.json","worldping-summary.json"];function j(){return Object(h.b)(this,void 0,Promise,(function(){var e,t,n,a,r,o,s;return Object(h.d)(this,(function(i){switch(i.label){case 0:return[4,(e=Object(u.getBackendSrv)()).get("api/folders")];case 1:t=i.sent();try{for(n=Object(h.f)(t),a=n.next();!a.done;a=n.next())if("worldPing"===(r=a.value).title)return[2,r]}catch(e){o={error:e}}finally{try{a&&!a.done&&(s=n.return)&&s.call(n)}finally{if(o)throw o.error}}return[4,e.post("api/folders",{title:"worldPing"})];case 2:return[2,i.sent()]}}))}))}function M(e,t){return Object(h.b)(this,void 0,Promise,(function(){var n,a,r;return Object(h.d)(this,(function(o){switch(o.label){case 0:return[4,(n=Object(u.getBackendSrv)()).get("public/plugins/grafana-worldping-app/dashboards/"+e)];case 1:return a=o.sent(),[4,j()];case 2:return r=o.sent(),[4,n.post("api/dashboards/import",{dashboard:a,overwrite:!0,inputs:[{name:"DS_WORLDPING_METRICS",type:"datasource",pluginId:"prometheus",value:t.metrics.grafanaName},{name:"DS_WORLDPING_LOGS",type:"datasource",pluginId:"loki",value:t.logs.grafanaName}],folderId:r.id})];case 3:return[2,{title:o.sent().title,uid:a.uid,json:e,version:a.version,latestVersion:a.version}]}}))}))}function P(){return Object(h.b)(this,void 0,Promise,(function(){var e,t,n,a,r,o,s,i,l,c;return Object(h.d)(this,(function(d){switch(d.label){case 0:e=Object(u.getBackendSrv)(),t=[],d.label=1;case 1:d.trys.push([1,6,7,8]),n=Object(h.f)(I),a=n.next(),d.label=2;case 2:return a.done?[3,5]:(r=a.value,[4,e.get("public/plugins/grafana-worldping-app/dashboards/"+r)]);case 3:o=d.sent(),s={title:o.title,uid:o.uid,json:r,version:0,latestVersion:o.version},t.push(s),d.label=4;case 4:return a=n.next(),[3,2];case 5:return[3,8];case 6:return i=d.sent(),l={error:i},[3,8];case 7:try{a&&!a.done&&(c=n.return)&&c.call(n)}finally{if(l)throw l.error}return[7];case 8:return[2,t]}}))}))}function A(e){return Object(h.b)(this,void 0,Promise,(function(){return Object(h.d)(this,(function(t){return[2,Object(u.getBackendSrv)().delete("/api/dashboards/uid/"+e.uid)]}))}))}var N=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={dashboards:t.props.options.dashboards},t.onImport=function(e){return function(){return Object(h.b)(t,void 0,void 0,(function(){var t,n,a,r,o;return Object(h.d)(this,(function(s){switch(s.label){case 0:return(t=this.props.onChange)?(n=Object(h.a)({},this.props.options),[4,M(e.json,n)]):[2];case 1:return a=s.sent(),console.log("dashboard updated"),(r=n.dashboards.findIndex((function(e){return e.uid===a.uid})))<0?n.dashboards.push(a):n.dashboards[r]=a,o=Object(h.e)(this.state.dashboards),(r=o.findIndex((function(e){return e.uid===a.uid})))<0?o.push(a):o[r]=a,this.setState({dashboards:o}),[2,t(n)]}}))}))}},t.onRemove=function(e){return function(){return Object(h.b)(t,void 0,void 0,(function(){var t,n,a,r;return Object(h.d)(this,(function(o){switch(o.label){case 0:return(t=this.props.onChange)?(n=Object(h.a)({},this.props.options),[4,A(e)]):[2];case 1:return o.sent(),(a=n.dashboards.findIndex((function(t){return t.uid===e.uid})))>=0&&n.dashboards.splice(a,1),r=Object(h.e)(this.state.dashboards),(a=r.findIndex((function(t){return t.uid===e.uid})))>=0&&(r[a].version=0),this.setState({dashboards:r}),[2,t(n)]}}))}))}},t}return Object(h.c)(t,e),t.prototype.componentDidMount=function(){return Object(h.b)(this,void 0,void 0,(function(){var e,t,n,a,r,o,s,i,l,c,u;return Object(h.d)(this,(function(d){switch(d.label){case 0:return e=this.props,t=e.checkUpdates,n=e.onChange,t&&n?(a=Object(h.e)(this.state.dashboards),[4,P()]):[2];case 1:r=d.sent(),o=function(e){var t=a.findIndex((function(t){return t.uid===e.uid}));t<0?a.push(e):(a[t].latestVersion=e.latestVersion,a[t].version||(a[t].version=-1))};try{for(s=Object(h.f)(r),i=s.next();!i.done;i=s.next())l=i.value,o(l)}catch(e){c={error:e}}finally{try{i&&!i.done&&(u=s.return)&&u.call(s)}finally{if(c)throw c.error}}return console.log(a),this.setState({dashboards:a}),[2]}}))}))},t.prototype.withImports=function(e){if(this.props.checkUpdates)return m.a.createElement("td",{style:{textAlign:"right"}},0===e.version?m.a.createElement("button",{className:"btn btn-secondary btn-small",onClick:this.onImport(e)},"Import"):m.a.createElement("button",{className:"btn btn-secondary btn-small",onClick:this.onImport(e)},function(e){return(e.latestVersion||0)>(e.version||0)?"Update":"Re-import"}(e)),0!==e.version&&m.a.createElement("button",{className:"btn btn-danger btn-small",onClick:this.onRemove(e)},m.a.createElement(T.Icon,{name:"trash-alt"})))},t.prototype.render=function(){var e=this,t=this.state.dashboards;return m.a.createElement("div",null,m.a.createElement("h3",null,"Dashboards:"),m.a.createElement("table",{className:"filter-table"},m.a.createElement("tbody",null,t.map((function(t){return m.a.createElement("tr",{key:t.uid},m.a.createElement("td",{className:"width-1"},m.a.createElement(T.Icon,{name:"apps"})),m.a.createElement("td",null,m.a.createElement("a",{href:"d/"+t.uid+"/"},t.title)),e.withImports(t))})))))},t}(f.PureComponent),U=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.defaultApiHost="https://worldping-api-dev.grafana.net",t.state={showResetModal:!1,resetConfig:!1,apiHost:t.defaultApiHost,showAdvanced:!1},t.onInit=function(){return Object(h.b)(t,void 0,void 0,(function(){var e,t,n,a,r,o,s,i,l;return Object(h.d)(this,(function(c){switch(c.label){case 0:return e=this.props.instance,t=this.state,n=t.adminApiToken,a=t.apiHost,n?a?[4,e.registerInit(a,n)]:(alert("Missing apiHost"),[2]):(alert("Missing admin key"),[2]);case 1:return r=c.sent(),this.setState({info:r,logsInstance:null===(s=null===(o=r.tenantInfo)||void 0===o?void 0:o.logInstance)||void 0===s?void 0:s.id,metricsInstance:null===(l=null===(i=r.tenantInfo)||void 0===i?void 0:i.metricInstance)||void 0===l?void 0:l.id}),[2]}}))}))},t.onApiHostChange=function(e){t.setState({apiHost:e.target.value})},t.onApiTokenChange=function(e){t.setState({adminApiToken:e.target.value})},t.onSelectLogs=function(e){t.setState({logsInstance:e})},t.onSelectMetrics=function(e){t.setState({metricsInstance:e})},t.createDataSource=function(e,n){return Object(h.b)(t,void 0,void 0,(function(){var t,a,r,o;return Object(h.d)(this,(function(s){switch(s.label){case 0:t=this.props.instance,a=this.state.adminApiToken,s.label=1;case 1:return s.trys.push([1,5,,6]),[4,t.getViewerToken(a,n)];case 2:return(r=s.sent())?[4,E(e,n,r)]:[3,4];case 3:return[2,s.sent()];case 4:return console.error("error getting token"),[2,void 0];case 5:return o=s.sent(),console.log("Error creating",e,n,o),[3,6];case 6:return[2,void 0]}}))}))},t.onSave=function(){return Object(h.b)(t,void 0,void 0,(function(){var e,t,n,a,r,o,s,i,l,c,u,d,p,f,m,b,E,y,C,S,w,T,x=this;return Object(h.d)(this,(function(O){switch(O.label){case 0:return e=this.props.instance,t=this.state,n=t.info,a=t.adminApiToken,r=t.apiHost,o=null===(C=e)||void 0===C?void 0:C.instanceSettings.name,s=null===(S=n)||void 0===S?void 0:S.instances.find((function(e){return e.id===x.state.metricsInstance})),i=null===(w=n)||void 0===w?void 0:w.instances.find((function(e){return e.id===x.state.logsInstance})),s?i?r?[4,v()]:(alert("Missing apiHost"),[2]):(alert("Missing logs instance"),[2]):(alert("Missing metrics instance"),[2]);case 1:return l=O.sent(),(c=g(l,s))?[3,3]:[4,this.createDataSource(o+" Metrics",s)];case 2:c=O.sent(),O.label=3;case 3:return(u=g(l,i))?[3,5]:[4,this.createDataSource(o+" Logs",i)];case 4:u=O.sent(),O.label=5;case 5:d={apiHost:r,logs:{grafanaName:u.name,hostedId:i.id},metrics:{grafanaName:c.name,hostedId:s.id},dashboards:[]},O.label=6;case 6:O.trys.push([6,11,12,13]),p=Object(h.f)(I),f=p.next(),O.label=7;case 7:return f.done?[3,10]:[4,M(f.value,d)];case 8:m=O.sent(),d.dashboards.push(m),O.label=9;case 9:return f=p.next(),[3,7];case 10:return[3,13];case 11:return b=O.sent(),E={error:b},[3,13];case 12:try{f&&!f.done&&(y=p.return)&&y.call(p)}finally{if(E)throw E.error}return[7];case 13:return[4,e.registerSave(a,d,null===(T=n)||void 0===T?void 0:T.accessToken)];case 14:return O.sent(),window.location.reload(),[2]}}))}))},t.onToggleAdvanced=function(e){t.setState({showAdvanced:!t.state.showAdvanced})},t.showResetModal=function(e){return function(){t.setState({showResetModal:e})}},t.onReset=function(){t.setState({resetConfig:!0})},t.onOptionsChange=function(e){return t.props.instance.onOptionsChange(e)},t}return Object(h.c)(t,e),t.prototype.renderSetup=function(){var e=this.state,t=e.info,n=e.adminApiToken,a=e.apiHost,r=e.logsInstance,o=e.metricsInstance,s=e.showAdvanced;return t?m.a.createElement("div",null,m.a.createElement("div",null,"Select the hosted instances where worldping will send it data"),m.a.createElement("h4",null,"Metrics"),m.a.createElement(R,{instances:t.instances.filter((function(e){return"prometheus"===e.type})),onSelected:this.onSelectMetrics,selected:o}),m.a.createElement("h4",null,"Logs"),m.a.createElement(R,{instances:t.instances.filter((function(e){return"logs"===e.type})),onSelected:this.onSelectLogs,selected:r}),m.a.createElement("br",null),m.a.createElement("br",null),m.a.createElement(T.Button,{variant:"primary",onClick:this.onSave},"Setup")):m.a.createElement("div",null,m.a.createElement(T.HorizontalGroup,{wrap:!0},m.a.createElement(T.Label,null,"Admin API Key"),m.a.createElement(T.Input,{type:"text",width:100,placeholder:"Grafana.com Admin Api Key",value:n||"",onChange:this.onApiTokenChange})),m.a.createElement("br",null),m.a.createElement(T.Collapse,{label:"Advanced",collapsible:!0,onToggle:this.onToggleAdvanced,isOpen:s},m.a.createElement(T.HorizontalGroup,null,m.a.createElement(T.Label,null,"Backend Address"),m.a.createElement(T.Input,{type:"text",width:40,placeholder:"worldPing backend Address",value:a||this.defaultApiHost,onChange:this.onApiHostChange}))),m.a.createElement(T.Button,{variant:"primary",onClick:this.onInit},"Initalize"))},t.prototype.render=function(){var e,t=this.props.instance;if(!t)return m.a.createElement("div",null,"Loading...");var n=this.state,a=n.showResetModal,r=n.resetConfig;return!Object(x.b)(null===(e=t.instanceSettings)||void 0===e?void 0:e.jsonData)||r?this.renderSetup():m.a.createElement("div",null,m.a.createElement(N,{options:t.instanceSettings.jsonData,checkUpdates:!0,onChange:this.onOptionsChange}),m.a.createElement("br",null),m.a.createElement(k.a,{settings:t.instanceSettings.jsonData}),m.a.createElement(T.Button,{variant:"destructive",onClick:this.showResetModal(!0)},"Reset"),m.a.createElement(T.ConfirmModal,{isOpen:a,title:"Reset Configuration",body:"Are you sure you want to reset worldPing's configuration?",confirmText:"Reset Configuration",onConfirm:this.onReset,onDismiss:this.showResetModal(!1)}))},t}(f.PureComponent),D={job:V,target:F,frequency:H,timeout:B,labels:q,settings:function(e){var t=C(e);if(!e[t])return!1;switch(t){case l.HTTP:return e.http,!0;case l.PING:return e.ping,!0;case l.DNS:return e.dns,!0;case l.TCP:return e.tcp,!0}},probes:J};function L(e){return D.job(e.job)&&D.target(e.target)&&D.frequency(e.frequency)&&D.timeout(e.timeout)&&D.labels(e.labels)&&D.settings(e.settings)&&D.probes(e.probes)}function V(e){return e.length>0&&e.length<32}function F(e){return e.length>0&&e.length<64}function H(e){return e>=1e4&&e<=12e4}function B(e){return e>=1e3&&e<=1e4}function q(e){var t,n,a;if(e.length>64)return!1;try{for(var r=Object(h.f)(e),o=r.next();!o.done;o=r.next()){var s=o.value;if(!z((a=s).name)||!Q(a.value))return!1}}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}return!0}var G=["instance","job","probe","config_version","check_name"],_=/^[a-zA-Z_][a-zA-Z0-9_]*$/;function z(e){return!(e.length<1||e.length>32)&&(!(G.indexOf(e)>-1)&&_.test(e))}function Q(e){return e.length>0&&e.length<=32}function J(e){return e.length>0&&e.length<=64}var K=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(h.c)(t,e),t.prototype.render=function(){var e=this.props.help;return m.a.createElement(T.Container,{margin:"sm"},this.props.name,e&&m.a.createElement(T.Tooltip,{content:e},m.a.createElement("span",null," ",m.a.createElement(T.Icon,{name:"question-circle"}))))},t}(f.PureComponent),W=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={labels:t.props.labels||[],numLabels:t.props.labels.length},t.addLabel=function(){var e=t.state.labels;console.log("adding new label",e);var n=e.push({name:"",value:""});t.setState({labels:e,numLabels:n},t.onUpdate)},t.onDelete=function(e){var n=t.state.labels;n.splice(e,1),t.setState({labels:n,numLabels:n.length},t.onUpdate)},t.onUpdate=function(){t.props.onUpdate(t.state.labels)},t.onChange=function(e,n){var a=t.state.labels;a[e]=n,t.setState({labels:a},t.onUpdate)},t}return Object(h.c)(t,e),t.prototype.render=function(){var e=this,t=this.state.labels,n=this.props.isEditor;return m.a.createElement(T.VerticalGroup,{justify:"space-between"},m.a.createElement(T.List,{items:t,renderItem:function(t,a){return m.a.createElement(X,{onDelete:e.onDelete,onChange:e.onChange,label:t,index:a,isEditor:n})}}),m.a.createElement(T.Button,{onClick:this.addLabel,disabled:!n,variant:"secondary",size:"sm"},m.a.createElement(T.Icon,{name:"plus"}),"  Add ",this.props.type))},t}(f.PureComponent),X=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={name:t.props.label.name,value:t.props.label.value},t.onNameChange=function(e){t.setState({name:e.target.value},t.onChange)},t.onValueChange=function(e){t.setState({value:e.target.value},t.onChange)},t.onDelete=function(){t.props.onDelete(t.props.index)},t.onChange=function(){t.props.onChange(t.props.index,{name:t.state.name,value:t.state.value})},t}return Object(h.c)(t,e),t.prototype.componentDidUpdate=function(e){var t=this.props,n=t.label,a=t.index;n===e.label&&a===e.index||this.setState({name:this.props.label.name,value:this.props.label.value})},t.prototype.render=function(){var e=this.state,t=e.name,n=e.value,a=this.props.isEditor;return console.log("rendering label with name:",t),m.a.createElement(T.HorizontalGroup,{justify:"space-between"},m.a.createElement(T.Input,{type:"text",placeholder:"name",value:t,onChange:this.onNameChange,disabled:!a,invalid:!z(t)}),m.a.createElement(T.Input,{type:"text",placeholder:"value",value:n,onChange:this.onValueChange,disabled:!a,invalid:!Q(n)}),m.a.createElement(T.IconButton,{name:"minus-circle",onClick:this.onDelete,disabled:!a}))},t}(f.PureComponent),$=[{label:"Any",value:a.Any},{label:"V4",value:a.V4},{label:"V6",value:a.V6}],Z=function(e){function t(){var t,n,r=e.apply(this,Object(h.e)(arguments))||this;return r.state={ipVersion:(null===(t=r.props.settings.ping)||void 0===t?void 0:t.ipVersion)||a.V4,dontFragment:(null===(n=r.props.settings.ping)||void 0===n?void 0:n.dontFragment)||!1,showAdvanced:!1},r.onUpdate=function(){var e=r.state;r.props.onUpdate({ping:e})},r.onIpVersionChange=function(e){r.setState({ipVersion:e.value||a.Any},r.onUpdate)},r.onDontFragmentChange=function(e){r.setState({dontFragment:!r.state.dontFragment},r.onUpdate)},r.onToggleOptions=function(e){r.setState({showAdvanced:!r.state.showAdvanced})},r}return Object(h.c)(t,e),t.prototype.render=function(){var e=this.state,t=e.ipVersion,n=e.dontFragment,a=e.showAdvanced,r=this.props.isEditor;return m.a.createElement(T.Container,null,m.a.createElement(T.Collapse,{label:"Advanced Options",collapsible:!0,onToggle:this.onToggleOptions,isOpen:a},m.a.createElement(T.HorizontalGroup,null,m.a.createElement("div",null,m.a.createElement(T.Field,{label:m.a.createElement(K,{name:"IP Version",help:"The IP protocol of the ICMP request"}),disabled:!r},m.a.createElement(T.Select,{value:t,options:$,onChange:this.onIpVersionChange}))),m.a.createElement("div",null,m.a.createElement(T.Field,{label:m.a.createElement(K,{name:"Don't Fragment",help:"Set the DF-bit in the IP-header. Only works with ipV4"}),disabled:!r},m.a.createElement(T.Container,{padding:"sm"},m.a.createElement(T.Switch,{value:n,onChange:this.onDontFragmentChange,disabled:!r})))))))},t}(f.PureComponent),Y=function(e){function t(){var t,n,o,s,i,l,c,u,d,p,f,m,g,v,b=e.apply(this,Object(h.e)(arguments))||this;return b.state={method:(null===(t=b.props.settings.http)||void 0===t?void 0:t.method)||r.GET,body:null===(n=b.props.settings.http)||void 0===n?void 0:n.body,headers:null===(o=b.props.settings.http)||void 0===o?void 0:o.headers,ipVersion:(null===(s=b.props.settings.http)||void 0===s?void 0:s.ipVersion)||a.V4,noFollowRedirects:(null===(i=b.props.settings.http)||void 0===i?void 0:i.noFollowRedirects)||!1,failIfSSL:(null===(l=b.props.settings.http)||void 0===l?void 0:l.failIfSSL)||!1,failIfNotSSL:(null===(c=b.props.settings.http)||void 0===c?void 0:c.failIfNotSSL)||!1,validStatusCodes:(null===(u=b.props.settings.http)||void 0===u?void 0:u.validStatusCodes)||[],validHTTPVersions:(null===(d=b.props.settings.http)||void 0===d?void 0:d.validHTTPVersions)||[],failIfBodyMatchesRegexp:(null===(p=b.props.settings.http)||void 0===p?void 0:p.failIfBodyMatchesRegexp)||[],failIfBodyNotMatchesRegexp:(null===(f=b.props.settings.http)||void 0===f?void 0:f.failIfBodyNotMatchesRegexp)||[],failIfHeaderMatchesRegexp:(null===(m=b.props.settings.http)||void 0===m?void 0:m.failIfHeaderMatchesRegexp)||[],failIfHeaderNotMatchesRegexp:(null===(g=b.props.settings.http)||void 0===g?void 0:g.failIfHeaderNotMatchesRegexp)||[],cacheBustingQueryParamName:null===(v=b.props.settings.http)||void 0===v?void 0:v.cacheBustingQueryParamName,showAdvanced:!1,showValidation:!1,showAuthentication:!1,showTLS:!1},b.onUpdate=function(){var e=b.state;b.props.onUpdate({http:e})},b.onMethodChange=function(e){b.setState({method:e.value||r.GET},b.onUpdate)},b.onBodyChange=function(e){b.setState({body:e.target.value},b.onUpdate)},b.onBearerTokenChange=function(e){b.setState({bearerToken:e.target.value},b.onUpdate)},b.onBasicAuthChange=function(e){b.setState({basicAuth:e},b.onUpdate)},b.onIpVersionChange=function(e){b.setState({ipVersion:e.value||a.Any},b.onUpdate)},b.onNoFollowRedirectsChange=function(e){b.setState({noFollowRedirects:!b.state.noFollowRedirects},b.onUpdate)},b.onFailIfNotSSLChange=function(e){b.setState({failIfNotSSL:!b.state.failIfNotSSL},b.onUpdate)},b.onFailIfSSLChange=function(e){b.setState({failIfSSL:!b.state.failIfSSL},b.onUpdate)},b.onCacheBustingQueryParamNameChange=function(e){b.setState({cacheBustingQueryParamName:e.target.value},b.onUpdate)},b.onToggleAdvanced=function(e){b.setState({showAdvanced:!b.state.showAdvanced})},b.onToggleValidation=function(e){b.setState({showValidation:!b.state.showValidation})},b.onToggleAuthentication=function(e){b.setState({showAuthentication:!b.state.showAuthentication})},b.onToggleTLS=function(e){b.setState({showTLS:!b.state.showTLS})},b.onTLSChange=function(e){b.setState({tlsConfig:e},b.onUpdate)},b.onValidHttpVersionsChange=function(e){var t,n,a=[];try{for(var r=Object(h.f)(e.values()),o=r.next();!o.done;o=r.next()){var s=o.value;s.value&&a.push(s.value)}}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}b.setState({validHTTPVersions:a},b.onUpdate)},b.onValidStatusCodeChange=function(e){var t,n,a=[];try{for(var r=Object(h.f)(e.values()),o=r.next();!o.done;o=r.next()){var s=o.value;s.value&&a.push(s.value)}}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}b.setState({validStatusCodes:a},b.onUpdate)},b.onHeadersUpdate=function(e){var t,n,a=[];try{for(var r=Object(h.f)(e),o=r.next();!o.done;o=r.next()){var s=o.value;a.push(s.name+": "+s.value)}}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}b.setState({headers:a},b.onUpdate)},b.onFailIfBodyMatchesRegexpChange=function(e){return function(t){var n,a=[];null===(n=b.state.failIfBodyMatchesRegexp)||void 0===n||n.forEach((function(n,r){r===e?a.push(t.target.value):a.push(n)})),b.setState({failIfBodyMatchesRegexp:a},b.onUpdate)}},b.onFailIfBodyMatchesRegexpDelete=function(e){return function(){var t,n=[];null===(t=b.state.failIfBodyMatchesRegexp)||void 0===t||t.forEach((function(t,a){a!==e&&n.push(t)})),b.setState({failIfBodyMatchesRegexp:n},b.onUpdate)}},b.addFailIfBodyMatchesRegexp=function(){var e,t,n=[];try{for(var a=Object(h.f)(b.state.failIfBodyMatchesRegexp||[]),r=a.next();!r.done;r=a.next()){var o=r.value;n.push(o)}}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}n.push(""),b.setState({failIfBodyMatchesRegexp:n},b.onUpdate)},b.onFailIfBodyNotMatchesRegexpChange=function(e){return function(t){var n,a=[];null===(n=b.state.failIfBodyNotMatchesRegexp)||void 0===n||n.forEach((function(n,r){r===e?a.push(t.target.value):a.push(n)})),b.setState({failIfBodyNotMatchesRegexp:a},b.onUpdate)}},b.onFailIfBodyNotMatchesRegexpDelete=function(e){return function(){var t,n=[];null===(t=b.state.failIfBodyNotMatchesRegexp)||void 0===t||t.forEach((function(t,a){a!==e&&n.push(t)})),b.setState({failIfBodyNotMatchesRegexp:n},b.onUpdate)}},b.addFailIfBodyNotMatchesRegexp=function(){var e,t,n=[];try{for(var a=Object(h.f)(b.state.failIfBodyNotMatchesRegexp||[]),r=a.next();!r.done;r=a.next()){var o=r.value;n.push(o)}}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}n.push(""),b.setState({failIfBodyNotMatchesRegexp:n},b.onUpdate)},b.onFailIfHeaderMatchesUpdate=function(e){var t=[];b.state.failIfHeaderMatchesRegexp?e.forEach((function(e){t.push(e)})):t=e,console.log("setting failIfHeaderMatchesRegexp",t),b.setState({failIfHeaderMatchesRegexp:t},b.onUpdate)},b.onFailIfHeaderNotMatchesUpdate=function(e){var t=[];b.state.failIfHeaderNotMatchesRegexp?e.forEach((function(e){t.push(e)})):t=e,b.setState({failIfHeaderNotMatchesRegexp:t},b.onUpdate)},b}return Object(h.c)(t,e),t.prototype.headersToLabels=function(){var e,t,n=[];try{for(var a=Object(h.f)(this.state.headers||[]),r=a.next();!r.done;r=a.next()){var o=r.value.split(":",2);n.push({name:o[0],value:o[1]})}}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}return n},t.prototype.generateValidStatusCodes=function(){for(var e=[],t=100;t<=102;t++)e.push({label:""+t,value:t});for(t=200;t<=208;t++)e.push({label:""+t,value:t});for(t=300;t<=308;t++)e.push({label:""+t,value:t});for(t=400;t<=418;t++)e.push({label:""+t,value:t});e.push({label:"422",value:422}),e.push({label:"426",value:426}),e.push({label:"428",value:428}),e.push({label:"429",value:429}),e.push({label:"431",value:431});for(t=500;t<=511;t++)e.push({label:""+t,value:t});return e.push({label:"598",value:598}),e.push({label:"599",value:599}),e},t.prototype.render=function(){var e=this,t=this.state,n=this.props.isEditor,a=[{label:"HTTP/1.0",value:o.HTTP1_0},{label:"HTTP/1.1",value:o.HTTP1_1},{label:"HTTP/2",value:o.HTTP2_0}],s=[{label:"GET",value:r.GET},{label:"HEAD",value:r.HEAD},{label:"PUT",value:r.PUT},{label:"POST",value:r.POST},{label:"DELETE",value:r.DELETE},{label:"OPTIONS",value:r.OPTIONS}],i=this.generateValidStatusCodes();return m.a.createElement(T.Container,null,m.a.createElement(T.HorizontalGroup,null,m.a.createElement(T.Field,{label:m.a.createElement(K,{name:"Request Method",help:"The HTTP method the probe will use"}),disabled:!n},m.a.createElement(T.Select,{value:t.method,options:s,onChange:this.onMethodChange}))),m.a.createElement(T.Container,null,m.a.createElement(T.Field,{label:m.a.createElement(K,{name:"Request Body",help:"The body of the HTTP request used in probe."}),disabled:!n},m.a.createElement("div",null,m.a.createElement(T.TextArea,{value:t.body,onChange:this.onBodyChange,rows:2,disabled:!n})))),m.a.createElement(T.Container,null,m.a.createElement(T.Field,{label:m.a.createElement(K,{name:"Request Headers",help:"The HTTP headers set for the probe.."}),disabled:!n},m.a.createElement("div",null,m.a.createElement(W,{labels:this.headersToLabels(),isEditor:n,onUpdate:this.onHeadersUpdate,type:"Header"})))),m.a.createElement("br",null),m.a.createElement(T.Collapse,{label:"TLS Config",collapsible:!0,onToggle:this.onToggleTLS,isOpen:t.showTLS},m.a.createElement(te,{onChange:this.onTLSChange,isEditor:n,tlsConfig:t.tlsConfig})),m.a.createElement(T.Collapse,{label:"Authentication",collapsible:!0,onToggle:this.onToggleAuthentication,isOpen:t.showAuthentication},m.a.createElement(T.HorizontalGroup,null,m.a.createElement(T.Field,{label:m.a.createElement(K,{name:"Bearer Token",help:"The bearer token for the target"}),disabled:!n},m.a.createElement(T.Input,{type:"password",placeholder:"Bearer Token",value:t.bearerToken,onChange:this.onBearerTokenChange,disabled:!n}))),m.a.createElement(ee,{onChange:this.onBasicAuthChange,basicAuth:t.basicAuth,isEditor:n})),m.a.createElement(T.Collapse,{label:"Validation",collapsible:!0,onToggle:this.onToggleValidation,isOpen:t.showValidation},m.a.createElement(T.HorizontalGroup,null,m.a.createElement(T.Field,{label:m.a.createElement(K,{name:"Valid Status Codes",help:"Accepted status codes for this probe. Defaults to 2xx."}),disabled:!n},m.a.createElement(T.MultiSelect,{options:i,value:t.validStatusCodes,onChange:this.onValidStatusCodeChange,disabled:!n})),m.a.createElement(T.Field,{label:m.a.createElement(K,{name:"Valid HTTP Versions",help:"Accepted HTTP versions for this probe"}),disabled:!n},m.a.createElement(T.MultiSelect,{options:a,value:t.validHTTPVersions,onChange:this.onValidHttpVersionsChange,disabled:!n})),m.a.createElement(T.Field,{label:m.a.createElement(K,{name:"Fail if SSL",help:"Probe fails if SSL is present"}),disabled:!n},m.a.createElement(T.Container,{padding:"sm"},m.a.createElement(T.Switch,{value:t.failIfSSL,onChange:this.onFailIfSSLChange,disabled:!n}))),m.a.createElement(T.Field,{label:m.a.createElement(K,{name:"Fail if not SSL",help:"Probe fails if SSL is not present"}),disabled:!n},m.a.createElement(T.Container,{padding:"sm"},m.a.createElement(T.Switch,{value:t.failIfNotSSL,onChange:this.onFailIfNotSSLChange,disabled:!n})))),m.a.createElement(T.Field,{label:m.a.createElement(K,{name:"Fail if body matches regexp",help:"Probe fails if response body matches regex"}),disabled:!n},m.a.createElement(T.VerticalGroup,{justify:"space-between"},m.a.createElement(T.List,{items:t.failIfBodyMatchesRegexp||[],renderItem:function(t,a){return m.a.createElement(T.HorizontalGroup,null,m.a.createElement(T.Input,{type:"text",placeholder:"regexp",value:t,onChange:e.onFailIfBodyMatchesRegexpChange(a),disabled:!n}),m.a.createElement(T.IconButton,{name:"minus-circle",onClick:e.onFailIfBodyMatchesRegexpDelete(a),disabled:!n}))}}),m.a.createElement(T.Button,{onClick:this.addFailIfBodyMatchesRegexp,disabled:!n,variant:"secondary",size:"sm"},m.a.createElement(T.Icon,{name:"plus"}),"  Add Body Regexp"))),m.a.createElement(T.Field,{label:m.a.createElement(K,{name:"Fail if body doesn't match regexp",help:"Probe fails if response body does not match regex"}),disabled:!n},m.a.createElement(T.VerticalGroup,{justify:"space-between"},m.a.createElement(T.List,{items:t.failIfBodyNotMatchesRegexp||[],renderItem:function(t,a){return m.a.createElement(T.HorizontalGroup,null,m.a.createElement(T.Input,{type:"text",placeholder:"regexp",value:t,onChange:e.onFailIfBodyNotMatchesRegexpChange(a),disabled:!n}),m.a.createElement(T.IconButton,{name:"minus-circle",onClick:e.onFailIfBodyNotMatchesRegexpDelete(a),disabled:!n}))}}),m.a.createElement(T.Button,{onClick:this.addFailIfBodyNotMatchesRegexp,disabled:!n,variant:"secondary",size:"sm"},m.a.createElement(T.Icon,{name:"plus"}),"  Add Body Regexp"))),m.a.createElement(ne,{headerMatches:t.failIfHeaderMatchesRegexp||[],name:"Fail if header matches regexp",help:"Probe fails if response header matches regex. For headers with multiple values, fails if *at least one* matches",onChange:this.onFailIfHeaderMatchesUpdate,isEditor:n}),m.a.createElement(ne,{headerMatches:t.failIfHeaderNotMatchesRegexp||[],name:"Fail if header doesn't match regexp",help:"Probe fails if response header does not match regex. For headers with multiple values, fails if *none* match.",onChange:this.onFailIfHeaderNotMatchesUpdate,isEditor:n})),m.a.createElement(T.Collapse,{label:"Advanced Options",collapsible:!0,onToggle:this.onToggleAdvanced,isOpen:t.showAdvanced},m.a.createElement(T.HorizontalGroup,null,m.a.createElement("div",null,m.a.createElement(T.Field,{label:m.a.createElement(K,{name:"IP Version",help:"The IP protocol of the HTTP request"}),disabled:!n},m.a.createElement(T.Select,{value:t.ipVersion,options:$,onChange:this.onIpVersionChange}))),m.a.createElement("div",null,m.a.createElement(T.Field,{label:m.a.createElement(K,{name:"Follow Redirects",help:"Whether or not the probe will follow any redirects."}),disabled:!n},m.a.createElement(T.Container,{padding:"sm"},m.a.createElement(T.Switch,{value:!t.noFollowRedirects,onChange:this.onNoFollowRedirectsChange,disabled:!n}))))),m.a.createElement(T.HorizontalGroup,null,m.a.createElement("div",null,m.a.createElement(T.Field,{label:m.a.createElement(K,{name:"Cache busting query parameter name",help:"The name of the query parameter used to prevent the server from using a cached response. Each probe will assign a random value to this parameter each time a request is made."})},m.a.createElement(T.Input,{type:"string",placeholder:"cache-bust",value:t.cacheBustingQueryParamName,onChange:this.onCacheBustingQueryParamNameChange,disabled:!n}))))))},t}(f.PureComponent),ee=function(e){function t(){var t,n,a=e.apply(this,Object(h.e)(arguments))||this;return a.state={username:(null===(t=a.props.basicAuth)||void 0===t?void 0:t.username)||"",password:(null===(n=a.props.basicAuth)||void 0===n?void 0:n.password)||""},a.onUpdate=function(){if(a.state.username||a.state.password){var e={username:a.state.username,password:a.state.password};a.props.onChange(e)}else a.props.onChange(void 0)},a.onUsernameChange=function(e){a.setState({username:e.target.value},a.onUpdate)},a.onPasswordChange=function(e){a.setState({password:e.target.value},a.onUpdate)},a}return Object(h.c)(t,e),t.prototype.render=function(){var e=this.state,t=e.username,n=e.password,a=this.props.isEditor;return m.a.createElement(T.HorizontalGroup,null,m.a.createElement(T.Field,{label:m.a.createElement(K,{name:"Username",help:"Basic Authentication username"}),disabled:!a},m.a.createElement(T.Input,{type:"text",placeholder:"username",value:t,onChange:this.onUsernameChange,disabled:!a})),m.a.createElement(T.Field,{label:m.a.createElement(K,{name:"Password",help:"Basic Authentication password"}),disabled:!a},m.a.createElement(T.Input,{type:"password",placeholder:"password",value:n,onChange:this.onPasswordChange,disabled:!a})))},t}(f.PureComponent),te=function(e){function t(){var t,n,a,r,o,s=e.apply(this,Object(h.e)(arguments))||this;return s.state={insecureSkipVerify:(null===(t=s.props.tlsConfig)||void 0===t?void 0:t.insecureSkipVerify)||!1,caCert:(null===(n=s.props.tlsConfig)||void 0===n?void 0:n.caCert)||"",clientCert:(null===(a=s.props.tlsConfig)||void 0===a?void 0:a.clientCert)||"",clientKey:(null===(r=s.props.tlsConfig)||void 0===r?void 0:r.clientKey)||"",serverName:(null===(o=s.props.tlsConfig)||void 0===o?void 0:o.serverName)||""},s.onUpdate=function(){var e={insecureSkipVerify:s.state.insecureSkipVerify,caCert:s.state.caCert,clientCert:s.state.clientCert,clientKey:s.state.clientKey,serverName:s.state.serverName};s.props.onChange(e)},s.onInsecureSkipVerifyChange=function(e){s.setState({insecureSkipVerify:!s.state.insecureSkipVerify},s.onUpdate)},s.onServerNameChange=function(e){s.setState({serverName:e.target.value},s.onUpdate)},s.onCACertChange=function(e){s.setState({caCert:e.target.value},s.onUpdate)},s.onClientCertChange=function(e){s.setState({clientCert:e.target.value},s.onUpdate)},s.onClientKeyChange=function(e){s.setState({clientKey:e.target.value},s.onUpdate)},s}return Object(h.c)(t,e),t.prototype.render=function(){var e=this.state,t=e.insecureSkipVerify,n=e.caCert,a=e.clientCert,r=e.clientKey,o=e.serverName,s=this.props.isEditor;return m.a.createElement("div",null,m.a.createElement(T.HorizontalGroup,null,m.a.createElement(T.Field,{label:m.a.createElement(K,{name:"Skip Validation",help:"Disable target certificate validation"}),disabled:!s},m.a.createElement(T.Container,{padding:"sm"},m.a.createElement(T.Switch,{value:t,onChange:this.onInsecureSkipVerifyChange,disabled:!s}))),m.a.createElement(T.Field,{label:m.a.createElement(K,{name:"Server Name",help:"Used to verify the hostname for the targets"}),disabled:!s},m.a.createElement(T.Input,{type:"text",placeholder:"ServerName",value:o,onChange:this.onServerNameChange,disabled:!s}))),m.a.createElement(T.Container,null,m.a.createElement(T.Field,{label:m.a.createElement(K,{name:"CA Certificate",help:"The CA cert to use for the targets"}),disabled:!s},m.a.createElement("div",null,m.a.createElement(T.TextArea,{value:n,onChange:this.onCACertChange,rows:2,disabled:!s,placeholder:"CA Certificate"})))),m.a.createElement(T.Container,null,m.a.createElement(T.Field,{label:m.a.createElement(K,{name:"Client Certificate",help:"The client cert file for the targets"}),disabled:!s},m.a.createElement("div",null,m.a.createElement(T.TextArea,{value:a,onChange:this.onClientCertChange,rows:2,disabled:!s,placeholder:"Client Certificate"})))),m.a.createElement(T.Container,null,m.a.createElement(T.Field,{label:m.a.createElement(K,{name:"Client Key",help:"The client key file for the targets"}),disabled:!s},m.a.createElement("div",null,m.a.createElement(T.TextArea,{type:"password",value:r,onChange:this.onClientKeyChange,rows:2,disabled:!s,placeholder:"Client Key"})))))},t}(f.PureComponent),ne=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={headerMatches:t.props.headerMatches},t.onUpdate=function(){t.props.onChange(t.state.headerMatches)},t.onHeaderChange=function(e){return function(n){var a=[];t.state.headerMatches.forEach((function(t,r){r===e?a.push({header:n.target.value,regexp:t.regexp,allowMissing:t.allowMissing}):a.push(t)})),t.setState({headerMatches:a},t.onUpdate)}},t.onRegexpChange=function(e){return function(n){var a=[];t.state.headerMatches.forEach((function(t,r){r===e?a.push({header:t.header,regexp:n.target.value,allowMissing:t.allowMissing}):a.push(t)})),t.setState({headerMatches:a},t.onUpdate)}},t.onAllowMissingChange=function(e){return function(n){var a=[];t.state.headerMatches.forEach((function(t,n){n===e?a.push({header:t.header,regexp:t.regexp,allowMissing:!t.allowMissing}):a.push(t)})),t.setState({headerMatches:a},t.onUpdate)}},t.onHeaderMatchesDelete=function(e){return function(){var n,a=[];null===(n=t.state.headerMatches)||void 0===n||n.forEach((function(t,n){n!==e&&a.push(t)})),t.setState({headerMatches:a},t.onUpdate)}},t.onHeaderMatchesAdd=function(){var e=[];t.state.headerMatches.forEach((function(t){e.push(t)})),e.push({header:"",regexp:"",allowMissing:!1}),t.setState({headerMatches:e},t.onUpdate)},t}return Object(h.c)(t,e),t.prototype.render=function(){var e=this,t=this.state.headerMatches,n=this.props,a=n.isEditor,r=n.name,o=n.help;return m.a.createElement(T.Field,{label:m.a.createElement(K,{name:r,help:o}),disabled:!a},m.a.createElement(T.VerticalGroup,{justify:"space-between"},m.a.createElement(T.List,{items:t,renderItem:function(t,n){return m.a.createElement(T.HorizontalGroup,null,m.a.createElement(T.Input,{type:"text",placeholder:"header",value:t.header,onChange:e.onHeaderChange(n),disabled:!a}),m.a.createElement(T.Input,{type:"text",placeholder:"regexp",value:t.regexp,onChange:e.onRegexpChange(n),disabled:!a}),m.a.createElement(T.HorizontalGroup,null,m.a.createElement("span",null,"Allow Missing"),m.a.createElement(T.Container,{padding:"sm"},m.a.createElement(T.Switch,{title:"Allow Missing",value:t.allowMissing,onChange:e.onAllowMissingChange(n),disabled:!a}))),m.a.createElement(T.IconButton,{name:"minus-circle",onClick:e.onHeaderMatchesDelete(n),disabled:!a}))}}),m.a.createElement(T.Button,{onClick:this.onHeaderMatchesAdd,disabled:!a,variant:"secondary",size:"sm"},m.a.createElement(T.Icon,{name:"plus"}),"  Add Header Regexp")))},t}(f.PureComponent),ae=function(e){function t(){var t,n,r,o,l,c,u,d,p,f=e.apply(this,Object(h.e)(arguments))||this;return f.state={showValidation:!1,showAdvanced:!1,recordType:(null===(t=f.props.settings.dns)||void 0===t?void 0:t.recordType)||s.A,server:(null===(n=f.props.settings.dns)||void 0===n?void 0:n.server)||"8.8.8.8",ipVersion:(null===(r=f.props.settings.dns)||void 0===r?void 0:r.ipVersion)||a.V4,protocol:(null===(o=f.props.settings.dns)||void 0===o?void 0:o.protocol)||i.UDP,port:(null===(l=f.props.settings.dns)||void 0===l?void 0:l.port)||53,validRCodes:(null===(c=f.props.settings.dns)||void 0===c?void 0:c.validRCodes)||[],validateAnswerRRS:null===(u=f.props.settings.dns)||void 0===u?void 0:u.validateAnswerRRS,validateAuthorityRRS:null===(d=f.props.settings.dns)||void 0===d?void 0:d.validateAuthorityRRS,validateAdditionalRRS:null===(p=f.props.settings.dns)||void 0===p?void 0:p.validateAdditionalRRS},f.onUpdate=function(){var e=f.state;f.props.onUpdate({dns:e})},f.onIpVersionChange=function(e){f.setState({ipVersion:e.value||a.Any},f.onUpdate)},f.onProtocolChange=function(e){f.setState({protocol:e.value||i.UDP},f.onUpdate)},f.onPortChange=function(e){f.setState({port:e.target.valueAsNumber||53},f.onUpdate)},f.onServerChange=function(e){f.setState({server:e.target.value},f.onUpdate)},f.onRecordTypeChange=function(e){f.setState({recordType:e.value||s.A},f.onUpdate)},f.onShowAdvanced=function(e){f.setState({showAdvanced:!f.state.showAdvanced})},f.onShowValidation=function(e){f.setState({showValidation:!f.state.showValidation})},f.onValidRCodesChange=function(e){var t,n,a=[];try{for(var r=Object(h.f)(e.values()),o=r.next();!o.done;o=r.next()){var s=o.value;s.value&&a.push(s.value)}}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}f.setState({validRCodes:a},f.onUpdate)},f.onValidateAnswerChange=function(e){if(console.log("validateAnswer update.",e),e){var t={failIfMatchesRegexp:e.failIfMatchesRegexp,failIfNotMatchesRegexp:e.failIfNotMatchesRegexp};f.setState({validateAnswerRRS:t},f.onUpdate)}else f.setState({validateAnswerRRS:void 0},f.onUpdate)},f.onValidateAuthorityChange=function(e){if(e){var t={failIfMatchesRegexp:e.failIfMatchesRegexp,failIfNotMatchesRegexp:e.failIfNotMatchesRegexp};f.setState({validateAuthorityRRS:t},f.onUpdate)}else f.setState({validateAuthorityRRS:void 0},f.onUpdate)},f.onValidateAdditionalChange=function(e){if(e){var t={failIfMatchesRegexp:e.failIfMatchesRegexp,failIfNotMatchesRegexp:e.failIfNotMatchesRegexp};f.setState({validateAdditionalRRS:t},f.onUpdate)}else f.setState({validateAdditionalRRS:void 0},f.onUpdate)},f}return Object(h.c)(t,e),t.prototype.render=function(){var e=this.state,t=e.ipVersion,n=e.recordType,a=e.server,r=e.port,o=e.protocol,l=e.showAdvanced,c=e.showValidation,u=e.validRCodes,d=e.validateAnswerRRS,p=e.validateAuthorityRRS,h=e.validateAdditionalRRS,f=this.props.isEditor,g=[{label:s.A,value:s.A},{label:s.AAAA,value:s.AAAA},{label:s.CNAME,value:s.CNAME},{label:s.MX,value:s.MX},{label:s.NS,value:s.NS},{label:s.SOA,value:s.SOA},{label:s.TXT,value:s.TXT},{label:s.PTR,value:s.PTR},{label:s.SRV,value:s.SRV}],v=[{label:i.UDP,value:i.UDP},{label:i.TCP,value:i.TCP}];return m.a.createElement(T.Container,null,m.a.createElement(T.HorizontalGroup,null,m.a.createElement(T.Field,{label:m.a.createElement(K,{name:"Record Type",help:"DNS record type to query for"}),disabled:!f},m.a.createElement(T.Select,{value:n,options:g,onChange:this.onRecordTypeChange})),m.a.createElement(T.Field,{label:m.a.createElement(K,{name:"Server",help:"Address of server to query"}),disabled:!f},m.a.createElement(T.Input,{value:a,type:"text",placeholder:"server",onChange:this.onServerChange})),m.a.createElement(T.Field,{label:m.a.createElement(K,{name:"Protocol",help:"Transport protocol to use"}),disabled:!f},m.a.createElement(T.Select,{value:o,options:v,onChange:this.onProtocolChange})),m.a.createElement(T.Field,{label:m.a.createElement(K,{name:"Port",help:"port on server to query"}),disabled:!f},m.a.createElement(T.Input,{value:r,type:"number",placeholder:"port",onChange:this.onPortChange}))),m.a.createElement(T.Collapse,{label:"Validation",collapsible:!0,onToggle:this.onShowValidation,isOpen:c},m.a.createElement(T.HorizontalGroup,null,m.a.createElement(T.Field,{label:m.a.createElement(K,{name:"Valid Response Codes",help:"List of valid response codes"}),disabled:!f},m.a.createElement(T.MultiSelect,{value:u,options:[{label:"NOERROR",value:"NOERROR"}],onChange:this.onValidRCodesChange}))),m.a.createElement(re,{name:"Validate Answer",help:"Validate entries in the Answer section of the DNS response",validations:d,onChange:this.onValidateAnswerChange,isEditor:f}),m.a.createElement(re,{name:"Validate Authority",help:"Validate entries in the Authority section of the DNS response",validations:p,onChange:this.onValidateAuthorityChange,isEditor:f}),m.a.createElement(re,{name:"Validate Additional",help:"Validate entries in the Additional section of the DNS response",validations:h,onChange:this.onValidateAdditionalChange,isEditor:f})),m.a.createElement(T.Collapse,{label:"Advanced Options",collapsible:!0,onToggle:this.onShowAdvanced,isOpen:l},m.a.createElement(T.HorizontalGroup,null,m.a.createElement("div",null,m.a.createElement(T.Field,{label:m.a.createElement(K,{name:"IP Version",help:"The IP protocol of the ICMP request"}),disabled:!f},m.a.createElement(T.Select,{value:t,options:$,onChange:this.onIpVersionChange}))))))},t}(f.PureComponent),re=function(e){function t(){var t,n,a=e.apply(this,Object(h.e)(arguments))||this;return a.state={failIfMatchesRegexp:(null===(t=a.props.validations)||void 0===t?void 0:t.failIfMatchesRegexp)||[],failIfNotMatchesRegexp:(null===(n=a.props.validations)||void 0===n?void 0:n.failIfNotMatchesRegexp)||[]},a.onUpdate=function(){var e={failIfMatchesRegexp:a.state.failIfMatchesRegexp,failIfNotMatchesRegexp:a.state.failIfNotMatchesRegexp};a.props.onChange(e)},a.onFailIfMatchesRegexpChange=function(e){return function(t){var n=[];a.state.failIfMatchesRegexp.forEach((function(a,r){r===e?n.push(t.target.value):n.push(a)})),a.setState({failIfMatchesRegexp:n},a.onUpdate)}},a.onFailIfNotMatchesRegexpChange=function(e){return function(t){var n=[];a.state.failIfNotMatchesRegexp.forEach((function(a,r){r===e?n.push(t.target.value):n.push(a)})),a.setState({failIfNotMatchesRegexp:n},a.onUpdate)}},a.onFailIfMatchesRegexpDelete=function(e){return function(){var t,n=[];null===(t=a.state.failIfMatchesRegexp)||void 0===t||t.forEach((function(t,a){a!==e&&n.push(t)})),a.setState({failIfMatchesRegexp:n},a.onUpdate)}},a.onFailIfNotMatchesRegexpDelete=function(e){return function(){var t,n=[];null===(t=a.state.failIfNotMatchesRegexp)||void 0===t||t.forEach((function(t,a){a!==e&&n.push(t)})),a.setState({failIfNotMatchesRegexp:n},a.onUpdate)}},a.onFailIfMatchesRegexpAdd=function(){var e=[];a.state.failIfMatchesRegexp.forEach((function(t){e.push(t)})),e.push(""),a.setState({failIfMatchesRegexp:e},a.onUpdate)},a.onFailIfNotMatchesRegexpAdd=function(){var e=[];a.state.failIfNotMatchesRegexp.forEach((function(t){e.push(t)})),e.push(""),a.setState({failIfNotMatchesRegexp:e},a.onUpdate)},a}return Object(h.c)(t,e),t.prototype.render=function(){var e=this,t=this.state,n=t.failIfMatchesRegexp,a=t.failIfNotMatchesRegexp,r=this.props,o=r.isEditor,s=r.name,i=r.help;return m.a.createElement(T.Container,null,m.a.createElement(T.HorizontalGroup,null,m.a.createElement(T.Field,{label:m.a.createElement(K,{name:s+" matches",help:i+" match"}),disabled:!o},m.a.createElement(T.Container,null,m.a.createElement(T.List,{items:n,renderItem:function(t,n){return m.a.createElement(T.HorizontalGroup,null,m.a.createElement(T.Input,{type:"text",placeholder:"regexp",value:t,onChange:e.onFailIfMatchesRegexpChange(n),disabled:!o}),m.a.createElement(T.IconButton,{name:"minus-circle",onClick:e.onFailIfMatchesRegexpDelete(n),disabled:!o}))}}),m.a.createElement(T.IconButton,{name:"plus-circle",onClick:this.onFailIfMatchesRegexpAdd,disabled:!o}))),m.a.createElement(T.Field,{label:m.a.createElement(K,{name:s+" doesn't match",help:i+" don't match"}),disabled:!o},m.a.createElement(T.Container,null,m.a.createElement(T.List,{items:a,renderItem:function(t,n){return m.a.createElement(T.HorizontalGroup,null,m.a.createElement(T.Input,{type:"text",placeholder:"regexp",value:t,onChange:e.onFailIfNotMatchesRegexpChange(n),disabled:!o}),m.a.createElement(T.IconButton,{name:"minus-circle",onClick:e.onFailIfNotMatchesRegexpDelete(n),disabled:!o}))}}),m.a.createElement(T.IconButton,{name:"plus-circle",onClick:this.onFailIfNotMatchesRegexpAdd,disabled:!o})))))},t}(f.PureComponent),oe=function(e){function t(){var t,n,r,o,s=e.apply(this,Object(h.e)(arguments))||this;return s.state={ipVersion:(null===(t=s.props.settings.tcp)||void 0===t?void 0:t.ipVersion)||a.V4,tls:(null===(n=s.props.settings.tcp)||void 0===n?void 0:n.tls)||!1,tlsConfig:null===(r=s.props.settings.tcp)||void 0===r?void 0:r.tlsConfig,queryResponse:null===(o=s.props.settings.tcp)||void 0===o?void 0:o.queryResponse,showQueryResponse:!1,showAdvanced:!1,showTLS:!1},s.onUpdate=function(){var e=s.state;s.props.onUpdate({tcp:e})},s.onIpVersionChange=function(e){s.setState({ipVersion:e.value||a.Any},s.onUpdate)},s.onToggleTLS=function(e){s.setState({showTLS:!s.state.showTLS},s.onUpdate)},s.onTLSChange=function(e){s.setState({tls:!s.state.tls},s.onUpdate)},s.onTLSCOnfigChange=function(e){s.setState({tlsConfig:e},s.onUpdate)},s.onShowAdvanced=function(e){s.setState({showAdvanced:!s.state.showAdvanced})},s.onShowQueryResponse=function(e){s.setState({showQueryResponse:!s.state.showQueryResponse})},s.onQueryResponsesUpdate=function(e){var t=[];s.state.queryResponse?e.forEach((function(e){t.push(e)})):t=e,s.setState({queryResponse:t},s.onUpdate)},s}return Object(h.c)(t,e),t.prototype.render=function(){var e=this.state,t=e.ipVersion,n=e.tls,a=e.showTLS,r=e.showQueryResponse,o=e.showAdvanced,s=e.tlsConfig,i=e.queryResponse,l=this.props.isEditor;return m.a.createElement(T.Container,null,m.a.createElement(T.Field,{label:m.a.createElement(K,{name:"Use TLS",help:"Whether or not TLS is used when the connection is initiated."}),disabled:!l},m.a.createElement(T.Container,{padding:"sm"},m.a.createElement(T.Switch,{title:"Use TLS",value:n,onChange:this.onTLSChange,disabled:!l}))),m.a.createElement(T.Collapse,{label:"Query/Response",collapsible:!0,onToggle:this.onShowQueryResponse,isOpen:r},m.a.createElement(T.Container,null,m.a.createElement(se,{queryResponses:i,isEditor:l,onChange:this.onQueryResponsesUpdate}))),m.a.createElement(T.Collapse,{label:"TLS Config",collapsible:!0,onToggle:this.onToggleTLS,isOpen:a},m.a.createElement(te,{onChange:this.onTLSCOnfigChange,isEditor:l,tlsConfig:s})),m.a.createElement(T.Collapse,{label:"Advanced Options",collapsible:!0,onToggle:this.onShowAdvanced,isOpen:o},m.a.createElement(T.HorizontalGroup,null,m.a.createElement("div",null,m.a.createElement(T.Field,{label:m.a.createElement(K,{name:"IP Version",help:"The IP protocol of the ICMP request"}),disabled:!l},m.a.createElement(T.Select,{value:t,options:$,onChange:this.onIpVersionChange}))))))},t}(f.PureComponent),se=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={queryResponses:(t.props.queryResponses||[]).map((function(e){return{expect:atob(e.expect),send:atob(e.send),startTLS:e.startTLS}}))},t.onUpdate=function(){var e=[];t.state.queryResponses.forEach((function(t){e.push({expect:btoa(t.expect),send:btoa(t.send),startTLS:t.startTLS})})),t.props.onChange(e)},t.onSendChange=function(e){return function(n){var a=[];t.state.queryResponses.forEach((function(t,r){r===e?a.push({send:n.target.value,expect:t.expect,startTLS:t.startTLS}):a.push(t)})),t.setState({queryResponses:a},t.onUpdate)}},t.onExpectChange=function(e){return function(n){var a=[];t.state.queryResponses.forEach((function(t,r){r===e?a.push({send:t.send,expect:n.target.value,startTLS:t.startTLS}):a.push(t)})),t.setState({queryResponses:a},t.onUpdate)}},t.onStartTLSChange=function(e){return function(n){var a=[];t.state.queryResponses.forEach((function(t,n){n===e?a.push({send:t.send,expect:t.expect,startTLS:!t.startTLS}):a.push(t)})),t.setState({queryResponses:a},t.onUpdate)}},t.onQueryResponseDelete=function(e){return function(){var n=[];t.state.queryResponses.forEach((function(t,a){a!==e&&n.push(t)})),t.setState({queryResponses:n},t.onUpdate)}},t.onQueryResponseAdd=function(){var e=[];t.state.queryResponses.forEach((function(t){e.push(t)})),e.push({send:"",expect:"",startTLS:!1}),t.setState({queryResponses:e},t.onUpdate)},t}return Object(h.c)(t,e),t.prototype.render=function(){var e=this,t=this.state.queryResponses,n=this.props.isEditor;return m.a.createElement(T.Field,{label:m.a.createElement(K,{name:"Query/Response",help:"The query sent in the TCP probe and the expected associated response. StartTLS upgrades TCP connection to TLS."}),disabled:!n},m.a.createElement(T.Container,null,m.a.createElement(T.List,{items:t,renderItem:function(t,a){return m.a.createElement(T.HorizontalGroup,null,m.a.createElement(T.Input,{type:"text",placeholder:"response to expect",value:t.expect,onChange:e.onExpectChange(a),disabled:!n}),m.a.createElement(T.TextArea,{type:"text",placeholder:"data to send",rows:1,value:t.send,onChange:e.onSendChange(a),disabled:!n}),m.a.createElement(T.HorizontalGroup,null,m.a.createElement("span",null,"StartTLS"),m.a.createElement(T.Container,{padding:"sm"},m.a.createElement(T.Switch,{title:"StartTLS",value:t.startTLS,onChange:e.onStartTLSChange(a),disabled:!n}))),m.a.createElement(T.IconButton,{name:"minus-circle",onClick:e.onQueryResponseDelete(a),disabled:!n}))}}),m.a.createElement(T.IconButton,{name:"plus-circle",onClick:this.onQueryResponseAdd,disabled:!n})))},t}(f.PureComponent),ie=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={showDeleteModal:!1,probes:[],targetHelp:{example:""}},t.showDeleteCheckModal=function(e){return function(){t.setState({showDeleteModal:e})}},t.onRemoveCheck=function(){return Object(h.b)(t,void 0,void 0,(function(){var e,t;return Object(h.d)(this,(function(n){return e=this.props.check.id||0,this.props.check.id?(t=this.props.instance.deleteCheck(e),console.log("Remove Check",e,t),this.props.onReturn(!0),[2]):[2]}))}))},t.onLabelsUpdate=function(e){var n=Object(h.a)({},t.state.check);n.labels=e,t.setState({check:n})},t.onProbesUpdate=function(e){var n=t.state.check;n&&(n.probes=e,t.setState({check:n}))},t.onSettingsUpdate=function(e){var n=t.state.check;n&&(n.settings=e,t.setState({check:n}))},t.onSetType=function(e){var n=Object(h.a)({},t.state.check);if(e.value){var a=e.value,r=S(a);if(r){n.settings=r;var o=t.targetHelpText(a);t.setState({check:n,targetHelp:o,typeOfCheck:a})}}},t.onJobUpdate=function(e){var n=Object(h.a)({},t.state.check);n.job=e.target.value,t.setState({check:n})},t.onTargetUpdate=function(e){var n=Object(h.a)({},t.state.check);n.target=e.target.value,t.setState({check:n})},t.onFrequencyUpdate=function(e){var n=Object(h.a)({},t.state.check);n.frequency=1e3*e.target.valueAsNumber,t.setState({check:n})},t.onTimeoutUpdate=function(e){var n=Object(h.a)({},t.state.check);n.timeout=1e3*e.target.valueAsNumber,t.setState({check:n})},t.onSave=function(){return Object(h.b)(t,void 0,void 0,(function(){var e,t,n;return Object(h.d)(this,(function(a){switch(a.label){case 0:return e=this.props.instance,(t=this.state.check)?t.id?(console.log("UPDATE",t,e),[4,e.updateCheck(t)]):[3,2]:[2];case 1:return n=a.sent(),console.log("got",n),[3,4];case 2:return console.log("ADD",t),[4,e.addCheck(t)];case 3:n=a.sent(),console.log("got",n),a.label=4;case 4:return this.props.onReturn(!0),[2]}}))}))},t.onEnableChange=function(e){var n=Object(h.a)({},t.state.check);n.enabled=!n.enabled,t.setState({check:n})},t.onBack=function(){t.props.onReturn(!1)},t}return Object(h.c)(t,e),t.prototype.componentDidMount=function(){return Object(h.b)(this,void 0,void 0,(function(){var e,t,n,a,r;return Object(h.d)(this,(function(o){switch(o.label){case 0:return e=this.props.instance,t=Object(h.a)({},this.props.check),[4,e.listProbes()];case 1:return n=o.sent(),a=C(t.settings),r=this.targetHelpText(a),this.setState({check:t,typeOfCheck:a,probes:n,targetHelp:r}),[2]}}))}))},t.prototype.targetHelpText=function(e){if(!e)return{text:"",example:""};var t;switch(e){case l.HTTP:t={text:"full url of endpoint to probe",example:"https://grafana.com/"};break;case l.PING:t={text:"hostname of endpoint to ping",example:"grafana.com"};break;case l.DNS:t={text:"name of record to query",example:"grafana.com"};break;case l.TCP:t={text:"host:port to connect to",example:"grafana.com:80"}}return t},t.prototype.render=function(){var e=this.state,t=e.check,n=e.showDeleteModal,a=e.probes,r=e.targetHelp,o=e.typeOfCheck;if(!t||0===a.length)return m.a.createElement("div",null,"Loading...");var s="Edit Check";t.id||(s="Add Check");var i=y(c.EDITOR),u=[{label:"HTTP",value:l.HTTP},{label:"PING",value:l.PING},{label:"DNS",value:l.DNS},{label:"TCP",value:l.TCP}];return m.a.createElement(T.Container,null,m.a.createElement(T.Legend,null,s),m.a.createElement(T.VerticalGroup,null,m.a.createElement(T.HorizontalGroup,null,m.a.createElement(T.Field,{label:m.a.createElement(K,{name:"Check Type"}),disabled:!!t.id,required:!0},m.a.createElement(T.Select,{value:o,options:u,onChange:this.onSetType})),m.a.createElement(T.Field,{label:m.a.createElement(K,{name:"Job Name",help:"job name to assign to this check. 'Job name + target' must be unique."}),disabled:!i,invalid:!V(t.job)},m.a.createElement(T.Input,{type:"string",placeholder:"job",value:t.job,onChange:this.onJobUpdate,required:!0})),m.a.createElement(T.Field,{label:m.a.createElement(K,{name:"Target",help:r.text}),disabled:!i,invalid:!F(t.target)},m.a.createElement(T.Input,{type:"string",placeholder:r.example,value:t.target,onChange:this.onTargetUpdate,width:60,required:!0})),m.a.createElement(T.Field,{label:m.a.createElement(K,{name:"Enabled",help:"whether this check should run."}),disabled:!i},m.a.createElement(T.Container,{padding:"sm"},m.a.createElement(T.Switch,{value:t.enabled,onChange:this.onEnableChange,disabled:!i})))),m.a.createElement(T.HorizontalGroup,null,m.a.createElement(T.Field,{label:m.a.createElement(K,{name:"Frequency",help:"How frequently the check will run."}),disabled:!i,invalid:!H(t.frequency)},m.a.createElement(T.Input,{label:"Frequency",type:"number",step:10,placeholder:"60",value:t.frequency/1e3||60,onChange:this.onFrequencyUpdate,suffix:"seconds",max:120,min:10})),m.a.createElement(T.Field,{label:m.a.createElement(K,{name:"Timeout",help:"maximum execution time for a check"}),disabled:!i,invalid:!B(t.timeout)},m.a.createElement(T.Input,{label:"Timeout",type:"number",step:.1,placeholder:"5",value:t.timeout/1e3||5,onChange:this.onTimeoutUpdate,suffix:"seconds",max:10,min:1}))),m.a.createElement(T.Field,{label:m.a.createElement(K,{name:"Probe Locations",help:"select the locations where this target should be monitored from."}),disabled:!i,invalid:!J(t.probes)},m.a.createElement(ce,{probes:t.probes,availableProbes:a,onUpdate:this.onProbesUpdate,isEditor:i})),m.a.createElement(T.Field,{label:m.a.createElement(K,{name:"Labels",help:"add custom labels to be included with collected metrics and logs."}),disabled:!i,invalid:!q(t.labels)},m.a.createElement(W,{labels:t.labels,onUpdate:this.onLabelsUpdate,isEditor:i,type:"Label"}))),m.a.createElement(T.Container,null,m.a.createElement("br",null),m.a.createElement("h3",{className:"page-heading"},o.toLocaleUpperCase()," Settings"),m.a.createElement(le,{settings:t.settings,typeOfCheck:o||l.HTTP,onUpdate:this.onSettingsUpdate,isEditor:i}),m.a.createElement(T.HorizontalGroup,null,m.a.createElement(T.Button,{onClick:this.onSave,disabled:!i||!L(t)},"Save"),t.id&&m.a.createElement(T.Button,{variant:"destructive",onClick:this.showDeleteCheckModal(!0),disabled:!i},"Delete Check"),m.a.createElement(T.ConfirmModal,{isOpen:n,title:"Delete check",body:"Are you sure you want to delete this check?",confirmText:"Delete check",onConfirm:this.onRemoveCheck,onDismiss:this.showDeleteCheckModal(!1)}),m.a.createElement("a",{onClick:this.onBack},"Back"))))},t}(f.PureComponent),le=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={},t.onUpdate=function(){t.props.onUpdate(t.state.settings)},t.onJsonChange=function(e){var n={};n[t.props.typeOfCheck]=JSON.parse(e.target.value),t.setState({settings:n},t.onUpdate)},t.onSettingsChange=function(e){t.setState({settings:e},t.onUpdate)},t}return Object(h.c)(t,e),t.prototype.componentDidMount=function(){var e=this.props.settings;this.setState({settings:e})},t.prototype.componentDidUpdate=function(e){var t=this.props,n=t.settings;t.typeOfCheck!==e.typeOfCheck&&this.setState({settings:n})},t.prototype.render=function(){var e=this.state.settings;if(!e)return m.a.createElement("div",null,"Loading....");var t=this.props.isEditor;switch(this.props.typeOfCheck){case l.PING:return m.a.createElement(Z,{settings:e,onUpdate:this.onSettingsChange,isEditor:t});case l.HTTP:return m.a.createElement(Y,{settings:e,onUpdate:this.onSettingsChange,isEditor:t});case l.DNS:return m.a.createElement(ae,{settings:e,onUpdate:this.onSettingsChange,isEditor:t});case l.TCP:return m.a.createElement(oe,{settings:e,onUpdate:this.onSettingsChange,isEditor:t})}},t}(f.PureComponent),ce=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={probes:t.props.probes||[],probeStr:t.props.probes.join(",")},t.onChange=function(e){var n,a,r=[];try{for(var o=Object(h.f)(e.values()),s=o.next();!s.done;s=o.next()){var i=s.value;i.value&&r.push(i.value)}}catch(e){n={error:e}}finally{try{s&&!s.done&&(a=o.return)&&a.call(o)}finally{if(n)throw n.error}}console.log("probes updated to:",r);var l=r.join(",");t.setState({probes:r,probeStr:l},t.onUpdate)},t.onUpdate=function(){t.props.onUpdate(t.state.probes)},t}return Object(h.c)(t,e),t.prototype.render=function(){var e,t,n,a,r=this.state.probes,o=this.props,s=o.availableProbes,i=o.isEditor,l=[];try{for(var c=Object(h.f)(s),u=c.next();!u.done;u=c.next()){var d=u.value;l.push({label:d.name,value:d.id,labels:d.labels,online:d.online})}}catch(t){e={error:t}}finally{try{u&&!u.done&&(t=c.return)&&t.call(c)}finally{if(e)throw e.error}}var p=[],f=function(e){var t=l.find((function(t){return t.value===e}));t&&p.push(t)};try{for(var g=Object(h.f)(r),v=g.next();!v.done;v=g.next()){f(d=v.value)}}catch(e){n={error:e}}finally{try{v&&!v.done&&(a=g.return)&&a.call(g)}finally{if(n)throw n.error}}return m.a.createElement("div",null,m.a.createElement(T.MultiSelect,{options:l,value:p,onChange:this.onChange,disabled:!i,invalid:!J(r)}))},t}(f.PureComponent),ue=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={lastUpdate:0,value:{numeric:0,title:"Uptime",text:"loading..."},points:[]},t}return Object(h.c)(t,e),t.prototype.componentDidMount=function(){return Object(h.b)(this,void 0,void 0,(function(){var e,t,n,a,r,o,s,i;return Object(h.d)(this,(function(l){for(r in e=this.props,t=e.labelNames,n=e.labelValues,a=[],t)o=t[r],s=n[r],a.push(o+'="'+s+'"');return i=a.join(","),this.setState({filter:i},this.queryUptime),[2]}))}))},t.prototype.queryUptime=function(){return Object(h.b)(this,void 0,void 0,(function(){var e,t,n,a,r,o,s,i,l,c,d=this;return Object(h.d)(this,(function(p){switch(p.label){case 0:return e=this.props,t=e.ds,n=e.sparkline,(a=this.state.filter)?(r=Object(u.getBackendSrv)(),o=Math.floor(Date.now()/1e3),[4,r.datasourceRequest({method:"GET",url:t.url+"/api/v1/query",params:{query:"sum(rate(probe_success_sum{"+a+"}[3h])) / sum(rate(probe_success_count{"+a+"}[3h]))",time:o}})]):[2];case 1:return(s=p.sent()).ok?(i={numeric:0,title:"Uptime",text:"loading..."},s.data.data.result.length<1?(i.text="N/A",this.setState({value:i,lastUpdate:o}),[2]):(l=100*parseFloat(s.data.data.result[0].value[1]),c="green",l<99&&(c="red"),i.color=c,i.numeric=l,i.text=l.toFixed(2)+"%",this.setState({value:i,lastUpdate:o},(function(){n&&d.queryHistory()})),[2])):(console.log(s),[2])}}))}))},t.prototype.queryHistory=function(){return Object(h.b)(this,void 0,void 0,(function(){var e,t,n,a,r,o,s,i,l,c,d,p;return Object(h.d)(this,(function(f){switch(f.label){case 0:return e=this.props.ds,(t=this.state.filter)?(n=Object(u.getBackendSrv)(),a=this.state.lastUpdate+1,[4,n.datasourceRequest({method:"POST",url:e.url+"/api/v1/query_range",params:{query:"100 * sum(rate(probe_success_sum{"+t+"}[10m])) / sum(rate(probe_success_count{"+t+"}[10m]))",start:a-10800,end:a,step:600}})]):[2];case 1:if(!(r=f.sent()).ok)return console.log(r),[2];if(o=[],r.data.data.result.length<1)return console.log(r.data),[2];s=0;try{for(i=Object(h.f)(r.data.data.result[0].values),l=i.next();!l.done;l=i.next())c=l.value,o.push([s,parseFloat(c[1])]),s++}catch(e){d={error:e}}finally{try{l&&!l.done&&(p=i.return)&&p.call(i)}finally{if(d)throw d.error}}return this.setState({points:o,lastUpdate:a+1}),[2]}}))}))},t.prototype.render=function(){var e=this.state,t=e.value,n=e.points,a=this.props,r=a.height,o=a.width,s=a.sparkline,i=a.onClick,l=void 0;return s&&n.length>0&&(l={yMin:0,yMax:150,data:n}),m.a.createElement(T.Container,null,m.a.createElement(T.BigValue,{theme:u.config.theme,colorMode:T.BigValueColorMode.Value,height:r,width:o,graphMode:T.BigValueGraphMode.Area,value:t,sparkline:l,onClick:i}))},t}(f.PureComponent),de=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={iconName:"heart",className:"paused"},t}return Object(h.c)(t,e),t.prototype.componentDidMount=function(){return Object(h.b)(this,void 0,void 0,(function(){return Object(h.d)(this,(function(e){switch(e.label){case 0:return this.props.check.enabled?[4,this.queryUptime()]:(this.setState({iconName:"pause"}),[2]);case 1:return e.sent(),[2]}}))}))},t.prototype.queryUptime=function(){return Object(h.b)(this,void 0,void 0,(function(){var e,t,n,a,r,o,s,i,l,c;return Object(h.d)(this,(function(d){switch(d.label){case 0:return e=this.props,t=e.ds,n=e.check,a='instance="'+n.target+'", job="'+n.job+'"',r=Object(u.getBackendSrv)(),o=Math.floor(Date.now()/1e3),[4,r.datasourceRequest({method:"GET",url:t.url+"/api/v1/query",params:{query:"sum(probe_success{"+a+"}) / count(probe_success{"+a+"})",time:o}})];case 1:return(s=d.sent()).ok?(i="heart",l="ok",s.data.data.result.length<1?(i="question-circle",l="paused",this.setState({iconName:i,className:l}),[2]):((c=100*parseFloat(s.data.data.result[0].value[1]))<99&&(l="warning"),c<50&&(l="critical",i="heart-break"),this.setState({iconName:i,className:l}),[2])):(console.log(s),[2])}}))}))},t.prototype.render=function(){var e=this.state,t=e.iconName,n=e.className;return m.a.createElement(T.Icon,{name:t,size:"xxl",className:"alert-rule-item__icon alert-state-"+n})},t}(f.PureComponent),pe=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={checks:[],filteredChecks:[],addNew:!1,typeFilter:"all",searchFilter:"",totalPages:1,currentPage:1,checksPerPage:t.props.checksPerPage||15},t.onSelectCheck=function(e){Object(u.getLocationSrv)().update({partial:!0,query:{id:e}})},t.showDashboard=function(e){return function(n){n.stopPropagation();var a=t.props.instance,r=Object.keys(e.settings)[0],o=w(r,a.worldping);if(o){var s="d/"+o.uid,i={"var-instance":e.target,"var-job":e.job};Object(u.getLocationSrv)().update({partial:!1,path:s,query:i})}else console.log("dashboard not found.",r)}},t.onTypeFilterChanged=function(e){e.value&&t.setState({typeFilter:e.value,currentPage:1},t.filterChecks)},t.onSearchFilterChange=function(e){t.setState({searchFilter:e},t.filterChecks)},t.changePage=function(e){console.log("setting current page to",e),t.setState({currentPage:e},t.filterChecks)},t.onAddNew=function(){t.setState({addNew:!0})},t.onRefresh=function(){return Object(h.b)(t,void 0,void 0,(function(){var e;return Object(h.d)(this,(function(t){switch(t.label){case 0:return[4,this.props.instance.worldping.listChecks()];case 1:return e=t.sent(),this.setState({checks:e}),[2]}}))}))},t.onGoBack=function(e){console.log("go back"),t.setState({addNew:!1}),e&&t.onRefresh(),Object(u.getLocationSrv)().update({partial:!0,query:{id:""}})},t}return Object(h.c)(t,e),t.prototype.componentDidMount=function(){return Object(h.b)(this,void 0,void 0,(function(){var e,t,n,a,r,o,s,i,l;return Object(h.d)(this,(function(c){switch(c.label){case 0:return e=this.props,t=e.instance,n=e.id,a=this.state.checksPerPage,[4,t.worldping.listChecks()];case 1:return r=c.sent(),o=r.sort((function(e,t){return t.job.localeCompare(e.job)})),s=Math.ceil(o.length/a),i=n?parseInt(n,10):-1,l=r.find((function(e){return e.id===i})),this.setState({checks:o,check:l,totalPages:s,filteredChecks:o.slice(0,a)}),[2]}}))}))},t.prototype.componentDidUpdate=function(e){if(this.props.id!==e.id){var t=this.props.id,n=t?parseInt(t,10):-1,a=this.state.checks.find((function(e){return e.id===n}));this.setState({check:a})}},t.prototype.formatLabels=function(e){return e.map((function(e){return m.a.createElement("div",null,e.name,"=",e.value)}))},t.prototype.filterChecks=function(){var e=this.state,t=e.typeFilter,n=e.searchFilter,a=e.currentPage,r=e.checks,o=e.checksPerPage,s=r.filter((function(e){return"all"===t||Object.keys(e.settings)[0]===t})).filter((function(e){var t,a,r,o;if(!n)return!0;if(n.split("=").length>1){var s=n.split("=",2),i=s[0],l=s[1];switch(i){case"target":return e.target.match(l);case"job":return e.job.match(l);default:try{for(var c=Object(h.f)(e.labels),u=c.next();!u.done;u=c.next()){if((f=u.value).name===i&&f.value.match(l))return!0}}catch(e){t={error:e}}finally{try{u&&!u.done&&(a=c.return)&&a.call(c)}finally{if(t)throw t.error}}}return!1}if(e.job.match(n)||e.target.match(n))return!0;try{for(var d=Object(h.f)(e.labels),p=d.next();!p.done;p=d.next()){var f;if((f=p.value).name.match(n)||f.value.match(n))return!0}}catch(e){r={error:e}}finally{try{p&&!p.done&&(o=d.return)&&o.call(d)}finally{if(r)throw r.error}}return!1})),i=Math.ceil(s.length/o);this.setState({totalPages:i,filteredChecks:s.slice(o*(a-1),a*o)})},t.prototype.renderCheckList=function(){var e=this,t=this.state,n=t.checks,a=t.typeFilter,r=t.searchFilter,o=t.filteredChecks,s=t.totalPages,i=t.currentPage,u=this.props.instance;if(!n)return null;var d=[{label:"All",value:"all"},{label:"HTTP",value:l.HTTP},{label:"PING",value:l.PING},{label:"DNS",value:l.DNS},{label:"TCP",value:l.TCP}];return m.a.createElement("div",null,m.a.createElement("div",{className:"page-action-bar"},m.a.createElement("div",{className:"gf-form gf-form--grow"},m.a.createElement(T.Input,{autoFocus:!0,prefix:m.a.createElement(T.Icon,{name:"search"}),width:40,type:"text",value:r?Object(p.unEscapeStringFromRegex)(r):"",onChange:function(t){return e.onSearchFilterChange(Object(p.escapeStringForRegex)(t.currentTarget.value))},placeholder:"search checks"})),m.a.createElement("div",{className:"gf-form"},m.a.createElement("label",{className:"gf-form-label"},"Types"),m.a.createElement("div",{className:"width-13"},m.a.createElement(T.Select,{options:d,onChange:this.onTypeFilterChanged,value:a}))),m.a.createElement("div",{className:"page-action-bar__spacer"}),y(c.EDITOR)&&m.a.createElement(T.Button,{variant:"secondary",onClick:this.onAddNew},"New Check")),m.a.createElement("section",{className:"card-section card-list-layout-list"},m.a.createElement("ol",{className:"card-list"},o.map((function(t){var n=t.id||0;if(t.id){var a=Object.keys(t.settings)[0];return m.a.createElement("li",{className:"card-item-wrapper"},m.a.createElement("a",{className:"card-item",onClick:function(){return e.onSelectCheck(n)}},m.a.createElement(T.HorizontalGroup,{justify:"space-between"},m.a.createElement("div",{className:"card-item-body"},m.a.createElement("figure",{className:"card-item-figure"},m.a.createElement(de,{check:t,ds:u.worldping.getMetricsDS()})),m.a.createElement(T.VerticalGroup,null,m.a.createElement("div",{className:"card-item-name"},t.target),m.a.createElement("div",{className:"card-item-sub-name"},t.job))),m.a.createElement(T.HorizontalGroup,{justify:"flex-end"},m.a.createElement("div",{className:"card-item-header"},m.a.createElement("div",{className:"card-item-type"},a),e.formatLabels(t.labels)),m.a.createElement(T.Container,{margin:"lg"},m.a.createElement("a",{onClick:e.showDashboard(t)},m.a.createElement(T.Icon,{name:"apps",size:"xl"}))),m.a.createElement(ue,{labelNames:["instance","job"],labelValues:[t.target,t.job],ds:u.worldping.getMetricsDS(),height:70,width:150,sparkline:!1})))))}})))),s>1&&m.a.createElement(T.Pagination,{numberOfPages:s,currentPage:i,onNavigate:this.changePage}))},t.prototype.render=function(){var e=this.props.instance,t=this.state,n=t.check,r=t.addNew;if(!e)return m.a.createElement("div",null,"Loading...");if(n)return m.a.createElement(ie,{check:n,instance:e.worldping,onReturn:this.onGoBack});if(r){var o={job:"worldping",target:"",frequency:6e4,timeout:2500,enabled:!0,labels:[],probes:[],settings:{ping:{ipVersion:a.V4,dontFragment:!1}}};return m.a.createElement(ie,{check:o,instance:e.worldping,onReturn:this.onGoBack})}return m.a.createElement("div",null,this.renderCheckList())},t}(f.PureComponent),he=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={showDeleteModal:!1,showTokenModal:!1,showResetModal:!1,probeToken:""},t.showDeleteProbeModal=function(e){return function(){t.setState({showDeleteModal:e})}},t.showTokenModal=function(e){return function(){t.setState({showTokenModal:e})}},t.showResetModal=function(e){return function(){t.setState({showResetModal:e})}},t.onRemoveProbe=function(){return Object(h.b)(t,void 0,void 0,(function(){var e,t;return Object(h.d)(this,(function(n){return e=this.props.probe.id||0,this.props.probe.id?(t=this.props.instance.deleteProbe(e),console.log("Remove Probe",e,t),this.props.onReturn(!0),[2]):[2]}))}))},t.onLabelsUpdate=function(e){var n=Object(h.a)({},t.state.probe);n.labels=e,t.setState({probe:n})},t.onLatUpdate=function(e){var n=Object(h.a)({},t.state.probe);n.latitude=e.target.valueAsNumber,t.setState({probe:n})},t.onLongUpdate=function(e){var n=Object(h.a)({},t.state.probe);n.longitude=e.target.valueAsNumber,t.setState({probe:n})},t.onNameUpdate=function(e){var n=Object(h.a)({},t.state.probe);n.name=e.target.value,t.setState({probe:n})},t.onSave=function(){return Object(h.b)(t,void 0,void 0,(function(){var e,t,n;return Object(h.d)(this,(function(a){switch(a.label){case 0:return e=this.props.instance,(t=this.state.probe)?t.id?(console.log("UPDATE",t,e),[4,e.updateProbe(t)]):[3,2]:[2];case 1:return n=a.sent(),console.log("got",n),this.props.onReturn(!0),[3,4];case 2:return console.log("ADD",t),[4,e.addProbe(t)];case 3:n=a.sent(),this.setState({showTokenModal:!0,probeToken:n.token}),a.label=4;case 4:return[2]}}))}))},t.onResetToken=function(){return Object(h.b)(t,void 0,void 0,(function(){var e,t,n;return Object(h.d)(this,(function(a){switch(a.label){case 0:return e=this.props.instance,t=Object(h.a)({},this.props.probe),[4,e.resetProbeToken(t)];case 1:return n=a.sent(),this.setState({showTokenModal:!0,showResetModal:!1,probeToken:n.token}),[2]}}))}))},t.onBack=function(){t.props.onReturn(!1)},t}return Object(h.c)(t,e),t.prototype.componentDidMount=function(){return Object(h.b)(this,void 0,void 0,(function(){var e;return Object(h.d)(this,(function(t){return e=Object(h.a)({},this.props.probe),this.setState({probe:e}),[2]}))}))},t.prototype.isValid=function(){var e,t,n=this.state.probe;if(!n)return!1;if(""===n.name)return console.log("probe name must be set"),!1;if(n.name.length>32)return console.log("probe name must be less than 32 characters"),!1;if(n.latitude<-90||n.latitude>90)return console.log("probe latitude must be between -90 and 90"),!1;if(n.longitude<-180||n.longitude>180)return console.log("probe longitude must be between -180 and 180"),!1;try{for(var a=Object(h.f)(n.labels),r=a.next();!r.done;r=a.next()){var o=r.value;if(""===o.name||""===o.value)return console.log("label name and value must be set"),!1;if(!o.name.match(/^[a-zA-Z0-9_]*$/))return console.log("label name can only contain a-zA-Z0-9_"),!1;if(o.name.length>32)return console.log("label name must be less than 32 chars"),!1;if(o.value.length>64)return console.log("label name must be less than 64 chars"),!1}}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}return!0},t.prototype.renderStatus=function(){var e=this.state,t=e.probe,n=e.showResetModal,a=this.props.instance;if(t){var r=!t.public&&y(c.EDITOR),o="Offline",s="heart-break",i="red";return t.online&&(o="Online",s="heart",i="green"),m.a.createElement(T.Container,{margin:"md"},m.a.createElement(T.Legend,null,"Status:  ",m.a.createElement(T.Badge,{color:i,icon:s,text:o})),!t.public&&m.a.createElement(T.Container,null,m.a.createElement(T.Button,{variant:"destructive",onClick:this.showResetModal(!0),disabled:!r},"Reset Access Token"),m.a.createElement(T.ConfirmModal,{isOpen:n,title:"Reset Probe Access Token",body:"Are you sure you want to reset the access token for this Probe?",confirmText:"Reset Token",onConfirm:this.onResetToken,onDismiss:this.showResetModal(!1)})),m.a.createElement("br",null),m.a.createElement(ue,{labelNames:["probe"],labelValues:[t.name],ds:a.getMetricsDS(),height:200,width:300,sparkline:!0}))}},t.prototype.render=function(){var e,t,n=this.state,a=n.probe,r=n.showDeleteModal,o=n.showTokenModal,s=n.probeToken;if(!a)return m.a.createElement("div",null,"Loading...");var i="Configuration";a.id||(i="Add Probe");var l=!a.public&&y(c.EDITOR);return m.a.createElement(T.HorizontalGroup,{align:"flex-start"},m.a.createElement(T.Container,null,m.a.createElement(T.Legend,null,i),m.a.createElement(T.Container,{margin:"md"},m.a.createElement(T.HorizontalGroup,null,m.a.createElement(T.Field,{label:m.a.createElement(K,{name:"Probe Name",help:"Unique name of probe"}),disabled:!l},m.a.createElement(T.Input,{type:"string",value:a.name,onChange:this.onNameUpdate})),m.a.createElement(T.Field,{label:m.a.createElement(K,{name:"Public",help:"Public probes are run by Grafana Labs and can be used by all users"}),disabled:!l},m.a.createElement(T.Container,{padding:"sm"},m.a.createElement(T.Switch,{value:a.public,disabled:!1}))))),m.a.createElement(T.Container,{margin:"md"},m.a.createElement("h3",{className:"page-heading"},"Location information"),m.a.createElement(T.HorizontalGroup,null,m.a.createElement(T.Field,{label:m.a.createElement(K,{name:"Latitude",help:"Latitude coordinates of this probe"}),disabled:!l},m.a.createElement(T.Input,{label:"Latitude",type:"number",placeholder:"0.0",value:(null===(e=a)||void 0===e?void 0:e.latitude)||0,onChange:this.onLatUpdate})),m.a.createElement(T.Field,{label:m.a.createElement(K,{name:"Longitude",help:"Longitude coordinates of this probe"}),disabled:!l},m.a.createElement(T.Input,{label:"Longitude",type:"number",placeholder:"0.0",value:(null===(t=a)||void 0===t?void 0:t.longitude)||0,onChange:this.onLongUpdate})))),m.a.createElement(T.Container,{margin:"md"},m.a.createElement("h3",{className:"page-heading"},"Labels"),m.a.createElement(W,{labels:a.labels,onUpdate:this.onLabelsUpdate,isEditor:l,type:"Label"})),m.a.createElement(T.Container,{margin:"md"},m.a.createElement(T.HorizontalGroup,null,m.a.createElement(T.Button,{onClick:this.onSave,disabled:!l||!this.isValid()},"Save"),a.id&&m.a.createElement(T.Button,{variant:"destructive",onClick:this.showDeleteProbeModal(!0),disabled:!l},"Delete Probe"),m.a.createElement(T.ConfirmModal,{isOpen:r,title:"Delete Probe",body:"Are you sure you want to delete this Probe?",confirmText:"Delete Probe",onConfirm:this.onRemoveProbe,onDismiss:this.showDeleteProbeModal(!1)}),m.a.createElement("a",{onClick:this.onBack},"Back"))),m.a.createElement(T.Modal,{isOpen:o,title:"Probe Authentication Token",icon:"lock",onDismiss:a.id?this.showTokenModal(!1):this.onBack},s)),a.id&&this.renderStatus())},t}(f.PureComponent),fe=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={probes:[],addNew:!1},t.onSelectProbe=function(e){Object(u.getLocationSrv)().update({partial:!0,query:{id:e}})},t.onAddNew=function(){t.setState({addNew:!0})},t.onRefresh=function(){return Object(h.b)(t,void 0,void 0,(function(){var e;return Object(h.d)(this,(function(t){switch(t.label){case 0:return[4,this.props.instance.worldping.listProbes()];case 1:return e=t.sent(),this.setState({probes:e}),[2]}}))}))},t.onGoBack=function(e){console.log("go back"),t.setState({addNew:!1}),e&&t.onRefresh(),Object(u.getLocationSrv)().update({partial:!0,query:{id:""}})},t}return Object(h.c)(t,e),t.prototype.componentDidMount=function(){return Object(h.b)(this,void 0,void 0,(function(){var e,t,n,a,r,o;return Object(h.d)(this,(function(s){switch(s.label){case 0:return e=this.props,t=e.instance,n=e.id,[4,t.worldping.listProbes()];case 1:return a=s.sent(),r=n?parseInt(n,10):-1,o=a.find((function(e){return e.id===r})),this.setState({probes:a,probe:o}),[2]}}))}))},t.prototype.componentDidUpdate=function(e){if(this.props.id!==e.id){var t=this.props.id,n=t?parseInt(t,10):-1,a=this.state.probes.find((function(e){return e.id===n}));this.setState({probe:a})}},t.prototype.labelsToString=function(e){return e.map((function(e){return e.name+"="+e.value})).join(" ")},t.prototype.render=function(){var e=this.props.instance,t=this.state,n=t.probe,a=t.addNew;if(!e)return m.a.createElement("div",null,"Loading...");if(n)return m.a.createElement(he,{probe:n,instance:e.worldping,onReturn:this.onGoBack});if(a){return m.a.createElement(he,{probe:{name:"",public:!1,latitude:0,longitude:0,labels:[],online:!1,onlineChange:0},instance:e.worldping,onReturn:this.onGoBack})}return m.a.createElement("div",null,this.renderProbeList())},t.prototype.renderProbeList=function(){var e=this,t=this.state.probes,n=this.props.instance;return t?m.a.createElement("div",null,y(c.EDITOR)&&m.a.createElement(T.HorizontalGroup,{justify:"flex-end"},m.a.createElement(T.Button,{onClick:this.onAddNew},"New")),t.map((function(t){var a=t.id||0;if(t.id){var r="Offline",o="heart-break",s="red";return t.online&&(r="Online",o="heart",s="green"),m.a.createElement("div",{key:a,className:"add-data-source-item",onClick:function(){return e.onSelectProbe(a)}},m.a.createElement("div",{className:"add-data-source-item-text-wrapper"},m.a.createElement("span",{className:"add-data-source-item-text"},t.name),m.a.createElement("span",{className:"add-data-source-item-desc"},m.a.createElement(T.Badge,{color:s,icon:o,text:r}),m.a.createElement("div",null,e.labelsToString(t.labels)))),m.a.createElement(ue,{labelNames:["probe"],labelValues:[t.name],ds:n.worldping.getMetricsDS(),height:60,width:150,sparkline:!1}),m.a.createElement("div",{className:"add-data-source-item-actions"},m.a.createElement(T.Button,null,"Select")))}})),m.a.createElement("br",null)):null},t}(f.PureComponent),me=function(e){function t(t){var n=e.call(this,t)||this;return n.state={settings:Object.values(u.config.datasources).filter((function(e){return"worldping-datasource"===e.type}))},n}return Object(h.c)(t,e),t.prototype.loadInstances=function(){var e,t,n,a;return Object(h.b)(this,void 0,void 0,(function(){var r,o,s,i,l;return Object(h.d)(this,(function(c){switch(c.label){case 0:return(r=this.state.settings[0])&&r.name?[4,Object(u.getDataSourceSrv)().get(r.name)]:[3,4];case 1:return(o=c.sent())?(s=o.instanceSettings.jsonData,l={worldping:o},[4,ge(null===(t=null===(e=s)||void 0===e?void 0:e.metrics)||void 0===t?void 0:t.grafanaName)]):[3,4];case 2:return l.metrics=c.sent(),[4,ge(null===(a=null===(n=s)||void 0===n?void 0:n.logs)||void 0===a?void 0:a.grafanaName)];case 3:return l.logs=c.sent(),i=l,this.setState({instance:i,valid:ve(i)}),this.updateNav(),[2];case 4:return console.log("Creating a new datasource TODO, check user auth"),[4,b()];case 5:c.sent(),console.log("Reload the windows (will redirect)"),window.location.reload(),c.label=6;case 6:return[2]}}))}))},t.prototype.componentDidMount=function(){return Object(h.b)(this,void 0,void 0,(function(){return Object(h.d)(this,(function(e){return this.updateNav(),this.loadInstances(),[2]}))}))},t.prototype.componentDidUpdate=function(e){this.props.query!==e.query&&this.props.query.page!==e.query.page&&this.updateNav()},t.prototype.updateNav=function(){var e,t,n=this.props,a=n.path,r=n.onNavChanged,o=n.query,s=n.meta,i=o.page||"status",l=[];this.state.valid&&"setup"!==i&&"redirect"!==i?(l.push({text:"Status",url:a,id:"status"}),l.push({text:"Checks",url:a+"?page=checks",id:"checks"}),l.push({text:"Probes",url:a+"?page=probes",id:"probes"})):this.state.valid&&"redirect"===i?(l.push({text:"Dashboard Redirect",url:a+"?page=redirect",id:"redirect"}),l.push({text:"Status",url:a,id:"status"})):l.push({text:"Setup",url:a,id:"setup"});var c=!1;try{for(var u=Object(h.f)(l),d=u.next();!d.done;d=u.next()){var p=d.value;p.active=!c&&i===p.id,p.active&&(c=!0)}}catch(t){e={error:t}}finally{try{d&&!d.done&&(t=u.return)&&t.call(u)}finally{if(e)throw e.error}}c||(l[0].active=!0);var f={text:"worldPing",img:s.info.logos.large,subTitle:"Global Blackbox Monitoring",url:a,children:l};r({node:f,main:f})},t.prototype.renderMultipleConfigs=function(){return m.a.createElement("div",null,"TODO... multiple instances... delete one!!!!")},t.prototype.renderStatus=function(){var e=this.state.instance.worldping.instanceSettings.jsonData;return m.a.createElement("div",null,m.a.createElement(N,{options:e,checkUpdates:!1}),m.a.createElement("br",null),y(c.EDITOR)&&m.a.createElement(k.a,{settings:e}))},t.prototype.dashboardRedirect=function(){var e=this.state.instance,t=this.props.query;if(!e)return m.a.createElement("div",null,"Loading.... (or maybe a user permissions error?)");if(!t.dashboard)return m.a.createElement("div",null,"Dashboard not found");var n=w(t.dashboard,e.worldping);if(!n)return console.log("dashboard not found.",t),m.a.createElement("div",null,"Dashboard not found");var a="d/"+n.uid,r=Object(h.a)({},t);return delete r.dashboard,delete r.page,Object(u.getLocationSrv)().update({partial:!1,path:a,query:r}),null},t.prototype.renderSetup=function(){var e=this.state.instance;return e?m.a.createElement(U,{instance:e.worldping}):m.a.createElement("div",null,"Loading.... (or maybe a user permissions error?)")},t.prototype.render=function(){var e=this.state,t=e.settings,n=e.valid,a=e.instance;if(t.length>1)return this.renderMultipleConfigs();var r=this.props.query;return n&&"setup"!==r.page?"dashboard"in r?this.dashboardRedirect():"checks"===r.page?m.a.createElement(pe,{instance:a,id:r.id}):"probes"===r.page?m.a.createElement(fe,{instance:a,id:r.id}):this.renderStatus():this.renderSetup()},t}(f.PureComponent);function ge(e){return Object(h.b)(this,void 0,void 0,(function(){return Object(h.d)(this,(function(t){switch(t.label){case 0:if(!e)return[3,4];t.label=1;case 1:return t.trys.push([1,3,,4]),[4,Object(u.getDataSourceSrv)().get()];case 2:return[2,t.sent()];case 3:return t.sent(),[3,4];case 4:return[2,void 0]}}))}))}function ve(e){return!!(e&&e.logs&&e.metrics&&e.worldping)}n.d(t,"plugin",(function(){return be})),n.d(t,"ConfigCtrl",(function(){return d}));var be=(new p.AppPlugin).setRootPage(me)}])}));
//# sourceMappingURL=module.js.map