/*! For license information please see module.js.LICENSE.txt */
define(["react","@grafana/ui","@grafana/runtime","@grafana/data","emotion"],(function(e,t,n,a,r){return function(e){var t={};function n(a){if(t[a])return t[a].exports;var r=t[a]={i:a,l:!1,exports:{}};return e[a].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,a){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(n.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(a,r,function(t){return e[t]}.bind(null,r));return a},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/",n(n.s=9)}([function(t,n){t.exports=e},function(e,n){e.exports=t},function(e,t,n){"use strict";n.d(t,"c",(function(){return r})),n.d(t,"a",(function(){return o})),n.d(t,"b",(function(){return i})),n.d(t,"d",(function(){return s})),n.d(t,"g",(function(){return l})),n.d(t,"f",(function(){return u})),n.d(t,"e",(function(){return d}));var a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function r(e,t){function n(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var o=function(){return(o=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};function i(e,t,n,a){return new(n||(n=Promise))((function(r,o){function i(e){try{l(a.next(e))}catch(e){o(e)}}function s(e){try{l(a.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}l((a=a.apply(e,t||[])).next())}))}function s(e,t){var n,a,r,o,i={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,a&&(r=2&o[0]?a.return:o[0]?a.throw||((r=a.return)&&r.call(a),0):a.next)&&!(r=r.call(a,o[1])).done)return r;switch(a=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,a=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!(r=i.trys,(r=r.length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){i=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){i.label=o[1];break}if(6===o[0]&&i.label<r[1]){i.label=r[1],r=o;break}if(r&&i.label<r[2]){i.label=r[2],i.ops.push(o);break}r[2]&&i.ops.pop(),i.trys.pop();continue}o=t.call(e,i)}catch(e){o=[6,e],a=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}function l(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],a=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&a>=e.length&&(e=void 0),{value:e&&e[a++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function c(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var a,r,o=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(a=o.next()).done;)i.push(a.value)}catch(e){r={error:e}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}return i}function u(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(c(arguments[t]));return e}function d(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e}},function(e,t){e.exports=n},function(e,t){e.exports=a},function(e,t,n){"use strict";n.d(t,"a",(function(){return l}));var a=n(2),r=n(0),o=n.n(r),i=n(3),s=n(1),l=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(a.c)(t,e),t.prototype.render=function(){var e=this.props.settings;return e?o.a.createElement("div",null,o.a.createElement("h2",null,"Linked Data Sources"),o.a.createElement(s.Container,{margin:"sm"},o.a.createElement(c,{info:e.metrics}),o.a.createElement(c,{info:e.logs}))):o.a.createElement("div",null,"Loading...")},t}(r.PureComponent),c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={},t.onClick=function(){var e,n,a=t.state.ds;"synthetic-monitoring-datasource"===(null===(e=a)||void 0===e?void 0:e.type)?Object(i.getLocationSrv)().update({partial:!1,path:"a/grafana-synthetic-monitoring-app/"}):Object(i.getLocationSrv)().update({partial:!1,path:"datasources/edit/"+(null===(n=a)||void 0===n?void 0:n.id)+"/"})},t}return Object(a.c)(t,e),t.prototype.componentDidMount=function(){var e=this.props.info;this.setState({ds:i.config.datasources[e.grafanaName]})},t.prototype.render=function(){var e=this.state.ds;return e?o.a.createElement("div",{className:"add-data-source-item",onClick:this.onClick},o.a.createElement("img",{className:"add-data-source-item-logo",src:e.meta.info.logos.small}),o.a.createElement("div",{className:"add-data-source-item-text-wrapper"},o.a.createElement("span",{className:"add-data-source-item-text"},e.name),o.a.createElement("span",{className:"add-data-source-item-desc"},e.type)),o.a.createElement("div",{className:"add-data-source-item-actions"},o.a.createElement(s.Button,null,"Edit"))):o.a.createElement("div",null,"Loading...")},t}(r.PureComponent)},function(e,t,n){"use strict";n.d(t,"a",(function(){return l})),n.d(t,"b",(function(){return c}));var a=n(2),r=n(0),o=n.n(r),i=n(1),s=n(5),l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onAccessTokenChange=function(e){var n=t.props,r=n.onOptionsChange,o=n.options;r(Object(a.a)(Object(a.a)({},o),{secureJsonData:{accessToken:e.target.value}}))},t.onResetAccessToken=function(){var e=t.props,n=e.onOptionsChange,r=e.options;n(Object(a.a)(Object(a.a)({},r),{secureJsonFields:Object(a.a)(Object(a.a)({},r.secureJsonFields),{accessToken:!1}),secureJsonData:Object(a.a)(Object(a.a)({},r.secureJsonData),{accessToken:""})}))},t}return Object(a.c)(t,e),t.prototype.render=function(){var e=this.props.options,t=e.secureJsonFields,n=e.secureJsonData||{};function a(){return t&&t.accessToken}return o.a.createElement("div",null,c(e.jsonData)&&a()&&o.a.createElement(s.a,{settings:e.jsonData}),o.a.createElement("br",null),o.a.createElement("div",{className:"gf-form-group"},o.a.createElement("div",{className:"gf-form-inline"},o.a.createElement("div",{className:"gf-form"},o.a.createElement(i.LegacyForms.SecretFormField,{isConfigured:a(),value:n.accessToken||"",label:"Access Token",placeholder:"access token saved on the server",labelWidth:10,inputWidth:20,onReset:this.onResetAccessToken,onChange:this.onAccessTokenChange})))))},t}(r.PureComponent);function c(e){if(!e)return!1;var t=e.apiHost,n=e.metrics,a=e.logs;return!!(t&&n&&n.grafanaName&&n.hostedId)&&!!(a&&a.grafanaName&&a.hostedId)}},function(e,t){e.exports=r},,function(e,t,n){"use strict";n.r(t);var a,r,o,i,s,l,c,u=n(3),d=function(){function e(e,t,n){var a;this.appEditCtrl.setPostUpdateHook(this.postUpdate.bind(this)),this.$q=n,this.appModel||(this.appModel={});var r=this.appModel;(r.jsonData||(r.jsonData={}),this.configured=!1,null===(a=this.appModel)||void 0===a?void 0:a.enabled)&&(Object.values(u.config.datasources).filter((function(e){return"synthetic-monitoring-datasource"===e.type})).length>0&&(this.configured=!0))}return e.$inject=["$scope","$injector","$q"],e.prototype.postUpdate=function(){var e;if(null===(e=this.appModel)||void 0===e?void 0:e.enabled)return Object(u.getLocationSrv)().update({path:"a/grafana-synthetic-monitoring-app/?page=config",partial:!1}),this.$q.resolve(!0)},e.templateUrl="legacy/config.html",e}(),p=n(4),h=n(2),f=n(0),m=n.n(f);function g(e,t){var n,a;if(t){var r=""+t.id,o=t.url+("logs"===t.type?"":"/api/prom");try{for(var i=Object(h.g)(e),s=i.next();!s.done;s=i.next()){var l=s.value;if(l.url===o&&(console.log("MAYBE:",r,l.basicAuthUser,l),r===l.basicAuthUser))return l}}catch(e){n={error:e}}finally{try{s&&!s.done&&(a=i.return)&&a.call(i)}finally{if(n)throw n.error}}}}function v(){return Object(h.b)(this,void 0,Promise,(function(){var e,t,n,a,r,o,i,s;return Object(h.d)(this,(function(l){switch(l.label){case 0:e=[],l.label=1;case 1:l.trys.push([1,6,7,8]),t=Object(h.g)(Object.values(u.config.datasources)),n=t.next(),l.label=2;case 2:return n.done?[3,5]:"prometheus"!==(a=n.value).type&&"loki"!==a.type?[3,4]:[4,Object(u.getBackendSrv)().get("api/datasources/"+a.id)];case 3:(r=l.sent()).url&&r.url.indexOf("grafana.net")>0&&e.push(r),l.label=4;case 4:return n=t.next(),[3,2];case 5:return[3,8];case 6:return o=l.sent(),i={error:o},[3,8];case 7:try{n&&!n.done&&(s=t.return)&&s.call(t)}finally{if(i)throw i.error}return[7];case 8:return[2,e]}}))}))}function b(){return Object(h.b)(this,void 0,Promise,(function(){return Object(h.d)(this,(function(e){return[2,Object(u.getBackendSrv)().post("api/datasources",{name:"Synthetic Monitoring",type:"synthetic-monitoring-datasource",access:"proxy",isDefault:!1})]}))}))}function y(e,t,n){return Object(h.b)(this,void 0,Promise,(function(){var a;return Object(h.d)(this,(function(r){return a={name:e,url:t.url+("logs"===t.type?"":"/api/prom"),access:"proxy",basicAuth:!0,basicAuthUser:""+t.id,secureJsonData:{basicAuthPassword:n},type:"logs"===t.type?"loki":"prometheus"},[2,Object(u.getBackendSrv)().post("api/datasources",a).then((function(e){return e.datasource}))]}))}))}function E(e){var t=u.config.bootData.user;switch(e){case c.ADMIN:return t.orgRole===c.ADMIN;case c.EDITOR:return t.orgRole===c.ADMIN||t.orgRole===c.EDITOR;case c.VIEWER:return t.orgRole===c.ADMIN||t.orgRole===c.EDITOR||t.orgRole===c.VIEWER;default:return!1}}function C(e){var t=Object.keys(e);return t.length<1?l.HTTP:t[0]}function S(e){switch(e){case l.HTTP:return{http:{method:r.GET,ipVersion:a.V4,noFollowRedirects:!1}};case l.PING:return{ping:{ipVersion:a.V4,dontFragment:!1}};case l.DNS:return{dns:{recordType:i.A,server:"8.8.8.8",ipVersion:a.V4,protocol:s.UDP,port:53}};case l.TCP:return{tcp:{ipVersion:a.V4,tls:!1}}}}function w(e,t){var n,a,r=t.instanceSettings.jsonData.dashboards,o=void 0;try{for(var i=Object(h.g)(r),s=i.next();!s.done;s=i.next()){var l=s.value;l.json.toLocaleLowerCase()==="sm-"+e+".json"&&(o=l)}}catch(e){n={error:e}}finally{try{s&&!s.done&&(a=i.return)&&a.call(i)}finally{if(n)throw n.error}}return o}!function(e){e.Any="Any",e.V4="V4",e.V6="V6"}(a||(a={})),function(e){e.GET="GET",e.HEAD="HEAD",e.POST="POST",e.PUT="PUT",e.OPTIONS="OPTIONS",e.DELETE="DELETE"}(r||(r={})),function(e){e.HTTP1_0="HTTP/1.0",e.HTTP1_1="HTTP/1.1",e.HTTP2_0="HTTP/2"}(o||(o={})),function(e){e.A="A",e.AAAA="AAAA",e.CNAME="CNAME",e.MX="MX",e.NS="NS",e.PTR="PTR",e.SOA="SOA",e.SRV="SRV",e.TXT="TXT"}(i||(i={})),function(e){e.TCP="TCP",e.UDP="UDP"}(s||(s={})),function(e){e.HTTP="http",e.PING="ping",e.DNS="dns",e.TCP="tcp"}(l||(l={})),function(e){e.ADMIN="Admin",e.EDITOR="Editor",e.VIEWER="Viewer"}(c||(c={}));var T=n(1),O=n(6),k=n(7),x=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(h.c)(t,e),t.prototype.render=function(){var e=this,t=this.props.selected;return m.a.createElement("div",null,this.props.instances.map((function(n){var a=t===n.id,r="public/app/plugins/datasource/prometheus/img/prometheus_logo.svg",o="metrics";"logs"===n.type&&(r="public/app/plugins/datasource/loki/img/loki_icon.svg",o="logs");var i="add-data-source-item";return a&&(i+=" "+Object(k.css)("border:1px solid #5794f2")),m.a.createElement("div",{key:n.id,className:i,onClick:function(){return e.props.onSelected(n.id)}},m.a.createElement("img",{className:"add-data-source-item-logo",src:r}),m.a.createElement("div",{className:"add-data-source-item-text-wrapper"},m.a.createElement("span",{className:"add-data-source-item-text"},n.name),m.a.createElement("span",{className:"add-data-source-item-desc"},n.url)),m.a.createElement("div",{className:"add-data-source-item-actions"},m.a.createElement(T.LinkButton,{variant:"secondary",href:"https://grafana.com/orgs/"+n.orgSlug+"/hosted-"+o+"/"+n.id+"?utm_source=synthetic_monitoring_app",target:"_blank",rel:"noopener",icon:"external-link-alt"},"grafana.com"),!a&&m.a.createElement(T.Button,null,"Select")))})))},t}(f.PureComponent),R=n(5),j=["sm-http.json","sm-ping.json","sm-dns.json","sm-tcp.json","sm-summary.json"];function A(){return Object(h.b)(this,void 0,Promise,(function(){var e,t,n,a,r,o,i;return Object(h.d)(this,(function(s){switch(s.label){case 0:return[4,(e=Object(u.getBackendSrv)()).get("api/folders")];case 1:t=s.sent();try{for(n=Object(h.g)(t),a=n.next();!a.done;a=n.next())if("SyntheticMonitoring"===(r=a.value).title)return[2,r]}catch(e){o={error:e}}finally{try{a&&!a.done&&(i=n.return)&&i.call(n)}finally{if(o)throw o.error}}return[4,e.post("api/folders",{title:"SyntheticMonitoring"})];case 2:return[2,s.sent()]}}))}))}function I(e,t){return Object(h.b)(this,void 0,Promise,(function(){var n,a,r;return Object(h.d)(this,(function(o){switch(o.label){case 0:return[4,(n=Object(u.getBackendSrv)()).get("public/plugins/grafana-synthetic-monitoring-app/dashboards/"+e)];case 1:return a=o.sent(),[4,A()];case 2:return r=o.sent(),[4,n.post("api/dashboards/import",{dashboard:a,overwrite:!0,inputs:[{name:"DS_SM_METRICS",type:"datasource",pluginId:"prometheus",value:t.metrics.grafanaName},{name:"DS_SM_LOGS",type:"datasource",pluginId:"loki",value:t.logs.grafanaName}],folderId:r.id})];case 3:return[2,{title:o.sent().title,uid:a.uid,json:e,version:a.version,latestVersion:a.version}]}}))}))}function M(){return Object(h.b)(this,void 0,Promise,(function(){var e,t,n,a,r,o,i,s,l,c;return Object(h.d)(this,(function(d){switch(d.label){case 0:e=Object(u.getBackendSrv)(),t=[],d.label=1;case 1:d.trys.push([1,6,7,8]),n=Object(h.g)(j),a=n.next(),d.label=2;case 2:return a.done?[3,5]:(r=a.value,[4,e.get("public/plugins/grafana-synthetic-monitoring-app/dashboards/"+r)]);case 3:o=d.sent(),i={title:o.title,uid:o.uid,json:r,version:0,latestVersion:o.version},t.push(i),d.label=4;case 4:return a=n.next(),[3,2];case 5:return[3,8];case 6:return s=d.sent(),l={error:s},[3,8];case 7:try{a&&!a.done&&(c=n.return)&&c.call(n)}finally{if(l)throw l.error}return[7];case 8:return[2,t]}}))}))}function P(e){return Object(h.b)(this,void 0,Promise,(function(){return Object(h.d)(this,(function(t){return[2,Object(u.getBackendSrv)().delete("/api/dashboards/uid/"+e.uid)]}))}))}var N=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={dashboards:t.props.options.dashboards},t.onImport=function(e){return function(){return Object(h.b)(t,void 0,void 0,(function(){var t,n,a,r,o;return Object(h.d)(this,(function(i){switch(i.label){case 0:return(t=this.props.onChange)?(n=Object(h.a)({},this.props.options),[4,I(e.json,n)]):[2];case 1:return a=i.sent(),console.log("dashboard updated"),(r=n.dashboards.findIndex((function(e){return e.uid===a.uid})))<0?n.dashboards.push(a):n.dashboards[r]=a,o=Object(h.f)(this.state.dashboards),(r=o.findIndex((function(e){return e.uid===a.uid})))<0?o.push(a):o[r]=a,this.setState({dashboards:o}),[2,t(n)]}}))}))}},t.onRemove=function(e){return function(){return Object(h.b)(t,void 0,void 0,(function(){var t,n,a,r;return Object(h.d)(this,(function(o){switch(o.label){case 0:return(t=this.props.onChange)?(n=Object(h.a)({},this.props.options),[4,P(e)]):[2];case 1:return o.sent(),(a=n.dashboards.findIndex((function(t){return t.uid===e.uid})))>=0&&n.dashboards.splice(a,1),r=Object(h.f)(this.state.dashboards),(a=r.findIndex((function(t){return t.uid===e.uid})))>=0&&(r[a].version=0),this.setState({dashboards:r}),[2,t(n)]}}))}))}},t}return Object(h.c)(t,e),t.prototype.componentDidMount=function(){return Object(h.b)(this,void 0,void 0,(function(){var e,t,n,a,r,o,i,s,l,c,u;return Object(h.d)(this,(function(d){switch(d.label){case 0:return e=this.props,t=e.checkUpdates,n=e.onChange,t&&n?(a=Object(h.f)(this.state.dashboards),[4,M()]):[2];case 1:r=d.sent(),o=function(e){var t=a.findIndex((function(t){return t.uid===e.uid}));t<0?a.push(e):(a[t].latestVersion=e.latestVersion,a[t].version||(a[t].version=-1))};try{for(i=Object(h.g)(r),s=i.next();!s.done;s=i.next())l=s.value,o(l)}catch(e){c={error:e}}finally{try{s&&!s.done&&(u=i.return)&&u.call(i)}finally{if(c)throw c.error}}return console.log(a),this.setState({dashboards:a}),[2]}}))}))},t.prototype.withImports=function(e){if(this.props.checkUpdates)return m.a.createElement("td",{style:{textAlign:"right"}},0===e.version?m.a.createElement("button",{className:"btn btn-secondary btn-small",onClick:this.onImport(e)},"Import"):m.a.createElement("button",{className:"btn btn-secondary btn-small",onClick:this.onImport(e)},function(e){return(e.latestVersion||0)>(e.version||0)?"Update":"Re-import"}(e)),0!==e.version&&m.a.createElement("button",{className:"btn btn-danger btn-small",onClick:this.onRemove(e)},m.a.createElement(T.Icon,{name:"trash-alt"})))},t.prototype.render=function(){var e=this,t=this.state.dashboards;return m.a.createElement("div",null,m.a.createElement("h3",null,"Dashboards:"),m.a.createElement("table",{className:"filter-table"},m.a.createElement("tbody",null,t.map((function(t){return m.a.createElement("tr",{key:t.uid},m.a.createElement("td",{className:"width-1"},m.a.createElement(T.Icon,{name:"apps"})),m.a.createElement("td",null,m.a.createElement("a",{href:"d/"+t.uid+"/"},t.title)),e.withImports(t))})))))},t}(f.PureComponent),U=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.defaultApiHost="https://synthetic-monitoring-api.grafana.net",t.state={showResetModal:!1,resetConfig:!1,apiHost:t.defaultApiHost,showAdvanced:!1},t.onInit=function(){return Object(h.b)(t,void 0,void 0,(function(){var e,t,n,a,r,o,i,s,l,c=this;return Object(h.d)(this,(function(u){switch(u.label){case 0:return e=this.props.instance,t=this.state,n=t.adminApiToken,a=t.apiHost,n?a?[4,e.registerInit(a,n).catch((function(e){if(console.error("failed to init. ",e),e.data.msg)c.setState({userError:e.data.msg,backendError:void 0});else{var t="failed to initialize with provided Admin API Key";e.statusText&&(t=e.status+": "+e.statusText),c.setState({backendError:t,userError:void 0})}}))]:(alert("Missing apiHost"),[2]):(alert("Missing admin key"),[2]);case 1:return(r=u.sent())?(this.setState({info:r,logsInstance:null===(i=null===(o=r.tenantInfo)||void 0===o?void 0:o.logInstance)||void 0===i?void 0:i.id,metricsInstance:null===(l=null===(s=r.tenantInfo)||void 0===s?void 0:s.metricInstance)||void 0===l?void 0:l.id,userError:void 0,backendError:void 0}),[2]):(console.log("info not returned from registerInit"),[2])}}))}))},t.onApiHostChange=function(e){t.setState({apiHost:e.target.value})},t.onApiTokenChange=function(e){t.setState({adminApiToken:e.target.value})},t.onSelectLogs=function(e){t.setState({logsInstance:e})},t.onSelectMetrics=function(e){t.setState({metricsInstance:e})},t.createDataSource=function(e,n){return Object(h.b)(t,void 0,void 0,(function(){var t,a,r,o;return Object(h.d)(this,(function(i){switch(i.label){case 0:t=this.props.instance,a=this.state.adminApiToken,i.label=1;case 1:return i.trys.push([1,5,,6]),[4,t.getViewerToken(a,n)];case 2:return(r=i.sent())?[4,y(e,n,r)]:[3,4];case 3:return[2,i.sent()];case 4:return console.error("error getting token"),[2,void 0];case 5:return o=i.sent(),console.log("Error creating",e,n,o),[3,6];case 6:return[2,void 0]}}))}))},t.onSave=function(){return Object(h.b)(t,void 0,void 0,(function(){var e,t,n,a,r,o,i,s,l,c,u,d,p,f,m,b,y,E,C,S,w,T,O=this;return Object(h.d)(this,(function(k){switch(k.label){case 0:return e=this.props.instance,t=this.state,n=t.info,a=t.adminApiToken,r=t.apiHost,o=null===(C=e)||void 0===C?void 0:C.instanceSettings.name,i=null===(S=n)||void 0===S?void 0:S.instances.find((function(e){return e.id===O.state.metricsInstance})),s=null===(w=n)||void 0===w?void 0:w.instances.find((function(e){return e.id===O.state.logsInstance})),i?s?r?[4,v()]:(alert("Missing apiHost"),[2]):(alert("Missing logs instance"),[2]):(alert("Missing metrics instance"),[2]);case 1:return l=k.sent(),(c=g(l,i))?[3,3]:[4,this.createDataSource(o+" Metrics",i)];case 2:c=k.sent(),k.label=3;case 3:return(u=g(l,s))?[3,5]:[4,this.createDataSource(o+" Logs",s)];case 4:u=k.sent(),k.label=5;case 5:d={apiHost:r,logs:{grafanaName:u.name,hostedId:s.id},metrics:{grafanaName:c.name,hostedId:i.id},dashboards:[]},k.label=6;case 6:k.trys.push([6,11,12,13]),p=Object(h.g)(j),f=p.next(),k.label=7;case 7:return f.done?[3,10]:[4,I(f.value,d)];case 8:m=k.sent(),d.dashboards.push(m),k.label=9;case 9:return f=p.next(),[3,7];case 10:return[3,13];case 11:return b=k.sent(),y={error:b},[3,13];case 12:try{f&&!f.done&&(E=p.return)&&E.call(p)}finally{if(y)throw y.error}return[7];case 13:return[4,e.registerSave(a,d,null===(T=n)||void 0===T?void 0:T.accessToken)];case 14:return k.sent(),window.location.reload(),[2]}}))}))},t.onToggleAdvanced=function(e){t.setState({showAdvanced:!t.state.showAdvanced})},t.showResetModal=function(e){return function(){t.setState({showResetModal:e})}},t.onReset=function(){t.setState({resetConfig:!0})},t.onOptionsChange=function(e){return t.props.instance.onOptionsChange(e)},t}return Object(h.c)(t,e),t.prototype.renderSetup=function(){var e=this.state,t=e.info,n=e.adminApiToken,a=e.apiHost,r=e.logsInstance,o=e.metricsInstance,i=e.showAdvanced,s=e.userError,l=e.backendError;return t?m.a.createElement("div",null,m.a.createElement("div",null,"Select the Grafana Cloud instances Synthetic Monitoring will send data to"),m.a.createElement("h4",null,"Metrics"),m.a.createElement(x,{instances:t.instances.filter((function(e){return"prometheus"===e.type})),onSelected:this.onSelectMetrics,selected:o}),m.a.createElement("h4",null,"Logs"),m.a.createElement(x,{instances:t.instances.filter((function(e){return"logs"===e.type})),onSelected:this.onSelectLogs,selected:r}),m.a.createElement("br",null),m.a.createElement("br",null),m.a.createElement(T.Button,{variant:"primary",onClick:this.onSave},"Setup")):m.a.createElement("div",null,m.a.createElement(T.HorizontalGroup,{wrap:!0},m.a.createElement(T.InfoBox,{title:"Initialize Synthetic Monitoring App",url:"https://grafana.com/grafana/plugins/grafana-synthetic-monitoring-app/"},m.a.createElement("p",null,"To initialize the App and connect it to your Grafana Cloud service you will need a Admin API key for you Grafana.com account. The ",m.a.createElement("b",null,"API key")," is only needed for the initialization process and will not be stored. Once the initialization is complete you can safely delete the key.",m.a.createElement("br",null),m.a.createElement("br",null),m.a.createElement("a",{className:"highlight-word",href:"//grafana.com/profile/api-keys",target:"_blank"},"Generate a new API key"))),m.a.createElement(T.Field,{label:"Admin API Key",error:s,invalid:void 0!==s},m.a.createElement(T.Input,{type:"text",width:100,placeholder:"Grafana.com Admin Api Key",value:n||"",onChange:this.onApiTokenChange}))),m.a.createElement("br",null),m.a.createElement(T.Collapse,{label:"Advanced",collapsible:!0,onToggle:this.onToggleAdvanced,isOpen:i},m.a.createElement(T.HorizontalGroup,null,m.a.createElement(T.Field,{label:"Backend Address"},m.a.createElement(T.Input,{type:"text",width:40,placeholder:"Synthetic Monitoring Backend Address",value:a||this.defaultApiHost,onChange:this.onApiHostChange})))),m.a.createElement(T.Button,{variant:"primary",onClick:this.onInit},"Initalize"),void 0!==l&&m.a.createElement(T.Container,{margin:"md"},m.a.createElement(T.Alert,{title:"Backend Error",severity:"error"},l)))},t.prototype.render=function(){var e,t=this.props.instance;if(!t)return m.a.createElement("div",null,"Loading...");var n=this.state,a=n.showResetModal,r=n.resetConfig;return!Object(O.b)(null===(e=t.instanceSettings)||void 0===e?void 0:e.jsonData)||r?this.renderSetup():m.a.createElement("div",null,m.a.createElement(N,{options:t.instanceSettings.jsonData,checkUpdates:!0,onChange:this.onOptionsChange}),m.a.createElement("br",null),m.a.createElement(R.a,{settings:t.instanceSettings.jsonData}),m.a.createElement(T.Button,{variant:"destructive",onClick:this.showResetModal(!0)},"Reset"),m.a.createElement(T.ConfirmModal,{isOpen:a,title:"Reset Configuration",body:"Are you sure you want to reset the configuration?",confirmText:"Reset Configuration",onConfirm:this.onReset,onDismiss:this.showResetModal(!1)}))},t}(f.PureComponent),D={job:F,target:V,frequency:B,timeout:H,labels:q,settings:function(e){var t=C(e);if(!e[t])return!1;switch(t){case l.HTTP:return e.http,!0;case l.PING:return e.ping,!0;case l.DNS:return e.dns,!0;case l.TCP:return e.tcp,!0}},probes:Q};function L(e){return D.job(e.job)&&D.target(C(e.settings),e.target)&&D.frequency(e.frequency)&&D.timeout(e.timeout)&&D.labels(e.labels)&&D.settings(e.settings)&&D.probes(e.probes)}function F(e){return e.length>0&&e.length<=32}function V(e,t){if(!(t.length>0&&t.length<=64))return!1;switch(e){case l.HTTP:return function(e){try{var t=new URL(e);return"https:"===t.protocol||"http:"===t.protocol}catch(e){return!1}}(t);default:return!0}}function B(e){return e>=1e4&&e<=12e4}function H(e){return e>=1e3&&e<=1e4}function q(e){var t,n,a;if(e.length<0||e.length>5)return!1;try{for(var r=Object(h.g)(e),o=r.next();!o.done;o=r.next()){var i=o.value;if(!z((a=i).name)||!_(a.value))return!1}}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}return!0}var G=/^[a-zA-Z_][a-zA-Z0-9_]*$/;function z(e){return!(e.length<1||e.length>32)&&G.test(e)}function _(e){return e.length>0&&e.length<=32}function Q(e){return e.length>0&&e.length<=64}var J,K,X=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={labels:t.props.labels||[],numLabels:t.props.labels.length},t.addLabel=function(){var e=t.state.labels;console.log("adding new label",e);var n=e.push({name:"",value:""});t.setState({labels:e,numLabels:n},t.onUpdate)},t.onDelete=function(e){var n=t.state.labels;n.splice(e,1),t.setState({labels:n,numLabels:n.length},t.onUpdate)},t.onUpdate=function(){t.props.onUpdate(t.state.labels)},t.onChange=function(e,n){var a=t.state.labels;a[e]=n,t.setState({labels:a},t.onUpdate)},t}return Object(h.c)(t,e),t.prototype.render=function(){var e=this,t=this.state.labels,n=this.props,a=n.isEditor,r=n.limit;return m.a.createElement(T.VerticalGroup,{justify:"space-between"},m.a.createElement(T.List,{items:t,renderItem:function(t,n){return m.a.createElement($,{onDelete:e.onDelete,onChange:e.onChange,label:t,index:n,isEditor:a})}}),t.length<r&&m.a.createElement(T.Button,{onClick:this.addLabel,disabled:!a,variant:"secondary",size:"sm"},m.a.createElement(T.Icon,{name:"plus"}),"  Add ",this.props.type))},t}(f.PureComponent),$=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={name:t.props.label.name,value:t.props.label.value},t.onNameChange=function(e){t.setState({name:e.target.value},t.onChange)},t.onValueChange=function(e){t.setState({value:e.target.value},t.onChange)},t.onDelete=function(){t.props.onDelete(t.props.index)},t.onChange=function(){t.props.onChange(t.props.index,{name:t.state.name,value:t.state.value})},t}return Object(h.c)(t,e),t.prototype.componentDidUpdate=function(e){var t=this.props,n=t.label,a=t.index;n===e.label&&a===e.index||this.setState({name:this.props.label.name,value:this.props.label.value})},t.prototype.render=function(){var e=this.state,t=e.name,n=e.value,a=this.props.isEditor;return console.log("rendering label with name:",t),m.a.createElement(T.HorizontalGroup,{justify:"space-between"},m.a.createElement(T.Input,{type:"text",placeholder:"name",value:t,onChange:this.onNameChange,disabled:!a,invalid:!z(t)}),m.a.createElement(T.Input,{type:"text",placeholder:"value",value:n,onChange:this.onValueChange,disabled:!a,invalid:!_(n)}),m.a.createElement(T.IconButton,{name:"minus-circle",onClick:this.onDelete,disabled:!a}))},t}(f.PureComponent),W=[{label:"Any",value:a.Any},{label:"V4",value:a.V4},{label:"V6",value:a.V6}],Z=function(e){function t(){var t,n,r=e.apply(this,Object(h.f)(arguments))||this;return r.state={ipVersion:(null===(t=r.props.settings.ping)||void 0===t?void 0:t.ipVersion)||a.V4,dontFragment:(null===(n=r.props.settings.ping)||void 0===n?void 0:n.dontFragment)||!1,showAdvanced:!1},r.onUpdate=function(){var e=r.state;r.props.onUpdate({ping:e})},r.onIpVersionChange=function(e){r.setState({ipVersion:e.value||a.Any},r.onUpdate)},r.onDontFragmentChange=function(e){r.setState({dontFragment:!r.state.dontFragment},r.onUpdate)},r.onToggleOptions=function(e){r.setState({showAdvanced:!r.state.showAdvanced})},r}return Object(h.c)(t,e),t.prototype.render=function(){var e=this.state,t=e.ipVersion,n=e.dontFragment,a=e.showAdvanced,r=this.props.isEditor;return m.a.createElement(T.Container,null,m.a.createElement(T.Collapse,{label:"Advanced Options",collapsible:!0,onToggle:this.onToggleOptions,isOpen:a},m.a.createElement(T.HorizontalGroup,null,m.a.createElement("div",null,m.a.createElement(T.Field,{label:"IP Version",description:"The IP protocol of the ICMP request",disabled:!r},m.a.createElement(T.Select,{value:t,options:W,onChange:this.onIpVersionChange}))),m.a.createElement("div",null,m.a.createElement(T.Field,{label:"Don't Fragment",description:"Set the DF-bit in the IP-header. Only works with ipV4",disabled:!r},m.a.createElement(T.Container,{padding:"sm"},m.a.createElement(T.Switch,{value:n,onChange:this.onDontFragmentChange,disabled:!r})))))))},t}(f.PureComponent),Y=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={hasBasicAuth:!1,hasBearerToken:!1,showAuthentication:!1},t.onUpdate=function(){t.props.onUpdate(t.state.token,t.state.basicAuth)},t.onToggleAuthentication=function(e){t.setState({showAuthentication:!t.state.showAuthentication})},t.onBearerTokenChange=function(e){t.setState({token:e.target.value},t.onUpdate)},t.onBasicAuthChange=function(e){var n=t.state,a=n.hasBasicAuth,r=n.hasBearerToken,o=n.token;e?(a=!0,r=!1,o=void 0):a=!1,t.setState({basicAuth:e,hasBasicAuth:a,hasBearerToken:r,token:o},t.onUpdate)},t.onHasBearerAuth=function(e){var n=t.state,a=n.hasBasicAuth,r=n.basicAuth,o=n.hasBearerToken,i=n.token;o?i=void 0:a&&(a=!1,r=void 0),o=!o,t.setState({hasBasicAuth:a,basicAuth:r,hasBearerToken:o,token:i},t.onUpdate)},t}return Object(h.c)(t,e),t.prototype.componentDidMount=function(){var e=this.props,t=e.bearerToken,n=e.basicAuth,a=!1,r=!1;t&&t.length>0?a=!0:n&&(n.username.length>0||n.password.length>0)&&(r=!0),this.setState({hasBasicAuth:r,hasBearerToken:a,token:t,basicAuth:n})},t.prototype.render=function(){var e=this.state,t=e.showAuthentication,n=e.hasBearerToken,a=e.token,r=e.basicAuth,o=this.props.isEditor;return m.a.createElement(T.Collapse,{label:"Authentication",collapsible:!0,onToggle:this.onToggleAuthentication,isOpen:t},m.a.createElement(T.VerticalGroup,{spacing:"xs"},m.a.createElement(T.Field,{label:"Bearer Token",description:"Include bearer Authorization header in request",disabled:!o,horizontal:!0,className:n?Object(k.css)(J||(J=Object(h.e)(["\n                    margin-bottom: 1px;\n                  "],["\n                    margin-bottom: 1px;\n                  "]))):void 0},m.a.createElement(T.Container,{margin:"sm"},m.a.createElement(T.Switch,{value:n,onChange:this.onHasBearerAuth,disabled:!o}))),n&&m.a.createElement(T.VerticalGroup,null,m.a.createElement(T.Input,{type:"password",placeholder:"Bearer Token",value:a,onChange:this.onBearerTokenChange,disabled:!o}),m.a.createElement("br",null))),m.a.createElement(ee,{onChange:this.onBasicAuthChange,basicAuth:r,isEditor:o}))},t}(f.PureComponent),ee=function(e){function t(){var t,n,a=e.apply(this,Object(h.f)(arguments))||this;return a.state={username:(null===(t=a.props.basicAuth)||void 0===t?void 0:t.username)||"",password:(null===(n=a.props.basicAuth)||void 0===n?void 0:n.password)||"",hasBasicAuth:!!a.props.basicAuth},a.onUpdate=function(){if(a.state.hasBasicAuth){var e={username:a.state.username,password:a.state.password};a.props.onChange(e)}else a.props.onChange(void 0)},a.onUsernameChange=function(e){a.setState({username:e.target.value},a.onUpdate)},a.onPasswordChange=function(e){a.setState({password:e.target.value},a.onUpdate)},a.onHasBasicAuth=function(e){var t=a.state,n=t.hasBasicAuth,r=t.username,o=t.password;n&&(r="",o=""),n=!n,a.setState({hasBasicAuth:n,username:r,password:o},a.onUpdate)},a}return Object(h.c)(t,e),t.prototype.componentDidUpdate=function(e){var t,n;this.setState({username:(null===(t=this.props.basicAuth)||void 0===t?void 0:t.username)||"",password:(null===(n=this.props.basicAuth)||void 0===n?void 0:n.password)||"",hasBasicAuth:!!this.props.basicAuth})},t.prototype.render=function(){var e=this.state,t=e.username,n=e.password,a=e.hasBasicAuth,r=this.props.isEditor;return m.a.createElement(T.VerticalGroup,{spacing:"xs"},m.a.createElement(T.Field,{label:"Basic Auth",description:"Include Basic Authorization header in request",disabled:!r,horizontal:!0,className:a?Object(k.css)(K||(K=Object(h.e)(["\n                  margin-bottom: 1px;\n                "],["\n                  margin-bottom: 1px;\n                "]))):void 0},m.a.createElement(T.Container,{margin:"sm"},m.a.createElement(T.Switch,{value:a,onChange:this.onHasBasicAuth,disabled:!r}))),a&&m.a.createElement(T.HorizontalGroup,null,m.a.createElement(T.Input,{type:"text",placeholder:"username",value:t,onChange:this.onUsernameChange,disabled:!r}),m.a.createElement(T.Input,{type:"password",placeholder:"password",value:n,onChange:this.onPasswordChange,disabled:!r})))},t}(f.PureComponent),te=function(e){function t(){var t,n,o,i,s,l,c,u,d,p,f,m,g,v,b,y,E=e.apply(this,Object(h.f)(arguments))||this;return E.state={method:(null===(t=E.props.settings.http)||void 0===t?void 0:t.method)||r.GET,body:null===(n=E.props.settings.http)||void 0===n?void 0:n.body,headers:null===(o=E.props.settings.http)||void 0===o?void 0:o.headers,ipVersion:(null===(i=E.props.settings.http)||void 0===i?void 0:i.ipVersion)||a.V4,noFollowRedirects:(null===(s=E.props.settings.http)||void 0===s?void 0:s.noFollowRedirects)||!1,bearerToken:null===(l=E.props.settings.http)||void 0===l?void 0:l.bearerToken,basicAuth:null===(c=E.props.settings.http)||void 0===c?void 0:c.basicAuth,failIfSSL:(null===(u=E.props.settings.http)||void 0===u?void 0:u.failIfSSL)||!1,failIfNotSSL:(null===(d=E.props.settings.http)||void 0===d?void 0:d.failIfNotSSL)||!1,validStatusCodes:(null===(p=E.props.settings.http)||void 0===p?void 0:p.validStatusCodes)||[],validHTTPVersions:(null===(f=E.props.settings.http)||void 0===f?void 0:f.validHTTPVersions)||[],failIfBodyMatchesRegexp:(null===(m=E.props.settings.http)||void 0===m?void 0:m.failIfBodyMatchesRegexp)||[],failIfBodyNotMatchesRegexp:(null===(g=E.props.settings.http)||void 0===g?void 0:g.failIfBodyNotMatchesRegexp)||[],failIfHeaderMatchesRegexp:(null===(v=E.props.settings.http)||void 0===v?void 0:v.failIfHeaderMatchesRegexp)||[],failIfHeaderNotMatchesRegexp:(null===(b=E.props.settings.http)||void 0===b?void 0:b.failIfHeaderNotMatchesRegexp)||[],cacheBustingQueryParamName:null===(y=E.props.settings.http)||void 0===y?void 0:y.cacheBustingQueryParamName,showAdvanced:!1,showValidation:!1,showAuthentication:!1,showTLS:!1},E.onUpdate=function(){var e=E.state;E.props.onUpdate({http:e})},E.onMethodChange=function(e){E.setState({method:e.value||r.GET},E.onUpdate)},E.onBodyChange=function(e){E.setState({body:e.target.value},E.onUpdate)},E.onIpVersionChange=function(e){E.setState({ipVersion:e.value||a.Any},E.onUpdate)},E.onNoFollowRedirectsChange=function(e){E.setState({noFollowRedirects:!E.state.noFollowRedirects},E.onUpdate)},E.onFailIfNotSSLChange=function(e){E.setState({failIfNotSSL:!E.state.failIfNotSSL},E.onUpdate)},E.onFailIfSSLChange=function(e){E.setState({failIfSSL:!E.state.failIfSSL},E.onUpdate)},E.onCacheBustingQueryParamNameChange=function(e){E.setState({cacheBustingQueryParamName:e.target.value},E.onUpdate)},E.onToggleAdvanced=function(e){E.setState({showAdvanced:!E.state.showAdvanced})},E.onToggleValidation=function(e){E.setState({showValidation:!E.state.showValidation})},E.onAuthUpdate=function(e,t){E.setState({bearerToken:e,basicAuth:t},E.onUpdate)},E.onToggleTLS=function(e){E.setState({showTLS:!E.state.showTLS})},E.onTLSChange=function(e){E.setState({tlsConfig:e},E.onUpdate)},E.onValidHttpVersionsChange=function(e){var t,n,a=[];try{for(var r=Object(h.g)(e.values()),o=r.next();!o.done;o=r.next()){var i=o.value;i.value&&a.push(i.value)}}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}E.setState({validHTTPVersions:a},E.onUpdate)},E.onValidStatusCodeChange=function(e){var t,n,a=[];try{for(var r=Object(h.g)(e.values()),o=r.next();!o.done;o=r.next()){var i=o.value;i.value&&a.push(i.value)}}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}E.setState({validStatusCodes:a},E.onUpdate)},E.onHeadersUpdate=function(e){var t,n,a=[];try{for(var r=Object(h.g)(e),o=r.next();!o.done;o=r.next()){var i=o.value;a.push(i.name+": "+i.value)}}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}E.setState({headers:a},E.onUpdate)},E.onFailIfBodyMatchesRegexpChange=function(e){return function(t){var n,a=[];null===(n=E.state.failIfBodyMatchesRegexp)||void 0===n||n.forEach((function(n,r){r===e?a.push(t.target.value):a.push(n)})),E.setState({failIfBodyMatchesRegexp:a},E.onUpdate)}},E.onFailIfBodyMatchesRegexpDelete=function(e){return function(){var t,n=[];null===(t=E.state.failIfBodyMatchesRegexp)||void 0===t||t.forEach((function(t,a){a!==e&&n.push(t)})),E.setState({failIfBodyMatchesRegexp:n},E.onUpdate)}},E.addFailIfBodyMatchesRegexp=function(){var e,t,n=[];try{for(var a=Object(h.g)(E.state.failIfBodyMatchesRegexp||[]),r=a.next();!r.done;r=a.next()){var o=r.value;n.push(o)}}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}n.push(""),E.setState({failIfBodyMatchesRegexp:n},E.onUpdate)},E.onFailIfBodyNotMatchesRegexpChange=function(e){return function(t){var n,a=[];null===(n=E.state.failIfBodyNotMatchesRegexp)||void 0===n||n.forEach((function(n,r){r===e?a.push(t.target.value):a.push(n)})),E.setState({failIfBodyNotMatchesRegexp:a},E.onUpdate)}},E.onFailIfBodyNotMatchesRegexpDelete=function(e){return function(){var t,n=[];null===(t=E.state.failIfBodyNotMatchesRegexp)||void 0===t||t.forEach((function(t,a){a!==e&&n.push(t)})),E.setState({failIfBodyNotMatchesRegexp:n},E.onUpdate)}},E.addFailIfBodyNotMatchesRegexp=function(){var e,t,n=[];try{for(var a=Object(h.g)(E.state.failIfBodyNotMatchesRegexp||[]),r=a.next();!r.done;r=a.next()){var o=r.value;n.push(o)}}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}n.push(""),E.setState({failIfBodyNotMatchesRegexp:n},E.onUpdate)},E.onFailIfHeaderMatchesUpdate=function(e){var t=[];E.state.failIfHeaderMatchesRegexp?e.forEach((function(e){t.push(e)})):t=e,console.log("setting failIfHeaderMatchesRegexp",t),E.setState({failIfHeaderMatchesRegexp:t},E.onUpdate)},E.onFailIfHeaderNotMatchesUpdate=function(e){var t=[];E.state.failIfHeaderNotMatchesRegexp?e.forEach((function(e){t.push(e)})):t=e,E.setState({failIfHeaderNotMatchesRegexp:t},E.onUpdate)},E}return Object(h.c)(t,e),t.prototype.headersToLabels=function(){var e,t,n=[];try{for(var a=Object(h.g)(this.state.headers||[]),r=a.next();!r.done;r=a.next()){var o=r.value.split(":",2);n.push({name:o[0],value:o[1]})}}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}return n},t.prototype.generateValidStatusCodes=function(){for(var e=[],t=100;t<=102;t++)e.push({label:""+t,value:t});for(t=200;t<=208;t++)e.push({label:""+t,value:t});for(t=300;t<=308;t++)e.push({label:""+t,value:t});for(t=400;t<=418;t++)e.push({label:""+t,value:t});e.push({label:"422",value:422}),e.push({label:"426",value:426}),e.push({label:"428",value:428}),e.push({label:"429",value:429}),e.push({label:"431",value:431});for(t=500;t<=511;t++)e.push({label:""+t,value:t});return e.push({label:"598",value:598}),e.push({label:"599",value:599}),e},t.prototype.render=function(){var e=this,t=this.state,n=this.props.isEditor,a=[{label:"HTTP/1.0",value:o.HTTP1_0},{label:"HTTP/1.1",value:o.HTTP1_1},{label:"HTTP/2",value:o.HTTP2_0}],i=[{label:"GET",value:r.GET},{label:"HEAD",value:r.HEAD},{label:"PUT",value:r.PUT},{label:"POST",value:r.POST},{label:"DELETE",value:r.DELETE},{label:"OPTIONS",value:r.OPTIONS}],s=this.generateValidStatusCodes();return m.a.createElement(T.Container,null,m.a.createElement(T.HorizontalGroup,null,m.a.createElement(T.Field,{label:"Request Method",description:"The HTTP method the probe will use",disabled:!n},m.a.createElement(T.Select,{value:t.method,options:i,onChange:this.onMethodChange}))),m.a.createElement(T.Container,null,m.a.createElement(T.Field,{label:"Request Body",description:"The body of the HTTP request used in probe.",disabled:!n},m.a.createElement("div",null,m.a.createElement(T.TextArea,{value:t.body,onChange:this.onBodyChange,rows:2,disabled:!n})))),m.a.createElement(T.Container,null,m.a.createElement(T.Field,{label:"Request Headers",description:"The HTTP headers set for the probe..",disabled:!n},m.a.createElement("div",null,m.a.createElement(X,{labels:this.headersToLabels(),isEditor:n,onUpdate:this.onHeadersUpdate,type:"Header",limit:10})))),m.a.createElement("br",null),m.a.createElement(T.Collapse,{label:"TLS Config",collapsible:!0,onToggle:this.onToggleTLS,isOpen:t.showTLS},m.a.createElement(ne,{onChange:this.onTLSChange,isEditor:n,tlsConfig:t.tlsConfig})),m.a.createElement(Y,{isEditor:n,basicAuth:t.basicAuth,bearerToken:t.bearerToken,onUpdate:this.onAuthUpdate}),m.a.createElement(T.Collapse,{label:"Validation",collapsible:!0,onToggle:this.onToggleValidation,isOpen:t.showValidation},m.a.createElement(T.HorizontalGroup,null,m.a.createElement(T.Field,{label:"Valid Status Codes",description:"Accepted status codes for this probe. Defaults to 2xx.",disabled:!n},m.a.createElement(T.MultiSelect,{options:s,value:t.validStatusCodes,onChange:this.onValidStatusCodeChange,disabled:!n})),m.a.createElement(T.Field,{label:"Valid HTTP Versions",description:"Accepted HTTP versions for this probe",disabled:!n},m.a.createElement(T.MultiSelect,{options:a,value:t.validHTTPVersions,onChange:this.onValidHttpVersionsChange,disabled:!n})),m.a.createElement(T.Field,{label:"Fail if SSL",description:"Probe fails if SSL is present",disabled:!n},m.a.createElement(T.Container,{padding:"sm"},m.a.createElement(T.Switch,{value:t.failIfSSL,onChange:this.onFailIfSSLChange,disabled:!n}))),m.a.createElement(T.Field,{label:"Fail if not SSL",description:"Probe fails if SSL is not present",disabled:!n},m.a.createElement(T.Container,{padding:"sm"},m.a.createElement(T.Switch,{value:t.failIfNotSSL,onChange:this.onFailIfNotSSLChange,disabled:!n})))),m.a.createElement(T.Field,{label:"Fail if body matches regexp",description:"Probe fails if response body matches regex",disabled:!n},m.a.createElement(T.VerticalGroup,{justify:"space-between"},m.a.createElement(T.List,{items:t.failIfBodyMatchesRegexp||[],renderItem:function(t,a){return m.a.createElement(T.HorizontalGroup,null,m.a.createElement(T.Input,{type:"text",placeholder:"regexp",value:t,onChange:e.onFailIfBodyMatchesRegexpChange(a),disabled:!n}),m.a.createElement(T.IconButton,{name:"minus-circle",onClick:e.onFailIfBodyMatchesRegexpDelete(a),disabled:!n}))}}),m.a.createElement(T.Button,{onClick:this.addFailIfBodyMatchesRegexp,disabled:!n,variant:"secondary",size:"sm"},m.a.createElement(T.Icon,{name:"plus"}),"  Add Body Regexp"))),m.a.createElement(T.Field,{label:"Fail if body doesn't match regexp",description:"Probe fails if response body does not match regex",disabled:!n},m.a.createElement(T.VerticalGroup,{justify:"space-between"},m.a.createElement(T.List,{items:t.failIfBodyNotMatchesRegexp||[],renderItem:function(t,a){return m.a.createElement(T.HorizontalGroup,null,m.a.createElement(T.Input,{type:"text",placeholder:"regexp",value:t,onChange:e.onFailIfBodyNotMatchesRegexpChange(a),disabled:!n}),m.a.createElement(T.IconButton,{name:"minus-circle",onClick:e.onFailIfBodyNotMatchesRegexpDelete(a),disabled:!n}))}}),m.a.createElement(T.Button,{onClick:this.addFailIfBodyNotMatchesRegexp,disabled:!n,variant:"secondary",size:"sm"},m.a.createElement(T.Icon,{name:"plus"}),"  Add Body Regexp"))),m.a.createElement(ae,{headerMatches:t.failIfHeaderMatchesRegexp||[],name:"Fail if header matches regexp",description:"Probe fails if response header matches regex. For headers with multiple values, fails if *at least one* matches",onChange:this.onFailIfHeaderMatchesUpdate,isEditor:n}),m.a.createElement(ae,{headerMatches:t.failIfHeaderNotMatchesRegexp||[],name:"Fail if header doesn't match regexp",description:"Probe fails if response header does not match regex. For headers with multiple values, fails if *none* match.",onChange:this.onFailIfHeaderNotMatchesUpdate,isEditor:n})),m.a.createElement(T.Collapse,{label:"Advanced Options",collapsible:!0,onToggle:this.onToggleAdvanced,isOpen:t.showAdvanced},m.a.createElement(T.HorizontalGroup,null,m.a.createElement("div",null,m.a.createElement(T.Field,{label:"IP Version",description:"The IP protocol of the HTTP request",disabled:!n},m.a.createElement(T.Select,{value:t.ipVersion,options:W,onChange:this.onIpVersionChange}))),m.a.createElement("div",null,m.a.createElement(T.Field,{label:"Follow Redirects",description:"Whether or not the probe will follow any redirects.",disabled:!n},m.a.createElement(T.Container,{padding:"sm"},m.a.createElement(T.Switch,{value:!t.noFollowRedirects,onChange:this.onNoFollowRedirectsChange,disabled:!n}))))),m.a.createElement(T.HorizontalGroup,null,m.a.createElement("div",null,m.a.createElement(T.Field,{label:"Cache busting query parameter name",description:"The name of the query parameter used to prevent the server from using a cached response. Each probe will assign a random value to this parameter each time a request is made."},m.a.createElement(T.Input,{type:"string",placeholder:"cache-bust",value:t.cacheBustingQueryParamName,onChange:this.onCacheBustingQueryParamNameChange,disabled:!n}))))))},t}(f.PureComponent),ne=function(e){function t(){var t,n,a,r,o,i=e.apply(this,Object(h.f)(arguments))||this;return i.state={insecureSkipVerify:(null===(t=i.props.tlsConfig)||void 0===t?void 0:t.insecureSkipVerify)||!1,caCert:(null===(n=i.props.tlsConfig)||void 0===n?void 0:n.caCert)||"",clientCert:(null===(a=i.props.tlsConfig)||void 0===a?void 0:a.clientCert)||"",clientKey:(null===(r=i.props.tlsConfig)||void 0===r?void 0:r.clientKey)||"",serverName:(null===(o=i.props.tlsConfig)||void 0===o?void 0:o.serverName)||""},i.onUpdate=function(){var e={insecureSkipVerify:i.state.insecureSkipVerify,caCert:i.state.caCert,clientCert:i.state.clientCert,clientKey:i.state.clientKey,serverName:i.state.serverName};i.props.onChange(e)},i.onInsecureSkipVerifyChange=function(e){i.setState({insecureSkipVerify:!i.state.insecureSkipVerify},i.onUpdate)},i.onServerNameChange=function(e){i.setState({serverName:e.target.value},i.onUpdate)},i.onCACertChange=function(e){i.setState({caCert:e.target.value},i.onUpdate)},i.onClientCertChange=function(e){i.setState({clientCert:e.target.value},i.onUpdate)},i.onClientKeyChange=function(e){i.setState({clientKey:e.target.value},i.onUpdate)},i}return Object(h.c)(t,e),t.prototype.render=function(){var e=this.state,t=e.insecureSkipVerify,n=e.caCert,a=e.clientCert,r=e.clientKey,o=e.serverName,i=this.props.isEditor;return m.a.createElement("div",null,m.a.createElement(T.HorizontalGroup,null,m.a.createElement(T.Field,{label:"Skip Validation",description:"Disable target certificate validation",disabled:!i},m.a.createElement(T.Container,{padding:"sm"},m.a.createElement(T.Switch,{value:t,onChange:this.onInsecureSkipVerifyChange,disabled:!i}))),m.a.createElement(T.Field,{label:"Server Name",description:"Used to verify the hostname for the targets",disabled:!i},m.a.createElement(T.Input,{type:"text",placeholder:"ServerName",value:o,onChange:this.onServerNameChange,disabled:!i}))),m.a.createElement(T.Container,null,m.a.createElement(T.Field,{label:"CA Certificate",description:"The CA cert to use for the targets",disabled:!i},m.a.createElement("div",null,m.a.createElement(T.TextArea,{value:n,onChange:this.onCACertChange,rows:2,disabled:!i,placeholder:"CA Certificate"})))),m.a.createElement(T.Container,null,m.a.createElement(T.Field,{label:"Client Certificate",description:"The client cert file for the targets",disabled:!i},m.a.createElement("div",null,m.a.createElement(T.TextArea,{value:a,onChange:this.onClientCertChange,rows:2,disabled:!i,placeholder:"Client Certificate"})))),m.a.createElement(T.Container,null,m.a.createElement(T.Field,{label:"Client Key",description:"The client key file for the targets",disabled:!i},m.a.createElement("div",null,m.a.createElement(T.TextArea,{type:"password",value:r,onChange:this.onClientKeyChange,rows:2,disabled:!i,placeholder:"Client Key"})))))},t}(f.PureComponent),ae=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={headerMatches:t.props.headerMatches},t.onUpdate=function(){t.props.onChange(t.state.headerMatches)},t.onHeaderChange=function(e){return function(n){var a=[];t.state.headerMatches.forEach((function(t,r){r===e?a.push({header:n.target.value,regexp:t.regexp,allowMissing:t.allowMissing}):a.push(t)})),t.setState({headerMatches:a},t.onUpdate)}},t.onRegexpChange=function(e){return function(n){var a=[];t.state.headerMatches.forEach((function(t,r){r===e?a.push({header:t.header,regexp:n.target.value,allowMissing:t.allowMissing}):a.push(t)})),t.setState({headerMatches:a},t.onUpdate)}},t.onAllowMissingChange=function(e){return function(n){var a=[];t.state.headerMatches.forEach((function(t,n){n===e?a.push({header:t.header,regexp:t.regexp,allowMissing:!t.allowMissing}):a.push(t)})),t.setState({headerMatches:a},t.onUpdate)}},t.onHeaderMatchesDelete=function(e){return function(){var n,a=[];null===(n=t.state.headerMatches)||void 0===n||n.forEach((function(t,n){n!==e&&a.push(t)})),t.setState({headerMatches:a},t.onUpdate)}},t.onHeaderMatchesAdd=function(){var e=[];t.state.headerMatches.forEach((function(t){e.push(t)})),e.push({header:"",regexp:"",allowMissing:!1}),t.setState({headerMatches:e},t.onUpdate)},t}return Object(h.c)(t,e),t.prototype.render=function(){var e=this,t=this.state.headerMatches,n=this.props,a=n.isEditor,r=n.name,o=n.description;return m.a.createElement(T.Field,{label:r,description:o,disabled:!a},m.a.createElement(T.VerticalGroup,{justify:"space-between"},m.a.createElement(T.List,{items:t,renderItem:function(t,n){return m.a.createElement(T.HorizontalGroup,null,m.a.createElement(T.Input,{type:"text",placeholder:"header",value:t.header,onChange:e.onHeaderChange(n),disabled:!a}),m.a.createElement(T.Input,{type:"text",placeholder:"regexp",value:t.regexp,onChange:e.onRegexpChange(n),disabled:!a}),m.a.createElement(T.HorizontalGroup,null,m.a.createElement("span",null,"Allow Missing"),m.a.createElement(T.Container,{padding:"sm"},m.a.createElement(T.Switch,{title:"Allow Missing",value:t.allowMissing,onChange:e.onAllowMissingChange(n),disabled:!a}))),m.a.createElement(T.IconButton,{name:"minus-circle",onClick:e.onHeaderMatchesDelete(n),disabled:!a}))}}),m.a.createElement(T.Button,{onClick:this.onHeaderMatchesAdd,disabled:!a,variant:"secondary",size:"sm"},m.a.createElement(T.Icon,{name:"plus"}),"  Add Header Regexp")))},t}(f.PureComponent),re=function(e){function t(){var t,n,r,o,l,c,u,d,p,f=e.apply(this,Object(h.f)(arguments))||this;return f.state={showValidation:!1,showAdvanced:!1,recordType:(null===(t=f.props.settings.dns)||void 0===t?void 0:t.recordType)||i.A,server:(null===(n=f.props.settings.dns)||void 0===n?void 0:n.server)||"8.8.8.8",ipVersion:(null===(r=f.props.settings.dns)||void 0===r?void 0:r.ipVersion)||a.V4,protocol:(null===(o=f.props.settings.dns)||void 0===o?void 0:o.protocol)||s.UDP,port:(null===(l=f.props.settings.dns)||void 0===l?void 0:l.port)||53,validRCodes:(null===(c=f.props.settings.dns)||void 0===c?void 0:c.validRCodes)||[],validateAnswerRRS:null===(u=f.props.settings.dns)||void 0===u?void 0:u.validateAnswerRRS,validateAuthorityRRS:null===(d=f.props.settings.dns)||void 0===d?void 0:d.validateAuthorityRRS,validateAdditionalRRS:null===(p=f.props.settings.dns)||void 0===p?void 0:p.validateAdditionalRRS},f.onUpdate=function(){var e=f.state;f.props.onUpdate({dns:e})},f.onIpVersionChange=function(e){f.setState({ipVersion:e.value||a.Any},f.onUpdate)},f.onProtocolChange=function(e){f.setState({protocol:e.value||s.UDP},f.onUpdate)},f.onPortChange=function(e){f.setState({port:e.target.valueAsNumber||53},f.onUpdate)},f.onServerChange=function(e){f.setState({server:e.target.value},f.onUpdate)},f.onRecordTypeChange=function(e){f.setState({recordType:e.value||i.A},f.onUpdate)},f.onShowAdvanced=function(e){f.setState({showAdvanced:!f.state.showAdvanced})},f.onShowValidation=function(e){f.setState({showValidation:!f.state.showValidation})},f.onValidRCodesChange=function(e){var t,n,a=[];try{for(var r=Object(h.g)(e.values()),o=r.next();!o.done;o=r.next()){var i=o.value;i.value&&a.push(i.value)}}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}f.setState({validRCodes:a},f.onUpdate)},f.onValidateAnswerChange=function(e){if(console.log("validateAnswer update.",e),e){var t={failIfMatchesRegexp:e.failIfMatchesRegexp,failIfNotMatchesRegexp:e.failIfNotMatchesRegexp};f.setState({validateAnswerRRS:t},f.onUpdate)}else f.setState({validateAnswerRRS:void 0},f.onUpdate)},f.onValidateAuthorityChange=function(e){if(e){var t={failIfMatchesRegexp:e.failIfMatchesRegexp,failIfNotMatchesRegexp:e.failIfNotMatchesRegexp};f.setState({validateAuthorityRRS:t},f.onUpdate)}else f.setState({validateAuthorityRRS:void 0},f.onUpdate)},f.onValidateAdditionalChange=function(e){if(e){var t={failIfMatchesRegexp:e.failIfMatchesRegexp,failIfNotMatchesRegexp:e.failIfNotMatchesRegexp};f.setState({validateAdditionalRRS:t},f.onUpdate)}else f.setState({validateAdditionalRRS:void 0},f.onUpdate)},f}return Object(h.c)(t,e),t.prototype.render=function(){var e=this.state,t=e.ipVersion,n=e.recordType,a=e.server,r=e.port,o=e.protocol,l=e.showAdvanced,c=e.showValidation,u=e.validRCodes,d=e.validateAnswerRRS,p=e.validateAuthorityRRS,h=e.validateAdditionalRRS,f=this.props.isEditor,g=[{label:i.A,value:i.A},{label:i.AAAA,value:i.AAAA},{label:i.CNAME,value:i.CNAME},{label:i.MX,value:i.MX},{label:i.NS,value:i.NS},{label:i.SOA,value:i.SOA},{label:i.TXT,value:i.TXT},{label:i.PTR,value:i.PTR},{label:i.SRV,value:i.SRV}],v=[{label:s.UDP,value:s.UDP},{label:s.TCP,value:s.TCP}];return m.a.createElement(T.Container,null,m.a.createElement(T.HorizontalGroup,null,m.a.createElement(T.Field,{label:"Record Type",description:"DNS record type to query for",disabled:!f},m.a.createElement(T.Select,{value:n,options:g,onChange:this.onRecordTypeChange})),m.a.createElement(T.Field,{label:"Server",description:"Address of server to query",disabled:!f},m.a.createElement(T.Input,{value:a,type:"text",placeholder:"server",onChange:this.onServerChange})),m.a.createElement(T.Field,{label:"Protocol",description:"Transport protocol to use",disabled:!f},m.a.createElement(T.Select,{value:o,options:v,onChange:this.onProtocolChange})),m.a.createElement(T.Field,{label:"Port",description:"port on server to query",disabled:!f},m.a.createElement(T.Input,{value:r,type:"number",placeholder:"port",onChange:this.onPortChange}))),m.a.createElement(T.Collapse,{label:"Validation",collapsible:!0,onToggle:this.onShowValidation,isOpen:c},m.a.createElement(T.HorizontalGroup,null,m.a.createElement(T.Field,{label:"Valid Response Codes",description:"List of valid response codes",disabled:!f},m.a.createElement(T.MultiSelect,{value:u,options:[{label:"NOERROR",value:"NOERROR"}],onChange:this.onValidRCodesChange}))),m.a.createElement(oe,{name:"Validate Answer",description:"Validate entries in the Answer section of the DNS response",validations:d,onChange:this.onValidateAnswerChange,isEditor:f}),m.a.createElement(oe,{name:"Validate Authority",description:"Validate entries in the Authority section of the DNS response",validations:p,onChange:this.onValidateAuthorityChange,isEditor:f}),m.a.createElement(oe,{name:"Validate Additional",description:"Validate entries in the Additional section of the DNS response",validations:h,onChange:this.onValidateAdditionalChange,isEditor:f})),m.a.createElement(T.Collapse,{label:"Advanced Options",collapsible:!0,onToggle:this.onShowAdvanced,isOpen:l},m.a.createElement(T.HorizontalGroup,null,m.a.createElement("div",null,m.a.createElement(T.Field,{label:"IP Version",description:"The IP protocol of the ICMP request",disabled:!f},m.a.createElement(T.Select,{value:t,options:W,onChange:this.onIpVersionChange}))))))},t}(f.PureComponent),oe=function(e){function t(){var t,n,a=e.apply(this,Object(h.f)(arguments))||this;return a.state={failIfMatchesRegexp:(null===(t=a.props.validations)||void 0===t?void 0:t.failIfMatchesRegexp)||[],failIfNotMatchesRegexp:(null===(n=a.props.validations)||void 0===n?void 0:n.failIfNotMatchesRegexp)||[]},a.onUpdate=function(){var e={failIfMatchesRegexp:a.state.failIfMatchesRegexp,failIfNotMatchesRegexp:a.state.failIfNotMatchesRegexp};a.props.onChange(e)},a.onFailIfMatchesRegexpChange=function(e){return function(t){var n=[];a.state.failIfMatchesRegexp.forEach((function(a,r){r===e?n.push(t.target.value):n.push(a)})),a.setState({failIfMatchesRegexp:n},a.onUpdate)}},a.onFailIfNotMatchesRegexpChange=function(e){return function(t){var n=[];a.state.failIfNotMatchesRegexp.forEach((function(a,r){r===e?n.push(t.target.value):n.push(a)})),a.setState({failIfNotMatchesRegexp:n},a.onUpdate)}},a.onFailIfMatchesRegexpDelete=function(e){return function(){var t,n=[];null===(t=a.state.failIfMatchesRegexp)||void 0===t||t.forEach((function(t,a){a!==e&&n.push(t)})),a.setState({failIfMatchesRegexp:n},a.onUpdate)}},a.onFailIfNotMatchesRegexpDelete=function(e){return function(){var t,n=[];null===(t=a.state.failIfNotMatchesRegexp)||void 0===t||t.forEach((function(t,a){a!==e&&n.push(t)})),a.setState({failIfNotMatchesRegexp:n},a.onUpdate)}},a.onFailIfMatchesRegexpAdd=function(){var e=[];a.state.failIfMatchesRegexp.forEach((function(t){e.push(t)})),e.push(""),a.setState({failIfMatchesRegexp:e},a.onUpdate)},a.onFailIfNotMatchesRegexpAdd=function(){var e=[];a.state.failIfNotMatchesRegexp.forEach((function(t){e.push(t)})),e.push(""),a.setState({failIfNotMatchesRegexp:e},a.onUpdate)},a}return Object(h.c)(t,e),t.prototype.render=function(){var e=this,t=this.state,n=t.failIfMatchesRegexp,a=t.failIfNotMatchesRegexp,r=this.props,o=r.isEditor,i=r.name,s=r.description;return m.a.createElement(T.Container,null,m.a.createElement(T.HorizontalGroup,null,m.a.createElement(T.Field,{label:i+" matches",description:s+" match",disabled:!o},m.a.createElement(T.Container,null,m.a.createElement(T.List,{items:n,renderItem:function(t,n){return m.a.createElement(T.HorizontalGroup,null,m.a.createElement(T.Input,{type:"text",placeholder:"regexp",value:t,onChange:e.onFailIfMatchesRegexpChange(n),disabled:!o}),m.a.createElement(T.IconButton,{name:"minus-circle",onClick:e.onFailIfMatchesRegexpDelete(n),disabled:!o}))}}),m.a.createElement(T.IconButton,{name:"plus-circle",onClick:this.onFailIfMatchesRegexpAdd,disabled:!o}))),m.a.createElement(T.Field,{label:i+" doesn't match",description:s+" don't match",disabled:!o},m.a.createElement(T.Container,null,m.a.createElement(T.List,{items:a,renderItem:function(t,n){return m.a.createElement(T.HorizontalGroup,null,m.a.createElement(T.Input,{type:"text",placeholder:"regexp",value:t,onChange:e.onFailIfNotMatchesRegexpChange(n),disabled:!o}),m.a.createElement(T.IconButton,{name:"minus-circle",onClick:e.onFailIfNotMatchesRegexpDelete(n),disabled:!o}))}}),m.a.createElement(T.IconButton,{name:"plus-circle",onClick:this.onFailIfNotMatchesRegexpAdd,disabled:!o})))))},t}(f.PureComponent),ie=function(e){function t(){var t,n,r,o,i=e.apply(this,Object(h.f)(arguments))||this;return i.state={ipVersion:(null===(t=i.props.settings.tcp)||void 0===t?void 0:t.ipVersion)||a.V4,tls:(null===(n=i.props.settings.tcp)||void 0===n?void 0:n.tls)||!1,tlsConfig:null===(r=i.props.settings.tcp)||void 0===r?void 0:r.tlsConfig,queryResponse:null===(o=i.props.settings.tcp)||void 0===o?void 0:o.queryResponse,showQueryResponse:!1,showAdvanced:!1,showTLS:!1},i.onUpdate=function(){var e=i.state;i.props.onUpdate({tcp:e})},i.onIpVersionChange=function(e){i.setState({ipVersion:e.value||a.Any},i.onUpdate)},i.onToggleTLS=function(e){i.setState({showTLS:!i.state.showTLS},i.onUpdate)},i.onTLSChange=function(e){i.setState({tls:!i.state.tls},i.onUpdate)},i.onTLSCOnfigChange=function(e){i.setState({tlsConfig:e},i.onUpdate)},i.onShowAdvanced=function(e){i.setState({showAdvanced:!i.state.showAdvanced})},i.onShowQueryResponse=function(e){i.setState({showQueryResponse:!i.state.showQueryResponse})},i.onQueryResponsesUpdate=function(e){var t=[];i.state.queryResponse?e.forEach((function(e){t.push(e)})):t=e,i.setState({queryResponse:t},i.onUpdate)},i}return Object(h.c)(t,e),t.prototype.render=function(){var e=this.state,t=e.ipVersion,n=e.tls,a=e.showTLS,r=e.showQueryResponse,o=e.showAdvanced,i=e.tlsConfig,s=e.queryResponse,l=this.props.isEditor;return m.a.createElement(T.Container,null,m.a.createElement(T.Field,{label:"Use TLS",description:"Whether or not TLS is used when the connection is initiated.",disabled:!l},m.a.createElement(T.Container,{padding:"sm"},m.a.createElement(T.Switch,{title:"Use TLS",value:n,onChange:this.onTLSChange,disabled:!l}))),m.a.createElement(T.Collapse,{label:"Query/Response",collapsible:!0,onToggle:this.onShowQueryResponse,isOpen:r},m.a.createElement(T.Container,null,m.a.createElement(se,{queryResponses:s,isEditor:l,onChange:this.onQueryResponsesUpdate}))),m.a.createElement(T.Collapse,{label:"TLS Config",collapsible:!0,onToggle:this.onToggleTLS,isOpen:a},m.a.createElement(ne,{onChange:this.onTLSCOnfigChange,isEditor:l,tlsConfig:i})),m.a.createElement(T.Collapse,{label:"Advanced Options",collapsible:!0,onToggle:this.onShowAdvanced,isOpen:o},m.a.createElement(T.HorizontalGroup,null,m.a.createElement("div",null,m.a.createElement(T.Field,{label:"IP Version",description:"The IP protocol of the ICMP request",disabled:!l},m.a.createElement(T.Select,{value:t,options:W,onChange:this.onIpVersionChange}))))))},t}(f.PureComponent),se=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={queryResponses:(t.props.queryResponses||[]).map((function(e){return{expect:atob(e.expect),send:atob(e.send),startTLS:e.startTLS}}))},t.onUpdate=function(){var e=[];t.state.queryResponses.forEach((function(t){e.push({expect:btoa(t.expect),send:btoa(t.send),startTLS:t.startTLS})})),t.props.onChange(e)},t.onSendChange=function(e){return function(n){var a=[];t.state.queryResponses.forEach((function(t,r){r===e?a.push({send:n.target.value,expect:t.expect,startTLS:t.startTLS}):a.push(t)})),t.setState({queryResponses:a},t.onUpdate)}},t.onExpectChange=function(e){return function(n){var a=[];t.state.queryResponses.forEach((function(t,r){r===e?a.push({send:t.send,expect:n.target.value,startTLS:t.startTLS}):a.push(t)})),t.setState({queryResponses:a},t.onUpdate)}},t.onStartTLSChange=function(e){return function(n){var a=[];t.state.queryResponses.forEach((function(t,n){n===e?a.push({send:t.send,expect:t.expect,startTLS:!t.startTLS}):a.push(t)})),t.setState({queryResponses:a},t.onUpdate)}},t.onQueryResponseDelete=function(e){return function(){var n=[];t.state.queryResponses.forEach((function(t,a){a!==e&&n.push(t)})),t.setState({queryResponses:n},t.onUpdate)}},t.onQueryResponseAdd=function(){var e=[];t.state.queryResponses.forEach((function(t){e.push(t)})),e.push({send:"",expect:"",startTLS:!1}),t.setState({queryResponses:e},t.onUpdate)},t}return Object(h.c)(t,e),t.prototype.render=function(){var e=this,t=this.state.queryResponses,n=this.props.isEditor;return m.a.createElement(T.Field,{label:"Query/Response",description:"The query sent in the TCP probe and the expected associated response. StartTLS upgrades TCP connection to TLS.",disabled:!n},m.a.createElement(T.Container,null,m.a.createElement(T.List,{items:t,renderItem:function(t,a){return m.a.createElement(T.HorizontalGroup,null,m.a.createElement(T.Input,{type:"text",placeholder:"response to expect",value:t.expect,onChange:e.onExpectChange(a),disabled:!n}),m.a.createElement(T.TextArea,{type:"text",placeholder:"data to send",rows:1,value:t.send,onChange:e.onSendChange(a),disabled:!n}),m.a.createElement(T.HorizontalGroup,null,m.a.createElement("span",null,"StartTLS"),m.a.createElement(T.Container,{padding:"sm"},m.a.createElement(T.Switch,{title:"StartTLS",value:t.startTLS,onChange:e.onStartTLSChange(a),disabled:!n}))),m.a.createElement(T.IconButton,{name:"minus-circle",onClick:e.onQueryResponseDelete(a),disabled:!n}))}}),m.a.createElement(T.IconButton,{name:"plus-circle",onClick:this.onQueryResponseAdd,disabled:!n})))},t}(f.PureComponent),le=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={showDeleteModal:!1,showOptions:!1,probes:[],targetHelp:{example:""}},t.showDeleteCheckModal=function(e){return function(){t.setState({showDeleteModal:e})}},t.onRemoveCheck=function(){return Object(h.b)(t,void 0,void 0,(function(){var e,t;return Object(h.d)(this,(function(n){return e=this.props.check.id||0,this.props.check.id?(t=this.props.instance.deleteCheck(e),console.log("Remove Check",e,t),this.props.onReturn(!0),[2]):[2]}))}))},t.onLabelsUpdate=function(e){var n=Object(h.a)({},t.state.check);n.labels=e,t.setState({check:n})},t.onProbesUpdate=function(e){var n=Object(h.a)({},t.state.check);n.probes=e,t.setState({check:n})},t.onSettingsUpdate=function(e){var n=Object(h.a)({},t.state.check);n.settings=e,t.setState({check:n})},t.onSetType=function(e){var n=Object(h.a)({},t.state.check);if(e.value){var a=e.value,r=S(a);if(r){n.settings=r;var o=t.targetHelpText(a);t.setState({check:n,targetHelp:o,typeOfCheck:a})}}},t.onJobUpdate=function(e){var n=Object(h.a)({},t.state.check);n.job=e.target.value,t.setState({check:n})},t.onTargetUpdate=function(e){var n=Object(h.a)({},t.state.check);n.target=e.target.value,t.setState({check:n})},t.onFrequencyUpdate=function(e){var n=Object(h.a)({},t.state.check);n.frequency=1e3*e.target.valueAsNumber,t.setState({check:n})},t.onTimeoutUpdate=function(e){var n=Object(h.a)({},t.state.check);n.timeout=1e3*e.target.valueAsNumber,t.setState({check:n})},t.onSave=function(){return Object(h.b)(t,void 0,void 0,(function(){var e,t,n;return Object(h.d)(this,(function(a){switch(a.label){case 0:return e=this.props.instance,(t=this.state.check)?t.id?(console.log("UPDATE",t,e),[4,e.updateCheck(t)]):[3,2]:[2];case 1:return n=a.sent(),console.log("got",n),[3,4];case 2:return console.log("ADD",t),[4,e.addCheck(t)];case 3:n=a.sent(),console.log("got",n),a.label=4;case 4:return this.props.onReturn(!0),[2]}}))}))},t.onEnableChange=function(e){var n=Object(h.a)({},t.state.check);n.enabled=!n.enabled,t.setState({check:n})},t.onBack=function(){t.props.onReturn(!1)},t.onToggleOptions=function(e){t.setState({showOptions:!t.state.showOptions})},t}return Object(h.c)(t,e),t.prototype.componentDidMount=function(){return Object(h.b)(this,void 0,void 0,(function(){var e,t,n,a,r;return Object(h.d)(this,(function(o){switch(o.label){case 0:return e=this.props.instance,t=Object(h.a)({},this.props.check),[4,e.listProbes()];case 1:return n=o.sent(),a=C(t.settings),r=this.targetHelpText(a),this.setState({check:t,typeOfCheck:a,probes:n,targetHelp:r}),[2]}}))}))},t.prototype.targetHelpText=function(e){if(!e)return{text:"",example:""};var t;switch(e){case l.HTTP:t={text:"Full URL to send requests to",example:"https://grafana.com/"};break;case l.PING:t={text:"Hostname to ping",example:"grafana.com"};break;case l.DNS:t={text:"Name of record to query",example:"grafana.com"};break;case l.TCP:t={text:"Host:port to connect to",example:"grafana.com:80"}}return t},t.prototype.render=function(){var e=this.state,t=e.check,n=e.showDeleteModal,a=e.probes,r=e.targetHelp,o=e.typeOfCheck,i=e.showOptions;if(!t||0===a.length)return m.a.createElement("div",null,"Loading...");var s="Edit Check";t.id||(s="Add Check");var u=E(c.EDITOR),d=[{label:"HTTP",value:l.HTTP},{label:"PING",value:l.PING},{label:"DNS",value:l.DNS},{label:"TCP",value:l.TCP}];return m.a.createElement("div",null,m.a.createElement(T.Legend,null,s),m.a.createElement("div",null,m.a.createElement(T.HorizontalGroup,{justify:"flex-start",spacing:"md"},m.a.createElement(T.Field,{label:"Check Type",disabled:!!t.id},m.a.createElement(T.Select,{value:o,options:d,onChange:this.onSetType,width:30})),m.a.createElement(T.Field,{label:"Enabled",disabled:!u},m.a.createElement(T.Container,{padding:"sm"},m.a.createElement(T.Switch,{value:t.enabled,onChange:this.onEnableChange,disabled:!u})))),m.a.createElement(T.Field,{label:"Job Name",description:"Name used for job label",disabled:!u,invalid:!F(t.job)},m.a.createElement(T.Input,{type:"string",placeholder:"jobName",value:t.job,onChange:this.onJobUpdate})),m.a.createElement(T.Field,{label:"Target",description:r.text,disabled:!u,invalid:!V(C(t.settings),t.target)},m.a.createElement(T.Input,{type:"string",placeholder:r.example,value:t.target,onChange:this.onTargetUpdate,required:!0})),m.a.createElement("div",null,m.a.createElement(T.Field,{label:"Probe Locations",description:"Select the locations where this target should be monitored from",disabled:!u,invalid:!Q(t.probes)},m.a.createElement(ue,{probes:t.probes,availableProbes:a,onUpdate:this.onProbesUpdate,isEditor:u}))),m.a.createElement(T.Collapse,{label:"Options",collapsible:!0,onToggle:this.onToggleOptions,isOpen:i},m.a.createElement(T.Field,{label:"Frequency",description:"How frequently the check should run.",disabled:!u,invalid:!B(t.frequency)},m.a.createElement(T.Input,{label:"Frequency",type:"number",step:10,value:t.frequency/1e3||60,onChange:this.onFrequencyUpdate,suffix:"seconds",max:120,min:10,width:30})),m.a.createElement(T.Field,{label:"Timeout",description:"Maximum execution time for a check",disabled:!u,invalid:!H(t.timeout)},m.a.createElement(T.Input,{label:"Timeout",type:"number",step:.1,value:t.timeout/1e3||5,onChange:this.onTimeoutUpdate,suffix:"seconds",max:10,min:1,width:30})),m.a.createElement(T.Field,{label:"Labels",description:"Custom labels to be included with collected metrics and logs.",disabled:!u,invalid:!q(t.labels)},m.a.createElement(X,{labels:t.labels,onUpdate:this.onLabelsUpdate,isEditor:u,type:"Label",limit:5})),m.a.createElement("br",null),m.a.createElement("h3",{className:"page-heading"},o.toLocaleUpperCase()," Settings"),m.a.createElement(ce,{settings:t.settings,typeOfCheck:o||l.HTTP,onUpdate:this.onSettingsUpdate,isEditor:u}))),m.a.createElement(T.HorizontalGroup,null,m.a.createElement(T.Button,{onClick:this.onSave,disabled:!u||!L(t)},"Save ",L(t)),t.id&&m.a.createElement(T.Button,{variant:"destructive",onClick:this.showDeleteCheckModal(!0),disabled:!u},"Delete Check"),m.a.createElement(T.ConfirmModal,{isOpen:n,title:"Delete check",body:"Are you sure you want to delete this check?",confirmText:"Delete check",onConfirm:this.onRemoveCheck,onDismiss:this.showDeleteCheckModal(!1)}),m.a.createElement("a",{onClick:this.onBack},"Back")))},t}(f.PureComponent),ce=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={},t.onUpdate=function(){t.props.onUpdate(t.state.settings)},t.onJsonChange=function(e){var n={};n[t.props.typeOfCheck]=JSON.parse(e.target.value),t.setState({settings:n},t.onUpdate)},t.onSettingsChange=function(e){t.setState({settings:e},t.onUpdate)},t}return Object(h.c)(t,e),t.prototype.componentDidMount=function(){var e=this.props.settings;this.setState({settings:e})},t.prototype.componentDidUpdate=function(e){var t=this.props,n=t.settings;t.typeOfCheck!==e.typeOfCheck&&this.setState({settings:n})},t.prototype.render=function(){var e=this.state.settings;if(!e)return m.a.createElement("div",null,"Loading....");var t=this.props.isEditor;switch(this.props.typeOfCheck){case l.PING:return m.a.createElement(Z,{settings:e,onUpdate:this.onSettingsChange,isEditor:t});case l.HTTP:return m.a.createElement(te,{settings:e,onUpdate:this.onSettingsChange,isEditor:t});case l.DNS:return m.a.createElement(re,{settings:e,onUpdate:this.onSettingsChange,isEditor:t});case l.TCP:return m.a.createElement(ie,{settings:e,onUpdate:this.onSettingsChange,isEditor:t})}},t}(f.PureComponent),ue=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={probes:t.props.probes||[],probeStr:t.props.probes.join(",")},t.onChange=function(e){var n,a,r=[];try{for(var o=Object(h.g)(e.values()),i=o.next();!i.done;i=o.next()){var s=i.value;s.value&&r.push(s.value)}}catch(e){n={error:e}}finally{try{i&&!i.done&&(a=o.return)&&a.call(o)}finally{if(n)throw n.error}}var l=r.join(",");t.setState({probes:r,probeStr:l},t.onUpdate)},t.onUpdate=function(){t.props.onUpdate(t.state.probes)},t.onAllLocations=function(){var e,n,a=[];try{for(var r=Object(h.g)(t.props.availableProbes),o=r.next();!o.done;o=r.next()){var i=o.value;i.id&&a.push(i.id)}}catch(t){e={error:t}}finally{try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(e)throw e.error}}var s=a.join(",");t.setState({probes:a,probeStr:s},t.onUpdate)},t.onClearLocations=function(){t.setState({probes:[],probeStr:""},t.onUpdate)},t}return Object(h.c)(t,e),t.prototype.render=function(){var e,t,n,a,r=this.state.probes,o=this.props,i=o.availableProbes,s=o.isEditor,l=[];try{for(var c=Object(h.g)(i),u=c.next();!u.done;u=c.next()){var d=u.value;l.push({label:d.name,value:d.id,description:d.online?"Online":"Offline"})}}catch(t){e={error:t}}finally{try{u&&!u.done&&(t=c.return)&&t.call(c)}finally{if(e)throw e.error}}var p=[],f=function(e){var t=l.find((function(t){return t.value===e}));t&&p.push(t)};try{for(var g=Object(h.g)(r),v=g.next();!v.done;v=g.next()){f(d=v.value)}}catch(e){n={error:e}}finally{try{v&&!v.done&&(a=g.return)&&a.call(g)}finally{if(n)throw n.error}}return m.a.createElement("div",null,m.a.createElement(T.MultiSelect,{options:l,value:p,onChange:this.onChange,disabled:!s,invalid:!Q(r),closeMenuOnSelect:!1}),m.a.createElement(T.Container,{margin:"xs"},m.a.createElement(T.HorizontalGroup,{spacing:"md"},m.a.createElement(T.Button,{onClick:this.onAllLocations,disabled:!s,variant:"secondary",size:"sm"},"All  "),m.a.createElement(T.Button,{onClick:this.onClearLocations,disabled:!s,variant:"secondary",size:"sm",type:"reset"},"Clear"))))},t}(f.PureComponent),de=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={lastUpdate:0,value:{numeric:0,title:"Uptime",text:"loading..."},points:[]},t}return Object(h.c)(t,e),t.prototype.filterString=function(e,t){var n=[];for(var a in e){var r=e[a],o=t[a];n.push(r+'="'+o+'"')}return n.join(",")},t.prototype.componentDidMount=function(){return Object(h.b)(this,void 0,void 0,(function(){var e,t,n,a;return Object(h.d)(this,(function(r){return e=this.props,t=e.labelNames,n=e.labelValues,a=this.filterString(t,n),this.setState({filter:a},this.queryUptime),[2]}))}))},t.prototype.componentDidUpdate=function(e){return Object(h.b)(this,void 0,void 0,(function(){var e,t,n,a;return Object(h.d)(this,(function(r){return e=this.props,t=e.labelNames,n=e.labelValues,a=this.filterString(t,n),this.state.filter!==a&&this.setState({filter:a},this.queryUptime),[2]}))}))},t.prototype.queryUptime=function(){return Object(h.b)(this,void 0,void 0,(function(){var e,t,n,a,r,o,i,s,l,c,d=this;return Object(h.d)(this,(function(p){switch(p.label){case 0:return e=this.props,t=e.ds,n=e.sparkline,(a=this.state.filter)?(r=Object(u.getBackendSrv)(),o=Math.floor(Date.now()/1e3),[4,r.datasourceRequest({method:"GET",url:t.url+"/api/v1/query",params:{query:"sum(rate(probe_success_sum{"+a+"}[3h])) / sum(rate(probe_success_count{"+a+"}[3h]))",time:o}})]):[2];case 1:return(i=p.sent()).ok?(s={numeric:0,title:"Uptime",text:"loading..."},i.data.data.result.length<1?(s.text="N/A",this.setState({value:s,lastUpdate:o}),[2]):(l=100*parseFloat(i.data.data.result[0].value[1]),c="green",l<99&&(c="red"),s.color=c,s.numeric=l,s.text=l.toFixed(2)+"%",this.setState({value:s,lastUpdate:o},(function(){n&&d.queryHistory()})),[2])):(console.log(i),[2])}}))}))},t.prototype.queryHistory=function(){return Object(h.b)(this,void 0,void 0,(function(){var e,t,n,a,r,o,i,s,l,c,d,p;return Object(h.d)(this,(function(f){switch(f.label){case 0:return e=this.props.ds,(t=this.state.filter)?(n=Object(u.getBackendSrv)(),a=this.state.lastUpdate+1,[4,n.datasourceRequest({method:"POST",url:e.url+"/api/v1/query_range",params:{query:"100 * sum(rate(probe_success_sum{"+t+"}[10m])) / sum(rate(probe_success_count{"+t+"}[10m]))",start:a-10800,end:a,step:600}})]):[2];case 1:if(!(r=f.sent()).ok)return console.log(r),[2];if(o=[],r.data.data.result.length<1)return console.log(r.data),[2];i=0;try{for(s=Object(h.g)(r.data.data.result[0].values),l=s.next();!l.done;l=s.next())c=l.value,o.push([i,parseFloat(c[1])]),i++}catch(e){d={error:e}}finally{try{l&&!l.done&&(p=s.return)&&p.call(s)}finally{if(d)throw d.error}}return this.setState({points:o,lastUpdate:a+1}),[2]}}))}))},t.prototype.render=function(){var e=this.state,t=e.value,n=e.points,a=this.props,r=a.height,o=a.width,i=a.sparkline,s=a.onClick,l=void 0;return i&&n.length>0&&(l={yMin:0,yMax:150,data:n}),m.a.createElement(T.Container,null,m.a.createElement(T.BigValue,{theme:u.config.theme,colorMode:T.BigValueColorMode.Value,height:r,width:o,graphMode:T.BigValueGraphMode.Area,value:t,sparkline:l,onClick:s}))},t}(f.PureComponent),pe=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={iconName:"heart",className:"paused"},t}return Object(h.c)(t,e),t.prototype.componentDidMount=function(){return Object(h.b)(this,void 0,void 0,(function(){return Object(h.d)(this,(function(e){switch(e.label){case 0:return this.props.check.enabled?[4,this.queryUptime()]:(this.setState({iconName:"pause"}),[2]);case 1:return e.sent(),[2]}}))}))},t.prototype.componentDidUpdate=function(e){return Object(h.b)(this,void 0,void 0,(function(){return Object(h.d)(this,(function(t){switch(t.label){case 0:return this.props.check.id===e.check.id?[2]:this.props.check.enabled?[4,this.queryUptime()]:(this.setState({iconName:"pause"}),[2]);case 1:return t.sent(),[2]}}))}))},t.prototype.queryUptime=function(){return Object(h.b)(this,void 0,void 0,(function(){var e,t,n,a,r,o,i,s,l,c;return Object(h.d)(this,(function(d){switch(d.label){case 0:return e=this.props,t=e.ds,n=e.check,a='instance="'+n.target+'", job="'+n.job+'"',r=Object(u.getBackendSrv)(),o=Math.floor(Date.now()/1e3),[4,r.datasourceRequest({method:"GET",url:t.url+"/api/v1/query",params:{query:"sum(probe_success{"+a+"}) / count(probe_success{"+a+"})",time:o}})];case 1:return(i=d.sent()).ok?(s="heart",l="ok",i.data.data.result.length<1?(s="question-circle",l="paused",this.setState({iconName:s,className:l}),[2]):((c=100*parseFloat(i.data.data.result[0].value[1]))<99&&(l="warning"),c<50&&(l="critical",s="heart-break"),this.setState({iconName:s,className:l}),[2])):(console.log(i),[2])}}))}))},t.prototype.render=function(){var e=this.state,t=e.iconName,n=e.className;return m.a.createElement(T.Icon,{name:t,size:"xxl",className:"alert-rule-item__icon alert-state-"+n})},t}(f.PureComponent),he=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={checks:[],filteredChecks:[],addNew:!1,typeFilter:"all",searchFilter:"",totalPages:1,currentPage:1,checksPerPage:t.props.checksPerPage||15,loading:!0},t.onSelectCheck=function(e){Object(u.getLocationSrv)().update({partial:!0,query:{id:e}})},t.showDashboard=function(e){return function(n){n.stopPropagation();var a=t.props.instance,r=Object.keys(e.settings)[0],o=w(r,a.api);if(o){var i="d/"+o.uid,s={"var-instance":e.target,"var-job":e.job};Object(u.getLocationSrv)().update({partial:!1,path:i,query:s})}else console.log("dashboard not found.",r)}},t.onTypeFilterChanged=function(e){e.value&&t.setState({typeFilter:e.value,currentPage:1},t.filterChecks)},t.onFilterByLabel=function(e,n){return function(a){a.stopPropagation(),t.setState({searchFilter:e+"="+n,currentPage:1},t.filterChecks)}},t.onSearchFilterChange=function(e){t.setState({searchFilter:e},t.filterChecks)},t.changePage=function(e){t.setState({currentPage:e},t.filterChecks)},t.onAddNew=function(){t.setState({addNew:!0})},t.onRefresh=function(){return Object(h.b)(t,void 0,void 0,(function(){var e,t;return Object(h.d)(this,(function(n){switch(n.label){case 0:return[4,this.props.instance.api.listChecks()];case 1:return e=n.sent(),t=e.sort((function(e,t){return t.job.localeCompare(e.job)})),this.setState({checks:t},this.filterChecks),[2]}}))}))},t.onGoBack=function(e){t.setState({addNew:!1}),e&&t.onRefresh(),Object(u.getLocationSrv)().update({partial:!0,query:{id:""}})},t}return Object(h.c)(t,e),t.prototype.componentDidMount=function(){return Object(h.b)(this,void 0,void 0,(function(){var e,t,n,a,r,o,i,s,l;return Object(h.d)(this,(function(c){switch(c.label){case 0:return e=this.props,t=e.instance,n=e.id,a=this.state.checksPerPage,[4,t.api.listChecks()];case 1:return r=c.sent(),o=r.sort((function(e,t){return t.job.localeCompare(e.job)})),i=Math.ceil(o.length/a),s=n?parseInt(n,10):-1,l=r.find((function(e){return e.id===s})),this.setState({checks:o,check:l,totalPages:i,filteredChecks:o.slice(0,a),loading:!1}),[2]}}))}))},t.prototype.componentDidUpdate=function(e){if(this.props.id!==e.id){var t=this.props.id,n=t?parseInt(t,10):-1,a=this.state.checks.find((function(e){return e.id===n}));this.setState({check:a})}},t.prototype.formatLabels=function(e){var t=this;return e.map((function(e){return m.a.createElement("div",null,m.a.createElement("a",{onClick:t.onFilterByLabel(e.name,e.value)},e.name,"=",e.value))}))},t.prototype.filterChecks=function(){var e=this.state,t=e.typeFilter,n=e.searchFilter,a=e.currentPage,r=e.checks,o=e.checksPerPage,i=r.filter((function(e){return"all"===t||Object.keys(e.settings)[0]===t})).filter((function(e){var t,a,r,o;if(!n)return!0;if(n.split("=").length>1){var i=n.split("=",2),s=i[0],l=i[1];switch(s){case"target":return e.target.match(l);case"job":return e.job.match(l);default:try{for(var c=Object(h.g)(e.labels),u=c.next();!u.done;u=c.next()){if((f=u.value).name===s&&f.value.match(l))return!0}}catch(e){t={error:e}}finally{try{u&&!u.done&&(a=c.return)&&a.call(c)}finally{if(t)throw t.error}}}return!1}if(e.job.match(n)||e.target.match(n))return!0;try{for(var d=Object(h.g)(e.labels),p=d.next();!p.done;p=d.next()){var f;if((f=p.value).name.match(n)||f.value.match(n))return!0}}catch(e){r={error:e}}finally{try{p&&!p.done&&(o=d.return)&&o.call(d)}finally{if(r)throw r.error}}return!1})),s=Math.ceil(i.length/o);this.setState({totalPages:s,filteredChecks:i.slice(o*(a-1),a*o)})},t.prototype.renderNoChecks=function(){return m.a.createElement(T.InfoBox,{title:"Grafna Cloud Synthetic Monitoring",url:"https://grafana.com/docs/grafana-cloud/synthetic-monitoring/"},m.a.createElement("p",null,"This account does not currently have any checks configured. Click the button below to start monitoring your services with Grafana Cloud."),E(c.EDITOR)&&m.a.createElement(T.Button,{variant:"primary",onClick:this.onAddNew},"New Check"))},t.prototype.renderCheckList=function(){var e=this,t=this.state,n=t.checks,a=t.typeFilter,r=t.searchFilter,o=t.filteredChecks,i=t.totalPages,s=t.currentPage,u=this.props.instance;if(!n)return null;if(0===n.length)return this.renderNoChecks();var d=[{label:"All",value:"all"},{label:"HTTP",value:l.HTTP},{label:"PING",value:l.PING},{label:"DNS",value:l.DNS},{label:"TCP",value:l.TCP}],h=u.api.getMetricsDS();return m.a.createElement("div",null,m.a.createElement("div",{className:"page-action-bar"},m.a.createElement("div",{className:"gf-form gf-form--grow"},m.a.createElement(T.Input,{autoFocus:!0,prefix:m.a.createElement(T.Icon,{name:"search"}),width:40,type:"text",value:r?Object(p.unEscapeStringFromRegex)(r):"",onChange:function(t){return e.onSearchFilterChange(Object(p.escapeStringForRegex)(t.currentTarget.value))},placeholder:"search checks"})),m.a.createElement("div",{className:"gf-form"},m.a.createElement("label",{className:"gf-form-label"},"Types"),m.a.createElement("div",{className:"width-13"},m.a.createElement(T.Select,{options:d,onChange:this.onTypeFilterChanged,value:a}))),m.a.createElement("div",{className:"page-action-bar__spacer"}),E(c.EDITOR)&&m.a.createElement(T.Button,{variant:"secondary",onClick:this.onAddNew},"New Check")),m.a.createElement("section",{className:"card-section card-list-layout-list"},m.a.createElement("ol",{className:"card-list"},o.map((function(t){var n=t.id||0;if(t.id){var a=Object.keys(t.settings)[0];return m.a.createElement("li",{className:"card-item-wrapper"},m.a.createElement("a",{className:"card-item",onClick:function(){return e.onSelectCheck(n)}},m.a.createElement(T.HorizontalGroup,{justify:"space-between"},m.a.createElement("div",{className:"card-item-body"},m.a.createElement("figure",{className:"card-item-figure"},m.a.createElement(pe,{check:t,ds:h})),m.a.createElement(T.VerticalGroup,null,m.a.createElement("div",{className:"card-item-name"},t.target),m.a.createElement("div",{className:"card-item-sub-name"},t.job))),m.a.createElement(T.HorizontalGroup,{justify:"flex-end"},m.a.createElement("div",{className:"card-item-header"},m.a.createElement("div",{className:"card-item-type"},a),e.formatLabels(t.labels)),m.a.createElement(T.Container,{margin:"lg"},m.a.createElement("a",{onClick:e.showDashboard(t)},m.a.createElement(T.Icon,{name:"apps",size:"xl"}))),m.a.createElement(de,{labelNames:["instance","job"],labelValues:[t.target,t.job],ds:h,height:70,width:150,sparkline:!1})))))}})))),i>1&&m.a.createElement(T.Pagination,{numberOfPages:i,currentPage:s,onNavigate:this.changePage}))},t.prototype.render=function(){var e=this.props.instance,t=this.state,n=t.check,r=t.addNew;if(t.loading)return m.a.createElement("div",null,"Loading...");if(n)return m.a.createElement(le,{check:n,instance:e.api,onReturn:this.onGoBack});if(r){var o={job:"",target:"",frequency:6e4,timeout:2500,enabled:!0,labels:[],probes:[],settings:{ping:{ipVersion:a.V4,dontFragment:!1}}};return m.a.createElement(le,{check:o,instance:e.api,onReturn:this.onGoBack})}return m.a.createElement("div",null,this.renderCheckList())},t}(f.PureComponent),fe=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={showDeleteModal:!1,showTokenModal:!1,showResetModal:!1,probeToken:""},t.showDeleteProbeModal=function(e){return function(){t.setState({showDeleteModal:e})}},t.showTokenModal=function(e){return function(){t.setState({showTokenModal:e})}},t.showResetModal=function(e){return function(){t.setState({showResetModal:e})}},t.onRemoveProbe=function(){return Object(h.b)(t,void 0,void 0,(function(){var e,t;return Object(h.d)(this,(function(n){return e=this.props.probe.id||0,this.props.probe.id?(t=this.props.instance.deleteProbe(e),console.log("Remove Probe",e,t),this.props.onReturn(!0),[2]):[2]}))}))},t.onLabelsUpdate=function(e){var n=Object(h.a)({},t.state.probe);n.labels=e,t.setState({probe:n})},t.onLatUpdate=function(e){var n=Object(h.a)({},t.state.probe);n.latitude=e.target.valueAsNumber,t.setState({probe:n})},t.onLongUpdate=function(e){var n=Object(h.a)({},t.state.probe);n.longitude=e.target.valueAsNumber,t.setState({probe:n})},t.onRegionUpdate=function(e){var n=Object(h.a)({},t.state.probe);n.region=e.target.value,t.setState({probe:n})},t.onNameUpdate=function(e){var n=Object(h.a)({},t.state.probe);n.name=e.target.value,t.setState({probe:n})},t.onSave=function(){return Object(h.b)(t,void 0,void 0,(function(){var e,t,n;return Object(h.d)(this,(function(a){switch(a.label){case 0:return e=this.props.instance,(t=this.state.probe)?t.id?(console.log("UPDATE",t,e),[4,e.updateProbe(t)]):[3,2]:[2];case 1:return n=a.sent(),console.log("got",n),this.props.onReturn(!0),[3,4];case 2:return console.log("ADD",t),[4,e.addProbe(t)];case 3:n=a.sent(),this.setState({showTokenModal:!0,probeToken:n.token}),a.label=4;case 4:return[2]}}))}))},t.onResetToken=function(){return Object(h.b)(t,void 0,void 0,(function(){var e,t,n;return Object(h.d)(this,(function(a){switch(a.label){case 0:return e=this.props.instance,t=Object(h.a)({},this.props.probe),[4,e.resetProbeToken(t)];case 1:return n=a.sent(),this.setState({showTokenModal:!0,showResetModal:!1,probeToken:n.token}),[2]}}))}))},t.onBack=function(){t.props.onReturn(!1)},t}return Object(h.c)(t,e),t.prototype.componentDidMount=function(){return Object(h.b)(this,void 0,void 0,(function(){var e;return Object(h.d)(this,(function(t){return e=Object(h.a)({},this.props.probe),this.setState({probe:e}),[2]}))}))},t.prototype.isValid=function(){var e,t,n=this.state.probe;if(!n)return!1;if(""===n.name)return console.log("probe name must be set"),!1;if(n.name.length>32)return console.log("probe name must be less than 32 characters"),!1;if(n.latitude<-90||n.latitude>90)return console.log("probe latitude must be between -90 and 90"),!1;if(n.longitude<-180||n.longitude>180)return console.log("probe longitude must be between -180 and 180"),!1;if(""===n.region)return console.log("probe region must be set"),!1;if(n.labels.length>3)return console.log("probes cannot have more than 3 labels"),!1;try{for(var a=Object(h.g)(n.labels),r=a.next();!r.done;r=a.next()){var o=r.value;if(""===o.name||""===o.value)return console.log("label name and value must be set"),!1;if(!o.name.match(/^[a-zA-Z0-9_]*$/))return console.log("label name can only contain a-zA-Z0-9_"),!1;if(o.name.length>32)return console.log("label name must be less than 32 chars"),!1;if(o.value.length>64)return console.log("label name must be less than 64 chars"),!1}}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}return!0},t.prototype.renderStatus=function(){var e=this.state,t=e.probe,n=e.showResetModal,a=this.props.instance;if(t){var r=!t.public&&E(c.EDITOR),o="Offline",i="heart-break",s="red";return t.online&&(o="Online",i="heart",s="green"),m.a.createElement(T.Container,{margin:"md"},m.a.createElement(T.Legend,null,"Status:  ",m.a.createElement(T.Badge,{color:s,icon:i,text:o})),!t.public&&m.a.createElement(T.Container,null,m.a.createElement(T.Button,{variant:"destructive",onClick:this.showResetModal(!0),disabled:!r},"Reset Access Token"),m.a.createElement(T.ConfirmModal,{isOpen:n,title:"Reset Probe Access Token",body:"Are you sure you want to reset the access token for this Probe?",confirmText:"Reset Token",onConfirm:this.onResetToken,onDismiss:this.showResetModal(!1)})),m.a.createElement("br",null),m.a.createElement(de,{labelNames:["probe"],labelValues:[t.name],ds:a.getMetricsDS(),height:200,width:300,sparkline:!0}))}},t.prototype.render=function(){var e,t,n=this.state,a=n.probe,r=n.showDeleteModal,o=n.showTokenModal,i=n.probeToken;if(!a)return m.a.createElement("div",null,"Loading...");var s="Configuration";a.id||(s="Add Probe");var l=!a.public&&E(c.EDITOR);return m.a.createElement(T.HorizontalGroup,{align:"flex-start"},m.a.createElement(T.Container,null,m.a.createElement(T.Legend,null,s),m.a.createElement(T.Container,{margin:"md"},m.a.createElement(T.HorizontalGroup,null,m.a.createElement(T.Field,{label:"Probe Name",description:"Unique name of probe",disabled:!l},m.a.createElement(T.Input,{type:"string",value:a.name,onChange:this.onNameUpdate})),m.a.createElement(T.Field,{label:"Public",description:"Public probes are run by Grafana Labs and can be used by all users",disabled:!l},m.a.createElement(T.Container,{padding:"sm"},m.a.createElement(T.Switch,{value:a.public,disabled:!1}))))),m.a.createElement(T.Container,{margin:"md"},m.a.createElement("h3",{className:"page-heading"},"Location information"),m.a.createElement(T.HorizontalGroup,null,m.a.createElement(T.Field,{label:"Latitude",description:"Latitude coordinates of this probe",disabled:!l},m.a.createElement(T.Input,{label:"Latitude",type:"number",placeholder:"0.0",value:(null===(e=a)||void 0===e?void 0:e.latitude)||0,onChange:this.onLatUpdate})),m.a.createElement(T.Field,{label:"Longitude",description:"Longitude coordinates of this probe",disabled:!l},m.a.createElement(T.Input,{label:"Longitude",type:"number",placeholder:"0.0",value:(null===(t=a)||void 0===t?void 0:t.longitude)||0,onChange:this.onLongUpdate}))),m.a.createElement(T.HorizontalGroup,null,m.a.createElement(T.Field,{label:"Region",description:"Latitude coordinates of this probe",disabled:!l},m.a.createElement(T.Input,{label:"Region",type:"string",placeholder:"region",value:a.region,onChange:this.onRegionUpdate})))),m.a.createElement(T.Container,{margin:"md"},m.a.createElement("h3",{className:"page-heading"},"Labels"),m.a.createElement(X,{labels:a.labels,onUpdate:this.onLabelsUpdate,isEditor:l,type:"Label",limit:3})),m.a.createElement(T.Container,{margin:"md"},m.a.createElement(T.HorizontalGroup,null,m.a.createElement(T.Button,{onClick:this.onSave,disabled:!l||!this.isValid()},"Save"),a.id&&m.a.createElement(T.Button,{variant:"destructive",onClick:this.showDeleteProbeModal(!0),disabled:!l},"Delete Probe"),m.a.createElement(T.ConfirmModal,{isOpen:r,title:"Delete Probe",body:"Are you sure you want to delete this Probe?",confirmText:"Delete Probe",onConfirm:this.onRemoveProbe,onDismiss:this.showDeleteProbeModal(!1)}),m.a.createElement("a",{onClick:this.onBack},"Back"))),m.a.createElement(T.Modal,{isOpen:o,title:"Probe Authentication Token",icon:"lock",onDismiss:a.id?this.showTokenModal(!1):this.onBack},i)),a.id&&this.renderStatus())},t}(f.PureComponent),me=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={probes:[],addNew:!1},t.onSelectProbe=function(e){Object(u.getLocationSrv)().update({partial:!0,query:{id:e}})},t.onAddNew=function(){t.setState({addNew:!0})},t.onRefresh=function(){return Object(h.b)(t,void 0,void 0,(function(){var e;return Object(h.d)(this,(function(t){switch(t.label){case 0:return[4,this.props.instance.api.listProbes()];case 1:return e=t.sent(),this.setState({probes:e}),[2]}}))}))},t.onGoBack=function(e){console.log("go back"),t.setState({addNew:!1}),e&&t.onRefresh(),Object(u.getLocationSrv)().update({partial:!0,query:{id:""}})},t}return Object(h.c)(t,e),t.prototype.componentDidMount=function(){return Object(h.b)(this,void 0,void 0,(function(){var e,t,n,a,r,o;return Object(h.d)(this,(function(i){switch(i.label){case 0:return e=this.props,t=e.instance,n=e.id,[4,t.api.listProbes()];case 1:return a=i.sent(),r=n?parseInt(n,10):-1,o=a.find((function(e){return e.id===r})),this.setState({probes:a,probe:o}),[2]}}))}))},t.prototype.componentDidUpdate=function(e){if(this.props.id!==e.id){var t=this.props.id,n=t?parseInt(t,10):-1,a=this.state.probes.find((function(e){return e.id===n}));this.setState({probe:a})}},t.prototype.labelsToString=function(e){return e.map((function(e){return e.name+"="+e.value})).join(" ")},t.prototype.render=function(){var e=this.props.instance,t=this.state,n=t.probe,a=t.addNew;if(!e)return m.a.createElement("div",null,"Loading...");if(n)return m.a.createElement(fe,{probe:n,instance:e.api,onReturn:this.onGoBack});if(a){return m.a.createElement(fe,{probe:{name:"",public:!1,latitude:0,longitude:0,region:"",labels:[],online:!1,onlineChange:0},instance:e.api,onReturn:this.onGoBack})}return m.a.createElement("div",null,this.renderProbeList())},t.prototype.renderProbeList=function(){var e=this,t=this.state.probes,n=this.props.instance;return t?m.a.createElement("div",null,E(c.EDITOR)&&m.a.createElement(T.HorizontalGroup,{justify:"flex-end"},m.a.createElement(T.Button,{onClick:this.onAddNew},"New")),t.map((function(t){var a=t.id||0;if(t.id){var r="Offline",o="heart-break",i="red";return t.online&&(r="Online",o="heart",i="green"),m.a.createElement("div",{key:a,className:"add-data-source-item",onClick:function(){return e.onSelectProbe(a)}},m.a.createElement("div",{className:"add-data-source-item-text-wrapper"},m.a.createElement("span",{className:"add-data-source-item-text"},t.name),m.a.createElement("span",{className:"add-data-source-item-desc"},m.a.createElement(T.Badge,{color:i,icon:o,text:r}),m.a.createElement("div",null,e.labelsToString(t.labels)))),m.a.createElement(de,{labelNames:["probe"],labelValues:[t.name],ds:n.api.getMetricsDS(),height:60,width:150,sparkline:!1}),m.a.createElement("div",{className:"add-data-source-item-actions"},m.a.createElement(T.Button,null,"Select")))}})),m.a.createElement("br",null)):null},t}(f.PureComponent),ge=function(e){function t(t){var n=e.call(this,t)||this;return n.state={settings:Object.values(u.config.datasources).filter((function(e){return"synthetic-monitoring-datasource"===e.type}))},n}return Object(h.c)(t,e),t.prototype.loadInstances=function(){var e,t,n,a;return Object(h.b)(this,void 0,void 0,(function(){var r,o,i,s,l;return Object(h.d)(this,(function(c){switch(c.label){case 0:return(r=this.state.settings[0])&&r.name?[4,Object(u.getDataSourceSrv)().get(r.name)]:[3,4];case 1:return(o=c.sent())?(i=o.instanceSettings.jsonData,l={api:o},[4,ve(null===(t=null===(e=i)||void 0===e?void 0:e.metrics)||void 0===t?void 0:t.grafanaName)]):[3,4];case 2:return l.metrics=c.sent(),[4,ve(null===(a=null===(n=i)||void 0===n?void 0:n.logs)||void 0===a?void 0:a.grafanaName)];case 3:return l.logs=c.sent(),s=l,this.setState({instance:s,valid:be(s)}),this.updateNav(),[2];case 4:return console.log("Creating a new datasource TODO, check user auth"),[4,b()];case 5:c.sent(),console.log("Reload the windows (will redirect)"),window.location.reload(),c.label=6;case 6:return[2]}}))}))},t.prototype.componentDidMount=function(){return Object(h.b)(this,void 0,void 0,(function(){return Object(h.d)(this,(function(e){return this.updateNav(),this.loadInstances(),[2]}))}))},t.prototype.componentDidUpdate=function(e){this.props.query!==e.query&&this.props.query.page!==e.query.page&&this.updateNav()},t.prototype.updateNav=function(){var e,t,n=this.props,a=n.path,r=n.onNavChanged,o=n.query,i=n.meta,s=o.page||"checks",l=[];this.state.valid&&"config"!==s&&"redirect"!==s?(l.push({text:"Checks",url:a+"?page=checks",id:"checks"}),l.push({text:"Probes",url:a+"?page=probes",id:"probes"})):this.state.valid&&"redirect"===s?(l.push({text:"Dashboard Redirect",url:a+"?page=redirect",id:"redirect"}),l.push({text:"Config",url:a,id:"config"})):l.push({text:"Config",url:a,id:"config"});var c=!1;try{for(var u=Object(h.g)(l),d=u.next();!d.done;d=u.next()){var p=d.value;p.active=!c&&s===p.id,p.active&&(c=!0)}}catch(t){e={error:t}}finally{try{d&&!d.done&&(t=u.return)&&t.call(u)}finally{if(e)throw e.error}}c||(l[0].active=!0);var f={text:"Synthetic Monitoring",img:i.info.logos.large,subTitle:"Grafana Cloud Synthetic Monitoring",url:a,children:l};r({node:f,main:f})},t.prototype.renderMultipleConfigs=function(){return m.a.createElement("div",null,"TODO... multiple instances... delete one!!!!")},t.prototype.dashboardRedirect=function(){var e=this.state.instance,t=this.props.query;if(!e)return m.a.createElement("div",null,"Loading.... (or maybe a user permissions error?)");if(!t.dashboard)return m.a.createElement("div",null,"Dashboard not found");var n=w(t.dashboard,e.api);if(!n)return console.log("dashboard not found.",t),m.a.createElement("div",null,"Dashboard not found");var a="d/"+n.uid,r=Object(h.a)({},t);return delete r.dashboard,delete r.page,Object(u.getLocationSrv)().update({partial:!1,path:a,query:r}),null},t.prototype.renderConfig=function(){var e=this.state.instance;return e?m.a.createElement(U,{instance:e.api}):m.a.createElement("div",null,"Loading.... (or maybe a user permissions error?)")},t.prototype.render=function(){var e=this.state,t=e.settings,n=e.valid,a=e.instance;if(t.length>1)return this.renderMultipleConfigs();var r=this.props.query;return n&&"config"!==r.page?"dashboard"in r?this.dashboardRedirect():"checks"===r.page?m.a.createElement(he,{instance:a,id:r.id}):"probes"===r.page?m.a.createElement(me,{instance:a,id:r.id}):m.a.createElement("div",null,"Page not found."):this.renderConfig()},t}(f.PureComponent);function ve(e){return Object(h.b)(this,void 0,void 0,(function(){return Object(h.d)(this,(function(t){switch(t.label){case 0:if(!e)return[3,4];t.label=1;case 1:return t.trys.push([1,3,,4]),[4,Object(u.getDataSourceSrv)().get()];case 2:return[2,t.sent()];case 3:return t.sent(),[3,4];case 4:return[2,void 0]}}))}))}function be(e){return!!(e&&e.logs&&e.metrics&&e.api)}n.d(t,"plugin",(function(){return ye})),n.d(t,"ConfigCtrl",(function(){return d}));var ye=(new p.AppPlugin).setRootPage(ge)}])}));
//# sourceMappingURL=module.js.map